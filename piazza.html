<h1>Baggy Bound quiz review note has been posted!</h1>
<h3>2018-03-20T05:26:05Z</h3>
<div><p>Baggy Bound and Buffer Overflow note from today quiz review have been posted to the class website.<br />It is on today calendar &#34;quiz review&#34;. <br /><br /></p></div><hr><h1>Questions for Review Session</h1>
<h3>2018-03-16T01:50:54Z</h3>
<div><p>Hi everyone,</p>
<p></p>
<p>In preparation for the review session, please post your questions on the quiz topics here. This way, we can focus the review on specifics that were confusing rather than talking about topics that the whole class already understands. </p>
<p></p>
<p>Please post your questions in the following format. Questions not posted in this thread or format will be ignored. </p>
<p></p>
<p><strong>Topic: Question (e.g. baggy: Does baggy protect against structures?)</strong></p>
<p></p>
<p>The topics are the following: intro, Google, U2F, lab1, baggy, SGX, iOS, Capsicum, NaCl, OKWS, Android, Youn&#39;s guest, lab2</p>
<p></p>
<p>Thanks,</p>
<p>6.858 TAs </p></div>
<h2>Followup</h2>
<div><p>Where/when is this review session expected to take place?</p></div>
<h3>Followup Response</h3>
<div><p>We are finalizing that. We will update you as we finalize. </p></div>
<h3>Followup Response</h3>
<div><p>When/Where has been updated!</p></div>
<h2>Followup</h2>
<div><p>baggy: Could we go through a problem together? I&#39;m still confused on the sizes of entries/slots and the table.</p>
<p></p>
<p>Capsicum: What is the relationship between Capsicum and OKWS? In general it would be quite helpful to go over how the topics we have studied so far relate (eg another one would be NaCl vs. SGX Enclave), to answer questions like: are they different implementations of the same technology? Are they two completely different approaches to some problem? Is one an implementation of the other (a broader concept)?</p></div>
<h3>Followup Response</h3>
<div>To understand the difference between NaCl and SGX consider what the threat models are for each of these.</div>
<h2>Followup</h2>
<div><p>Youn&#39;s guest: What should be the takeaways from this talk? It was a bit more general that most of our lectures, with the exception of some of the historical attacks he told us about, so I am not quite sure what concepts / security technologies / practices to review from this.<br /><br />Thanks!</p></div>
<h3>Followup Response</h3>
<div>The lecture was indeed high level so I expect the questions about it to be high level as well. For example: what’s the difference between a pen tester and a security professor?</div>
<h2>Followup</h2>
<div><p>Can an attacker exploit a buffer overflow problem even if the stack grows upwards?</p></div>
<h3>Followup Response</h3>
<div><p>Edit:</p>
<p></p>
<p>intro: Can an attacker exploit a buffer overflow problem even if the stack grows upwards?</p></div>
<h3>Followup Response</h3>
<div><p>I forgot to answer this question but you can still overflow and overwrite return address of the children function if your buffer is in the parent stack.<br /><br /></p>
<pre>void vuln_func(char* input_fr_user){
    char buff[12];
    copy(buff, input_fr_user);
}</pre>
<p><br />HIGH<br />------<br />local_var_of_copy<br />------<br />old_ebp<br />------<br />ret_of_copy<br />------<br />addr_buff (argument_of_copy())<br />------<br />buff<br />------<br />LOW<br /><br /></p>
<p>buff write ret_of_copy</p>
<p></p></div>
<h2>Followup</h2>
<div><p>What was the answer to this lecture question?</p>
<p></p>
<p>char *p = malloc(256);</p>
<p>char *q = p &#43; 256;</p>
<p>char ch = *q; //Does this raise an exception?</p></div>
<h3>Followup Response</h3>
<div><p>char *q = p &#43; 256; will not raise an exception because the arithmetic operation is allowed for address that is over allocated boundary by less than half slot size.<br />char ch = *q; will raise an exception because deallocate outside the allocated boundary is not allowed. <br /><br /></p></div>
<h2>Followup</h2>
<div><p>Will the notes be posted after for those who have Monday night classes? </p></div>
<h3>Followup Response</h3>
<div><p>&#43;1</p></div>
<h3>Followup Response</h3>
<div><p>&#43;1</p></div>
<h3>Followup Response</h3>
<div><p>The high level summary for Native Client &#43; Capsicum are in the link above, and we just went through a couple of the past year&#39;s quiz questions. </p></div>
<h2>Followup</h2>
<div><p>baggy: can we go over question 7 on 2017 quiz? and how does the book-keeping work in baggy bounds checking for marking the high bit for a pointer? </p></div>
<h3>Followup Response</h3>
<div><p>I believe you mean question 3 from 2017? (question 7 is about Capsicum). I&#39;d also like to request going over this question; I had some trouble with the address space layout and pointer arithmetic</p></div>
<h3>Followup Response</h3>
<div><p>Oh it&#39;s the question 7 on &#34;(roman numeral) III Baggy bounds checking&#34;. </p></div>
<h3>Followup Response</h3>
<div><p>Ah, sorry, I was confusing the section numbering with the question numbering.</p></div>
<h2>Followup</h2>
<div><p>Can we go over #8 on the 2015 quiz? It&#39;s about how to set groups and permissions. More generally, what does it mean to set permissions for a service vs a socket vs a file? How should you think about what things belong in the same group? </p></div>
<h3>Followup Response</h3>
<div><p>When you think of permissions, you should think of the 3 types of permissions: read, write, and execute. For a socket, it&#39;s about who can read and write to a socket. It doesn&#39;t seem necessary to allow a socket to execute. A file is straightforward, and a service is about what that service can do, i.e. what it can read, write, or execute, similar to a process.</p>
<p></p>
<p>A way to think about groups is that users are unique, but many users can be part of one group. A user cannot be part of more than one group. </p></div>
<h2>Followup</h2>
<div><p>Could you please go over Quiz 1 2012 Question 3?</p></div>
<h3>Followup Response</h3>
<div><p>I&#39;m also having trouble with the reasoning for the T/F answers to this question. Could someone explain the answers?  </p>
<p></p>
<p>1) It is safe to run all services with the same UID/GID. True</p>
<div>
<div>
<div>
<p>2) It is safe to run services without chroot. True</p>
</div>
</div>
<div>
<div>
<div>
<div>
<div>
<p>3) It is safe to also give each service an open file descriptor for a per-service directory /cores/servicename. True</p>
<p></p>
<p>Also, what is 3) asking? </p>
<p> </p>
</div>
</div>
</div>
</div>
</div>
</div></div>
<h3>Followup Response</h3>
<div><p>The insight behind these questions is that the capabilities enforce the security. For example, in 3), you can give each service an open file descriptor, but the process doesn&#39;t have the permission to access the directory, then the processor can&#39;t do anything with that descriptor. </p>
<p></p>
<p>It&#39;s important to think about this in terms of what is Unix like without Capsicum and what changes with Capsicum.</p></div>
<h3>Followup Response</h3>
<div><p>Can&#39;t process with the same UID kill each other though. So wouldn&#39;t 1) be dangerous and therefore false?</p></div>
<h3>Followup Response</h3>
<div><p>Sure it is not ideal, but does Capsicum claim to protect against that, i.e. is that part of the threat model?</p></div>
<h2>Followup</h2>
<div><p>capsicum: can we go over Q12 for 2015 quiz? The answer says &#34;No. Capsicum may make the application hard to exploit, but you were not required to say this.&#34; I am not sure what this means. </p></div>
<h3>Followup Response</h3>
<div><p>Capsicum is a permission access control scheme, so we can use it to limit the permissions provided to the application, but Capsicum isn&#39;t going to help prevent buffer overflows due to bugs in the application itself. Does that help? </p></div>
<h3>Followup Response</h3>
<div><p>Yes, that clarifies. </p></div>
<h2>Followup</h2>
<div><p>Baggy bound questions: 2011 Q11, 12, 13</p></div>
<h3>Followup Response</h3>
<div><p>&#43;1 I also have a question on what order local variables are placed on the stack in vs. structure variables. i guess I don&#39;t understand why in test 3 y is at a higher address than x but with regards to the structure sa itself (in the context of test1), the x.buf is below the function pointer x.p</p></div>
<h3>Followup Response</h3>
<div><p>Sorry that I didn&#39;t have much time to go over it during the review. I added my detailed solution where I draft stack layout in the today review note I just posted on the class website.<br /><br />Please check my <a href="http://css.csail.mit.edu/6.858/2018/reviews/baggy-buf.pdf" target="_blank">solution</a> in last page and see if you still have question or not.</p></div>
<h2>Followup</h2>
<div><p>capsicum: There is only one access/permission scheme for all kinds of objects. What does this mean? I thought you have different levels of permissions - read write seek etc that you can set</p></div>
<h3>Followup Response</h3>
<div><p>Capsicum does have different levels of permissions. I think what &#34;one access/permission scheme&#34; is referring to is that now you have a single precise access control scheme for files / directories / sockets / (and other objects), instead of maybe having a different permission scheme for each type of object. </p></div>
<h2>Followup</h2>
<div><p>Nacl: &#34;(Springboard) Prevents computed jumps into springboard by module code&#34; - from the notes. I&#39;m wondering how you could allocate memory on a conditional statement then or is that just not possible?</p></div>
<h3>Followup Response</h3>
<div><p>I&#39;m not sure if this is what you&#39;re asking about, but NaCl does provide its version of mmap() and sbrk()</p></div>
<h2>Followup</h2>
<div><p>Nacl: Can you explain the need for the outer and inner sandbox and what exactly they do?</p></div>
<h3>Followup Response</h3>
<div><p>The inner sandbox is responsible for x86 sandboxing (the nacljmp / 32-byte alignment of code / the rules in Table 1 of the paper), etc. </p>
<p>The outer sandbox is more like a last line of defense, just in case something goes wrong and the attacker manages to break out of the inner sandbox, having the outer sandbox might prevent / slow down the attacker. The outer sandbox is more OS-dependent plan. One example in the lecture note is that the outer sandbox could be Capsicum on FreeBSD. </p></div>
<h2>Followup</h2>
<div><p>nacl: during an indirect jump, the jump address is literally modified (by erasing the lower 5 bits to 0). Which mechanism guarantees that the modified address points to the correct location in the (also modified) binary code? </p></div>
<h3>Followup Response</h3>
<div><p>Any jump target is guaranteed to be at a location that is 0 mod 32 (so the lower 5 bits of the address will be 0). The mechanism that guarantees this is that all of the jump targets are computed ahead of time and padding (no-ops, which are just 1 byte) is added before each so that they&#39;re properly aligned.</p></div>
<h3>Followup Response</h3>
<div><p>But in jump %eax (or to some other register location), how does the compiler know beforehand the what %eax is (it may depend on user input or other randomness I guess)? </p></div>
<h3>Followup Response</h3>
<div><p>I think the assumption here is that one is always using the compiler provided by NaCl(or a third party one that implements strictly according to NaCl&#39;s policy).</p>
<p>Thus, at least in C/C&#43;&#43; one can always know where an indirect jump is jumping to(at the source language level). For instance, a virtual method call in C&#43;&#43; is an indirect jump: an invocation like a.foo() can potentially run any of A&#39;s descendent&#39;s foo function. But we still know that all the foo functions will be potential jump targets. Thus it&#39;s sufficient to pad all beginning of foo. </p></div>
<h2>Followup</h2>
<div><p>U2F: In review session, the TA mentioned combining salt and challenge by sending $H( H ( pw || salt ) || R )$, where H is the hash, pw is the password and R is the random challenge. The server stores $H ( pw || salt )$ and can thus verify. In this case, one can pass the authentication just knowing $H ( pw || salt )$. So I don&#39;t see how this is different than sending $H( pw || R )$ and let the server stores $pw$ directly.</p></div>
<h3>Followup Response</h3>
<div><p>My understanding is that there are 3 things going on here:</p>
<p>- We don&#39;t want to let the server store pw directly! So we hash it.</p>
<p>- We don&#39;t want rainbow attacks to be easy, so we actually hash (pw || salt) -- now the server has that hash and salt.</p>
<p>- Finally, we want to prevent an adversary doing a replay attack (just sending hash(pw || salt) that it somehow intercepted before) so we add a reward R that has an expiration date, so that hash( hash(pw || salt) || R) cannot be used again.</p>
<p></p>
<p>Hope that&#39;s right - &#64;TAs please confirm! :)</p></div>
<h3>Followup Response</h3>
<div><p>See &#64;361</p></div>
<h2>Followup</h2>
<div><p>Could we have explanations for some of the questions above that we didn&#39;t have time to cover in the review session? </p></div>
<h2>Followup</h2>
<div><p>Lab1: What is the deal with (or maybe not) stack alignment? Why are there 16 extra x&#39;s in the solution for 2013, Q1?</p></div>
<h3>Followup Response</h3>
<div><p>So, if you calculate <br />size of reqpath = 2048<br /> the distance between reqpath and ebp = 0xbffff608 - 0xbfffedf8 = 2064<br />You will get that there are space left = 2064 - 2048 = 16 which might correspond to other local variables.</p></div>
<h3>Followup Response</h3>
<div><p>What other local variables?</p></div>
<h3>Followup Response</h3>
<div><p>including pointers to env_len and env <br />but the actual value of env_len and env will be stored in BSS segment because they are static variables.</p></div>
<h3>Followup Response</h3>
<div><p>Sure, but aren&#39;t those pointers only 8 bytes combined?</p></div>
<h3>Followup Response</h3>
<div><p>I kind of agree with that, but my guess is ... &#64;346.<br />I just saw that post and answered. </p></div><hr><h1>2011 Problem 4 Baggy Bounds</h1>
<h3>2018-03-21T04:53:33Z</h3>
<div><p>Why does f take up 4 bytes? </p></div><hr><h1>Stack Canary Location</h1>
<h3>2018-03-21T04:29:54Z</h3>
<div><p>In the lecture notes, it says that the stack canary is placed before the ebp, but in the baggy bounds review notes and wikipedia, it says that the stack canary is placed before the return address. Which is correct?</p></div>
<h2>Staff Answer</h2>
<div><p>I&#39;m unsure either due to inconsistence I also found. Could be varied by compiler design or assembly calling convention? However, you don&#39;t have to worry much about that but the goal is it will always come before return to try to protect the return address (before ebp also mean before return but not immediately before). </p></div><hr><h1>Quiz 1 2012 Question 3</h1>
<h3>2018-03-21T03:11:48Z</h3>
<div><p>For 1) they say its true but if all processes run with the same UID/GID doesn&#39;t that allow the processes to kill each other which is dangerous.</p></div>
<h2>Staff Answer</h2>
<div><p>That can happen. Is that part of Capsicum&#39;s threat model or security goals?</p></div><hr><h1>NaCl -- why 2 sandbox?</h1>
<h3>2018-03-21T03:11:07Z</h3>
<div><p>What&#39;s the purpose of the outer sandbox?</p></div>
<h2>Staff Answer</h2>
<div><p>Intercepts system calls at the process boundary</p></div><hr><h1>Fall 2017 Baggy Bounds Question</h1>
<h3>2018-03-21T02:23:26Z</h3>
<div><p>I&#39;m still confused as to how we get 0x1001006C for the base? Isn&#39;t the base of the pointer 0x10203040? </p>
<p></p>
<p></p></div>
<h2>Followup</h2>
<div><p>im also still confused about this one. if someone could draw the whole stack, that would be very helpful. im specifically confused about where the other variables go on the stack, and if the bounds are baggy for the struct (rounded up to 32) or for the buffer (rounded up to 16) or both</p></div>
<h3>Followup Response</h3>
<div><p>Baggy bounds works on whole objects (i.e. the struct here); it won&#39;t pad buffers inside of structs, only the memory allocated for the struct itself.</p></div>
<h3>Followup Response</h3>
<div><p>thanks, this clears some things up. although, im still confused as to why it couldnt have been out of bounds above the buffer as well? like, if the buffer started at 0x..44 and N=23, then 0x..5a would be 3 bytes outside the bound, causing the oob to set. there must be a flaw in my logic given that this was not a solution, but i am not sure where.</p></div>
<h3>Followup Response</h3>
<div><span style="background-color:#fff">That’s because the address of allocated object is slot-aligned ( address % 16 = 0) </span><div><span style="background-color:#fff">So the address of buff can only be either 0x...50 or 0x...60<br /></span><div><span style="background-color:#fff"><br /></span></div><div><span style="background-color:#fff">For more detail please check last page of this quiz review note from yesterday <a href="http://css.csail.mit.edu/6.858/2018/reviews/baggy-buf.pdf">http://css.csail.mit.edu/6.858/2018/reviews/baggy-buf.pdf</a> </span></div></div><div><br /></div></div>
<h3>Followup Response</h3>
<div><p>ahh okay! that makes so much sense, thanks. i read the quiz review note but i found it more confusing than helpful tbh</p></div>
<h3>Followup Response</h3>
<div><p>also you mean the address of the struct, right?</p></div>
<h3>Followup Response</h3>
<div><p>Yes I mean the address of struct.<br />I now know why the note make you confused. It&#39;s actually my typo. I keep remembering that buff is p and p is buff. I just corrected the note and hope that it make more sense. :)</p>
<p>Thank you. Good catch.</p></div>
<h2>Student Answer</h2>
<div><p>I think 0x10203040 is only for the first part (#6) not for #7.  </p>
<p></p>
<p>Re: the followup below, this was my impression of what the stack looks like.</p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/h6qi4cr213h2om/jf0htt6z8lhc/20180320_2251.jpg" alt="" width="284" height="181" /></p></div><hr><h1>2012 #1 Buffer Overflows</h1>
<h3>2018-03-21T02:10:29Z</h3>
<div><p>Here&#39;s the question setup from #1 in 2012 quiz: </p>
<p></p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/h6qi4cr213h2om/jf0g5i1wpq20/Screen_Shot_20180320_at_10.05.09_PM.png" alt="" width="406" height="276" /></p>
<p></p>
<p>One of the true/false questions is: </p>
<p><em>An adversary can prevent the program from printing “Hello world” on a system using Baggy bounds checking with slot_size=16. (Stack grows down.)</em></p>
<p><em></em></p>
<p>The correct answer is False, since both tmp and buf have 256 bytes allocated to them. My question is: <strong>if in the foo function, tmp was initialized to something smaller (i.e. char tmp[60]) would the question still be False?</strong>  I think it would, since bounds checker wouldn&#39;t let you access tmp[i] where i &gt; 64.  Is that correct? </p></div>
<h2>Student Answer</h2>
<div><p>You mean True? Because of the reason you just said -- it wouldn&#39;t let you access tmp[i] for i &gt; 64, so it crashes before printing &#34;Hello World&#34;.</p></div><hr><h1>Direction of writing to variables in the stack</h1>
<h3>2018-03-21T01:59:24Z</h3>
<div><p>So when the stack grows down, it goes from high addresses to lower memory addresses. But each individual variable is written from low to high; that&#39;s why we&#39;re able to overflow a return address using a local function variable. </p>
<p></p>
<p>When the stack grows up, how does writing to variables work (is it low to high like before) and can we still overflow a buffer in the same way?  </p></div>
<h2>Staff Answer</h2>
<div><p>In the first lecture, we discussed that you can still overflow other return address if the stack grows up.</p></div><hr><h1>Quiz 2014 Question IV, #8</h1>
<h3>2018-03-21T01:26:40Z</h3>
<div>I thought that Native Client instructions should be 32-byte aligned. Why are the instructions on this question not 32-byte aligned?</div>
<h2>Followup</h2>
<div><p>I think the condition is that they do not cross the 32-byte boundary. They do not all have to align there. You can also see why it doesn&#39;t matter if not all of them are aligned. We mainly want to ensure that indirect jumps get to a valid instruction. We just need those to be 32-byte aligned.</p></div>
<h2>Staff Answer</h2>
<div><p>The constraint is that no Native Client instruction can straddle a 32-byte boundary.</p>
<p></p>
<p>I think the concern was that if we make every instruction 32-byte aligned, we&#39;d have a large blow-up in size of the binary. For example, if we have a bunch of 2-byte instructions, then we would end up with 30 bytes of padding for each instruction. </p></div><hr><h1>Native Client (2014 Quiz Question IV, b)</h1>
<h3>2018-03-21T01:20:08Z</h3>
<div><p>The answer says &#34;The validator will complain about the jmp at 0x10020 with error “Bad indirect control transfer”; see Figure 3 in the NaCl paper.&#34; - why is this the case? It seems to be correct for me<br /><br />Here&#39;s the link for the exam: https://css.csail.mit.edu/6.858/2018/quiz/q14-1-sol.pdf</p></div>
<h2>Staff Answer</h2>
<div><p></p><pre>1001d: 83 e0 e0      and $0xffffffe0,%eax<br />10020: ff e0         jmp *%eax</pre>
<p></p>
<p>1. This is actually the special nacljmp instruction. (We know this because there should be no direct jumps in the binary. )</p>
<p>2. The validator will treat the nacljmp as a single instruction, and one of the rules is that no instruction can straddle the boundary of a 32-byte block. To the validator, the single nacljmp instruction is violating that rule</p></div><hr><h1>Baggy Bounds: Slots &amp; Tables</h1>
<h3>2018-03-21T00:47:47Z</h3>
<div><p>I think I understand the concepts of when arithmetic operations and dereferences succeed / mark OOB / crash. However, I am confused on how the bound table works. Let&#39;s take the example from class: p = malloc(25). Using baggy bounds&#39;s buddy allocation, we actually allocate 32 bytes for p (since that is the closest power of 2 that is greater than 25). Thus, in our bounds table, we want to store the log base 2 of this size (5). What I am confused about it why we store this in 2 slots. Also, as slot size is 16 in this example, it seems like we are using 32 bytes (2 slots) to store size information for p (which is also 32 bytes). Thus, our bounds table is taking up as much space as our object itself? (I know this must be wrong, I believe the paper says the table size is 1/slot_size, so would be 1/16 in this example, but I don&#39;t see how that is possible).</p>
<p></p>
<p>In addition, in the notes posted for baggy bounds quiz review, how do we go from the virtual mem address (which is also the bounds table??) to the bounds table?</p></div>
<h2>Staff Answer</h2>
<div>They use two table entries to store because they want to make fast look up O(1) from a given pointer.<div>In your example, we use only 2bytes (2 table entries) while object is about 32 bytes &gt;&gt; 2:32 = 1:16 </div><div>That’s how the paper claims that table size spend about (1/16) * allocated_size due to its 1:16 ratio -&gt;&gt; (1/16) * 100 ~ 6% space overhead.</div><div>Do you now see why that’s the case?</div><div><br /></div><div>In contrast, fat pointer keeping track of both start and end of bound in each pointer address will tripple the size of each pointer -&gt; not scalable.</div><div><br /></div><div>In section 3.1, they said that they preserve lower 1/16 of the address space for bound table.</div></div><hr><h1>2015 quiz 1 problem 7 (okws)</h1>
<h3>2018-03-20T23:23:46Z</h3>
<div><p>The solution starts off with saying each branch should have a separate token, but that&#39;s already given, right (it&#39;s not a change)? In addition, I don&#39;t really understand how the db proxy enforces that a branch only performs RPCs as users in the same branch (limit which records it can access, given the branch token?). Also, how do we transfer between branches without knowing tokens (is there a protected lookup that the proxy handles)? Finally, how is it that the branch can only give away money is compromised. Thanks!</p></div>
<h2>Staff Answer</h2>
<div><p>The problem states that a customer is associated with a branch, so it&#39;s ok to assume that the db proxy probably knows which branch a customer/username is associated with. The branch token is used as identification to the DB proxy since it&#39;s performing the RPC calls.</p>
<p></p>
<p>For the transfer, think about how transfer would happen if you had SetBalance instead of Transfer? Branch A would have to give Branch B its token to call SetBalance and Branch B would have to give Branch A its token to call SetBalance so that the right amount is transferred.</p>
<p></p>
<p>Since a branch only has its own token, it can only transfer non-negative money since the DB proxy checks to if the value is transfer amount is negative. Therefore, it can only give away money.</p>
<p></p>
<p>A branch with its own token should be enough. What else would you need?</p></div><hr><h1>Quiz 1 2015, Question 8</h1>
<h3>2018-03-20T22:46:22Z</h3>
<div><p>Strictly speaking, why is it necessary for <strong>auth</strong> to have read, write, and execute permission for /jail/authsvc/? Isn&#39;t execute permission enough to be able to access /jail/authsvc/sock? Same question for /jail/relaydsvc/ and /jail/mda/. (i.e. I thought the permissions for /jail/authsvc/, /jail/relaydsvc/, and /jail/mda/ should&#39;ve been 0110. Is there a reason this is incorrect?)</p>
<p></p>
<p>Why do user1 and user2 need to have have read, write, and execute permissions for /mail/user1/ and /mail/user2/ respectively? I didn&#39;t read about any processes running with userids &#34;user1&#34; and &#34;user2&#34;, so I don&#39;t see why we have to give &#34;user1&#34; and &#34;user2&#34; read, write, and execute permission to /mail/user1/ and /mail/user2/.</p></div>
<h2>Followup</h2>
<div><p>I also don&#39;t understand why relayd need to be able to read the queue and mda need to be able to read mail in the folders?</p>
<p> </p></div>
<h3>Followup Response</h3>
<div><p>Also confused about these permissions: </p>
<ul><li>Why does mda need to read and execute user1 and user2? Isn&#39;t it enough to write mail to users&#39; inboxes? I would have thought that 0720 was enough for user1 and user2.</li></ul>
<p></p>
<p>I think relayd needs to be able to read a message off the queue and write a new message to the queue when it receives something from smtpd, but I&#39;m not sure why it needs to execute the queue. My guess is that since queue/ is a directory, relayd needs execute permissions in order to read/write to it.</p></div>
<h2>Staff Answer</h2>
<div>Not really, execute permissions in a dir allows ‘ls’ but that’s it! To read the socket you will need 500 or 700 to write </div><hr><h1>What is a namespace?</h1>
<h3>2018-03-20T21:45:28Z</h3>
<div><p>What do the OKWeb and Capsicum sections mean when they refer to &#34;global namespace&#34;? For example, the OKWeb notes say:</p>
<pre>Overall, Unix is awkward at precisely-controlled isolation&#43;sharing:
  Many global name-spaces: files, UIDs, PIDs, ports.</pre>
<p>What does namespace mean in this context?</p></div>
<h2>Staff Answer</h2>
<div>I think they are referring to namespaces like the ones in C&#43;&#43; <a href="http://en.cppreference.com/w/cpp/language/namespace">http://en.cppreference.com/w/cpp/language/namespace</a><div><br /></div><div>Basically logical regions of memory.</div></div><hr><h1>Stack layout for struct</h1>
<h3>2018-03-20T21:45:20Z</h3>
<div><p>For this struct (2011 IV Baggy bounds checking)</p>
<p></p>
<pre>struct sa {<br />  char buf[32]; <br />  void (*f) (void); <br />};</pre>
<p>Is the following layout correct (with baggy padding, byte number in decimal, assuming the current stack pointer before allocation is at 576)? </p>
<p></p>
<pre>576 x================x
    | baggy padding  |<br />548 x================x<br />    |       f        |<br />544 x================x<br />    |      buf       |<br />512 x================x</pre>
<p></p></div>
<h2>Staff Answer</h2>
<div><p>Check <a href="https://css.csail.mit.edu/6.858/2018/reviews/baggy-buf.pdf" target="_blank">this</a> (last page) and see if my stack layout make sense to you. </p></div>
<h2>Followup</h2>
<div><p>Yes, thanks!</p></div>
<h2>Followup</h2>
<div><p>Not relevant to the quiz, but why does this make sense from an implementation standpoint. That means all structs have the potential to be overflown. But if they had simply just padded all arrays would that not have been a better approach?</p></div>
<h3>Followup Response</h3>
<div><p>What would be the overhead of padding all arrays?</p></div><hr><h1>2015 Q1</h1>
<h3>2018-03-20T21:01:42Z</h3>
<div><p>I&#39;m slightly confused regarding the distinction between address of x and x. </p>
<p>My understanding is that Q1)1) should contain the address of name, given that the arg is a ptr to name. This is done when they talk of address of n in Q1)4). So in Q1)1), is it truly name that is stored there or the address of name?</p>
<p>Thanks!</p></div>
<h2>Staff Answer</h2>
<div><p>True that variable name is kind of confusing.<br />name = &#34;address&#34; of the string because if you look at the code </p>
<pre>void http_serve(int fd, char *name) {}</pre>
<p>Consider name, name&#43;30, name &#43;40...<br />The name is pointer to the string or &#34;address of the string&#34; right?</p>
<p>in c when you *name it will be the string itself.</p></div><hr><h1>2009 Question 9</h1>
<h3>2018-03-20T20:56:06Z</h3>
<div><p>Hi, can someone explain the answer to this question in more detail. Would the logging be done by a new service thats only created when some process needs to write to the log? Where will it get its permissions from?</p></div>
<h2>Staff Answer</h2>
<div><p>The logging would be down by the logging service except on-demand initiated by the setuid binary. The setuid binary should have logging service id to execute it and set it under the right permissions.</p>
<p></p>
<p>Why do you think the sa struct does that?</p></div><hr><h1>2017 Question 4</h1>
<h3>2018-03-20T20:12:23Z</h3>
<div><p>https://css.csail.mit.edu/6.858/2018/quiz/q17-1-sol.pdf</p>
<p></p>
<p>Can someone explain what the takeaway from question 4 is supposed to be? I read the answer, and I was still unclear. What exactly is the change? Also why is it important that services do not have access to socket descriptor?</p>
<p></p></div>
<h2>Student Answer</h2>
<div><p>Here&#39;s the way I understand it:</p>
<p></p>
<p>The way our zook web service is currently setup in the lab, each service has it&#39;s own socket that the client uses to send requests to that service. In the setup in question 8, there is just one socket with a single data stream going to the client. The responses to different requests are delineated by the Content-Length field, which tells the client the size of each response (or the offset of the start of the next response).</p>
<p></p>
<p>Suppose the echo service is compromised, and the client requests something from the echo service immediately before it requests something from the transfer service. In an insecure setup, the echo service can write 100 bytes into the socket buffer, along with a Content-Length header that says the response is just one byte. When the client receives the response from the echo service (which is using the same TCP connection as the transfer service), it will think it got a one-byte response from the echo service and a 98 byte response from the transfer service (assuming the Content-Length header is one byte, and the value written at that byte is 98). This is bad!</p>
<p></p>
<p>The solution uses the zookd root process to screen packets as they are going out to make sure they have the correct Content-Length field. If the compromised echo service tries to pass in a 100 byte response with a Content-Length header that says the response is just one byte, zookd will write this response to the socket buffer. Presumably, zookd would also preserve the ordering of responses. It is important that the services do not have access to the socket descriptor, since otherwise they could bypass the zookd check and write arbitrary data into the socket. </p></div><hr><h1>2015 quiz 1 questions 1-4</h1>
<h3>2018-03-20T19:10:12Z</h3>
<div>How do you know which argument will be used when you have multiple arguments and want to call a function with one argument. Specifically, consider replacing a return address with the unlink syscall. But the original function is of the form f(a, b). On the stack from top to bottom, this looks like ...|b|a|raddr|... . But how do we know if raddr will use a or b as its arg? I would have expected it to use a, but in question 1 it uses b, and in question 3 it uses a.</div>
<h2>Student Answer</h2>
<div><p>I think it should use a, which is consistent with Q2 and Q3. How do you see from Q1 that it uses b?</p></div>
<h2>Followup</h2>
<div>The any space between unlink and the string address seems to indicate we are writing in the |b| slot, otherwise it would be |straddr||unlink| to match |a||addr| vs |straddr||any||unlink| for |b||a||addr.</div>
<h3>Followup Response</h3>
<div><p>I believe a normal call to</p>
<pre>unlink grades.txt</pre>
<p>would result in the instruction pointer to go to &amp;unlink, and the top of the stack (lowest memory address) would look like |straddr||return address|</p>
<p></p>
<p>As such, the unlink function will pull its argument from 4 bytes below the top of the stack (and we can put anything in the return address for unlink).</p>
<p></p>
<p>Essentially, if each section is 4 bytes, |straddr||any||unlinkaddr| results in the execution going to unlinkaddr, the top of the stack becoming the &#34;any&#34; block, and the unlink function using &#34;straddr&#34; as the argument (good).</p>
<p></p>
<p>If we instead used |any||straddr||unlinkaddr|, we would execute from unlinkaddr, and unlink&#39;s return address would be straddr, and the argument would be &#34;any&#34;</p></div><hr><h1>2011 Quiz 1, Problem 4</h1>
<h3>2018-03-20T19:06:56Z</h3>
<div><p>This is one of the questions that was covered in the review notes.<br /><br />In 10, how is it possible to crash the program by only providing an input of 32 bytes instead of 33 bytes? <tt>buf</tt> can hold 32 bytes, so does writing 32 bytes with <tt>gets</tt> terminate those 32 bytes with a null byte, which ends up in <tt>f</tt>?</p>
<p><span style="font-family:monospace"></span></p></div>
<h2>Student Answer</h2>
<div><p>From the problem &#34;recall that gets terminates its string with a zero byte.&#34;</p>
<p>This provides the additional byte needed to cause the crash. </p></div><hr><h1>SGX question V</h1>
<h3>2018-03-20T18:08:51Z</h3>
<div><p>For this problem, would the following solution also work? </p>
<p></p>
<p>You call EEXTEND but you provide an incorrect address to EEXTEND, so you could have different parts of the program in spots where they shouldn&#39;t be? </p>
<p></p></div>
<h2>Student Answer</h2>
<div><p>It&#39;s unclear what you mean by incorrect address. The way I understand it, EEXTEND is a stand-alone command that takes in an address and some data and checks that the data at the address equals to the data that was passed in.</p>
<p></p>
<p>What you can do is call EADD on different memory addresses than what you call EEXTEND on, which is basically what the answer says.</p></div><hr><h1>Spring 2017 Question 6: Native Client Solution</h1>
<h3>2018-03-20T17:16:27Z</h3>
<div><p>Can someone explain the solution to this question to me? I&#39;m very confused.</p></div>
<h2>Staff Answer</h2>
<div><p>Try &#64;347,  does that explanation help?</p></div><hr><h1>2014 q1 #5</h1>
<h3>2018-03-20T16:07:21Z</h3>
<div>Could someone explain the answers? I don&#39;t understand why A is false--wouldn&#39;t the fd for oklogd not be accessible anymore by other processes (pubd, svc, etc)? And I would have expected B-D to be false because they involve sending over a port which is different than a fd.</div>
<h2>Staff Answer</h2>
<div><p>A is false because in OKWS, services lack privileges to write to the log file, so they send messages over a local Unix socket to oklogd.</p>
<p></p>
<p>Similar to A, I would recommend reading the sections that talk about file descriptors for the respective connection channels. </p></div><hr><h1>Did we cover brop attacks?</h1>
<h3>2018-03-20T15:58:12Z</h3>
<div>If so, where?</div>
<h2>Staff Answer</h2>
<div>We did not.</div><hr><h1>baggy bound backwards compatibility</h1>
<h3>2018-03-20T15:30:06Z</h3>
<div><p>Is this correct?</p>
<p>For uninstrumented code, baggy bounds sets all the bound table entries to 31.  This means that:</p>
<p>1. bounds checker will <strong>not</strong> throw any errors</p>
<p>2. baggy bounds does <strong>not protect</strong> against buffer overflow attacks in this cod</p></div>
<h2>Followup</h2>
<div><p>What does &#39;uninstrumented&#39; library/code mean?</p></div>
<h3>Followup Response</h3>
<div><p>Instrumented code are the library that use the wrapper to make it support by baggy checking, so external library are uninstrumented code by default and will not support baggy checking unless they wrap it. Section 3.3 in the paper has more detail but they didn&#39;t discuss much.</p></div>
<h2>Staff Answer</h2>
<div><p>1. Yes. Because base=0 and size=2^31 means all the whole 2^31 address space is valid for those uninstrumented code to use.<br />2. Yes. </p></div><hr><h1>ASLR, stack popping gadgets</h1>
<h3>2018-03-20T05:33:35Z</h3>
<div><p>I saw in things like ASLR, stack popping gadgets were covered in 2014 Lec 3 (but this video was never referenced in our schedule and we didn&#39;t seem to read any relevant papers about this). Do we need to know the stuff covered in that lecture? </p>
<p></p>
<p></p></div>
<h2>Staff Answer</h2>
<div><p>No we didn&#39;t cover return oriented programming (ROP) in this year. ASLR is mentioned very little where all you need to know is it try to randomize the address to make it harder for an attacker to hardcode the address. </p></div><hr><h1>Baggy Bound questions</h1>
<h3>2018-03-20T05:32:33Z</h3>
<div><p>Is the following understanding of baggy bounds correct: </p>
<p></p>
<p dir="ltr">Baggy bounds allows for &#34;bad&#34; pointer arithmetic that is outside of the malloc bounds, but instead the baggy bounds of the allocation size or the allocation size &#43; slot_size/2. In these cases, baggy bounds will set the high bit of the pointer to 1, causing an error on dereference, but won&#39;t throw an error when the arithmetic occurs. If such a pointer is ever set back within bounds, then the high bit will be set to 0 again.</p>
<p dir="ltr">However if the arithmetic results in a pointer that is outside of the allocation bounds &#43; slot_size/2, then baggy bounds will throw an error when that arithmetic happens?</p>
<p dir="ltr"></p>
<p dir="ltr">If this is correct, then the following questions: </p>
<p dir="ltr">1) Why does baggy bounds allow for the slot_size/2 flexibility? </p>
<p dir="ltr">2) Why does it only throw an exception on arithmetic that makes the pointer go beyond slot_size/2? (For example, it could just set the high bit to 1 in this case and only throw an error for dereference, or it could make all bad pointer arithmetic outside of the allocation bound throw an error).</p>
<p>3) Can baggy bounds be used with a non-buddy allocator? </p>
<p>4) Does the minimum size of a malloc need to be at least the slot_size (since otherwise, you could have 2 different mallocs map to the same slot)? </p>
<p>5) Do we need to know how baggy bounds works on 64-bit systems?</p>
<p></p></div>
<h2>Followup</h2>
<div><p>For 2), it simply that one cannot easily recover which object that out of bound pointer was originally pointing tol; thus baggy bounds checking cannot &#34;set back to 0&#34; as you have proposed. </p></div>
<h2>Staff Answer</h2>
<div><p>1. Yes for arithmetic operation &#64;370<br />2. Yes because it label all the high address page starting with bit 1 to inaccessible page at the beginning of the program. Attempting to access those page will cause an error.<br />3. Yes, imagine the external library that is NOT modified to support baggy. Check the review note pg.1 topic &#34;2 bound table&#34;.<br />4. Yes.<br />5. I don&#39;t think so. :) We only do 32 bit system so far including our lab.<br /><br />Today quiz review note for more detail: <a href="http://css.csail.mit.edu/6.858/2018/reviews/baggy-buf.pdf">http://css.csail.mit.edu/6.858/2018/reviews/baggy-buf.pdf</a></p>
<p></p></div><hr><h1>Quiz 1 2017, Question 12</h1>
<h3>2018-03-20T05:00:02Z</h3>
<div><p>The question asks for a strategy that ensures that the virus scanner reports viruses in other files even if one specially crafted file exploits a buffer overflow that compromises the program. If this is the goal, it seems like doing a pdfork on each file is enough, but the answer says we also have to limit the capabilities of the new processes created by each pdfork.</p>
<p></p>
<p>Is there a reason we have to limit the capabilities of a the new processes to achieve our goal? If there is, what am I missing?</p>
<p></p>
<p>Thanks!</p>
<p></p>
<p></p>
<p></p>
<p></p></div>
<h2>Staff Answer</h2>
<div><p>We would still like to practice the principle of least privilege and limit what the virus scanner would be able to do, so we limit the virus scanner to have read capability for the single file it is scanning and write capability just to see the output. If we hit that file with the buffer overflow, how much damage is possible? Some possibilities: could the the buffer overflow take control of the virus scanner, temporarily hide viruses in other files or overwrite them? </p></div><hr><h1>2017 Q5</h1>
<h3>2018-03-20T04:48:15Z</h3>
<div><p>For the given answer, won&#39;t the line *p = 0 effectively replace &#34;x.tx&#34; with ascii for 0 because p points to the bottom of buf and that dereference is still very much valid?</p>
<p></p></div>
<h2>Student Answer</h2>
<div><p>I had this same thought - so p used to point to a, but you can overwrite p!</p></div><hr><h1>Why do we need to recover Out of Bounds references?</h1>
<h3>2018-03-20T04:48:00Z</h3>
<div><p>Baggy Bounds Checking section 2.4 states &#34;The next challenge is to recover a pointer to the referent object from the out-of-bounds pointer without resorting to an additional data structure.&#34;</p>
<p></p>
<p>If I have an out of bounds pointer, why does the baggy bounds runtime need to recover a pointer to the referent object? What C code would necessitate that? Wouldn&#39;t it be the programmer&#39;s responsibility to adjust the pointer to point to a valid address?</p></div>
<h2>Staff Answer</h2>
<div><p>They want to make arithmetic operation more flexible because the pointer addition/subtraction sometimes go out of bound and eventually come back to area within the bound before it&#39;s dereferenced (read/modify value). <br /><br />Therefore, they allow half slot over for arithmetic, but if you try to deref it, it will cause Error due to trying to access the inaccessible page with address starting with 1.</p></div><hr><h1>Capsicum details</h1>
<h3>2018-03-20T04:38:53Z</h3>
<div><p>Can someone explain which permissions the different components of OKWS have and what is the worst thing that can happen if each component is compromised? </p></div>
<h2>Staff Answer</h2>
<div><p>They can be found in the paper in Table 1. A good way to think about the worst case is a process can do with those permissions. </p></div>
<h2>Student Answer</h2>
<div><p>The lecture notes have some useful info (assuming you were asking about OKWS details, not Capsicum details)! https://css.csail.mit.edu/6.858/2018/lec/l05-okws.txt</p></div><hr><h1>Paul Youn Lecture Slides</h1>
<h3>2018-03-20T04:34:34Z</h3>
<div><p>I found Paul Youn&#39;s slides from 2015, and they look more or less the same as the slides from this year.</p>
<p></p>
<p>http://css.csail.mit.edu/6.858/2015/lec/l04-paul-youn.pdf</p></div><hr><h1>2017 question 7: Why is there only one possible answer?</h1>
<h3>2018-03-20T04:17:54Z</h3>
<div><p>For example, can&#39;t N be -34 and the address of p be 0X70? Why is there only one possible answer? </p></div>
<h2>Student Answer</h2>
<div><p>I believe the assumption here is that a out of bound pointer is only &#34;valid&#34; in baggy bounds checking, is when it is only within <tt>slot/2</tt> away from the object. See &#64;363</p></div><hr><h1>Tomorrow morning&#39;s office hours starting 1 hour later</h1>
<h3>2018-03-20T03:46:43Z</h3>
<div><p>10am to 11:59am.</p>
<p></p>
<p>Quiz questions are better posted to Piazza, but please stop by if you are having issues with lab 3.</p></div>
<h2>Followup</h2>
<div><p>Why are quiz questions better posted to piazza? Also, is this a policy for all office hours that we shouldn&#39;t expect to be able to ask quiz questions? </p></div>
<h3>Followup Response</h3>
<div><p>Each TA has specialized in a subset of the papers. For example, I&#39;ll be able to answer SGX and iOS questions readily, but I haven&#39;t spent as much time as other TAs looking at Baggy Bounds or Capsicum. Of course, you can still stop by office hours and ask any question.</p></div><hr><h1>Spring 2017 Question 5: Call to unlink separated from argument</h1>
<h3>2018-03-20T03:34:16Z</h3>
<div><p>The solution basically takes the format:</p>
<p></p>
<p>[x.txt &#43; filler] [address of unlink] [valid address for p to be] [argument to unlink]</p>
<p></p>
<p>I understand that we want to be able to dereference p which is why we need to put a valid pointer there, but I&#39;m confused how the call to unlink knows to look two ahead for its argument and why this works.</p></div>
<h2>Student Answer</h2>
<div><p>The [argument to unlink] actually overrides the value of &#34;a&#34;. </p>
<p></p>
<p>Since &#34;a&#34; was originally an argument to &#34;bar&#34;, there will be some instruction that reads off from address of a and put it onto the top of stack. </p></div><hr><h1>Lecture videos for this year?</h1>
<h3>2018-03-20T03:20:30Z</h3>
<div><p>Are there lecture videos for this year?</p></div>
<h2>Student Answer</h2>
<div><p>*cough* *cough* maybe try the links that say &#34;video&#34;</p>
<p></p>
<p><a href="http://css.csail.mit.edu/6.858/2018/schedule.htmlÂ">http://css.csail.mit.edu/6.858/2018/schedule.html </a> </p>
<p></p></div><hr><h1>Baggy bounds question</h1>
<h3>2018-03-20T03:10:57Z</h3>
<div><p></p><p>Let’s say we’re dealing with a 32 bit system and we have baggy bounds with slot size 16. Does this mean if we overflow 8 bits past the bounds, then baggy bounds will trigger and throw an error? Or is it 9 bits? i guess I&#39;m wondering if it&#39;s &gt; slotsize/2 or &gt;= slotsize/2</p></div>
<h2>Followup</h2>
<div><p>I wish there was a button for &#34;great question&#34;</p></div>
<h3>Followup Response</h3>
<div><p>I&#39;ll do that for you, so resolved!</p></div>
<h3>Followup Response</h3>
<div><p>there is a button for good question</p></div>
<h2>Staff Answer</h2>
<div><p>it&#39;s error when &gt; slotsize/2, so 9 bits will throw an error. <br />Section 2.4 in the paper mentioned that &#34;out-of-bounds pointer are at most slot_size/2 before or after the alocation&#34; <br /><br /></p></div>
<h2>Followup</h2>
<div><p>Just as a clarification, an error is raised when an arithmetic is performed and the resultant pointer is out of slot/2 right?</p></div>
<h3>Followup Response</h3>
<div><p>Yes. Also, the baggy quiz review note is now available below the class calendar Mar 20.<br /><a href="http://css.csail.mit.edu/6.858/2018/reviews/baggy-buf.pdf">http://css.csail.mit.edu/6.858/2018/reviews/baggy-buf.pdf<br /></a></p></div><hr><h1>Access to lectures questions and responses?</h1>
<h3>2018-03-20T03:05:15Z</h3>
<div><p>I thought I had seen students questions and answers from previous years for each paper (&#34;Below, we have included the questions we&#39;ve received from students in past years (when available), along with answers to those questions, in case you find it helpful.&#34;), but I cannot seem to find them anymore. In addition, I can&#39;t seem to find the collection of this years&#39; questions and answers to the lecture question. I think these would be useful for studying, how can I access these? Thanks!</p></div>
<h2>Followup</h2>
<div><p>Nvm -- it&#39;s working for me again! I think I somehow went to a page of just lecture questions (the hw ones) instead!</p></div><hr><h1>Storing passwords vs. challenge-response</h1>
<h3>2018-03-20T02:41:16Z</h3>
<div>There&#39;s two key ideas here: storing passwords securely and challenge-response. The TA (and the lecture) made a mistake trying to mix these two concepts (in particular, ignore the idea of mixing salts and challenge-response). Challenge-response is a useful building block for more sophisticated protocols, but most websites don&#39;t use it for user authentication (it&#39;s complicated, patented, etc). Instead, most websites send the user&#39;s password directly to the web application over SSL. The most important take-away is that you shouldn&#39;t store passwords directly, but instead store a hash of the password using a slow hash function. Salts are useful too, but the slow hashing is more important.

See this blog post (and the 2007 posted linked at the top) for more clarity:

https://www.nccgroup.trust/us/about-us/newsroom-and-events/blog/2015/march/enough-with-the-salts-updates-on-secure-password-schemes/</div>
<h2>Followup</h2>
<div><p>Is the password sent to the server and then hashed, or hashed on the client side and sent to the server?</p>
<p></p>
<p>If hashed on the client side, we would be worried about replay attacks from a man in the middle... but if not hashed, couldn&#39;t the man in the middle observe the password and use it to login?</p></div>
<h3>Followup Response</h3>
<div><p>For secure password storage, the server does not have the plaintext password, so the client would need to send it. The TCP handshake involves the client and server generating a shared secret for a symmetric key encryption scheme (which is initially vulnerable to a MITM attack, but not if the client knows some public key of the server before-hand or can verify the public key through a trusted third-party). The client can use this encryption scheme to encrypt the password along with the time the client requested to login and send this ciphertext to the server. The client should also include a message authentication code for the ciphertext that is generated with another secret the client shares with the server (this secret is also generated during the handshake). Since the ciphertext includes the time of the login request and the encryption scheme plus the message authentication code prevents the adversary from generating a related ciphertext (i.e. a ciphertext that encrypts the same password but has a login time of the next day), this scheme is resistant to replay attacks, and allows the client to send the password directly to the server to be hashed with the salt and checked against what the server actually stores.</p></div>
<h3>Followup Response</h3>
<div><p>for added security, the server could store H(H(password) || salt), requiring the client to only send the hash of the password, but this doesn&#39;t let you get around the whole TCP song and dance</p></div><hr><h1>Spring 2017 Question 5 (buffer overflows)</h1>
<h3>2018-03-20T02:23:12Z</h3>
<div><p>I&#39;m trying to do the buffer overflow question and the solutions say &#34;Alternatively, overflow return address with &amp;unlink, and place &amp;&#34;x.txt\0&#34; above unlink’s return address without breaking bar or p in the process.&#34;</p>
<p></p>
<p>What would the input look like if you tried to do this question by overflowing the return address? That&#39;s what I tried and I&#39;d like to check my answer.</p></div>
<h2>Staff Answer</h2>
<div><p>&#39;A&#39; * 16 &#43; &lt;exit_addr&gt; &#43; &lt;buff_addr&gt; &#43; &lt;any&gt; &#43; &lt;any&gt; &#43; &lt;unlink_addr&gt; &#43; &lt;any&gt; &#43; &lt;addr_of_x.txt&gt; &#43; &#39;x.txt\0&#39;<br /><br />buff_addr could be other stack address that won&#39;t make our exploit fail after modify value *p = 0;<br />exit_addr or any valid function address <br />addr_of_x.txt = 0x..12C<br /><br />ps. in the exam you will need to use actual value not variable like I do.<br />ps2. Please let me know if I made mistake. It&#39;s 3am already; my brain gonna stop working haha.</p></div>
<h2>Followup</h2>
<div><p>What is the purpose of the <tt>&lt;any&gt;</tt> after <tt>&lt;unlink_addr&gt;</tt> but before <tt>&lt;addr_of_x.txt&gt;</tt>?</p></div>
<h3>Followup Response</h3>
<div><p>That tries to make &lt;addr_of_x.txt&gt; the first argument of unlink.<br />If you get rid of &lt;any&gt; unlink arg be wrong address, which is the hex value of  &#39;x.txt\0 but not the address of the string (unlink expect the pointer to the string)</p></div>
<h2>Followup</h2>
<div><p>Also, what is the exit_addr?</p></div>
<h3>Followup Response</h3>
<div><p>This example I use exit(), so it&#39;s the address of exit. That&#39;s why the official solution to this particular answer try to exploit with function pointer rather than return address, so that you can avoid trying to answer the exam without knowing the address of exit() or other function you want to use in advance.</p></div>
<h3>Followup Response</h3>
<div><p>^ could possibly make you get points off if I do this in the actual exam, so I suggest choosing the answer that allow you to include every address given from the exam question.</p></div><hr><h1>Followup for questions during review</h1>
<h3>2018-03-20T02:04:54Z</h3>
<div><p>Here were some of the questions from review (I don&#39;t have answers for all but will update them when I do). If there are any more questions or any questions that I missed, feel free to post on piazza. </p>
<p></p>
<p>1. Native client: trampoline / springboard </p>
<p>From paper (bottom of page 6-7)</p>
<p>Trampoline: jumps from untrusted to trusted. The entry points for the trampoline are the addr %mod 32-byte places within the first 64KB trusted code. One of the the entry points is blocked with the hlt to prevent the code within that 32-bytes from being executed by any user code (only the trusted trampoline code can call the code within this chunk)</p>
<p>Springboard: jumps from trusted back to untrusted</p>
<p></p>
<p>2. Capsicum: when are capabilities checked? </p>
<div>
<div>
<div>
<p>From the paper: &#34;Capability rights are checked by the kernel function fget, which converts a numeric descriptor into a struct file reference&#34;</p>
<p><a href="https://stackoverflow.com/questions/12751167/what-does-fget-light-in-linux-work" target="_blank">Here&#39;</a>s a bit more description about file descriptors and fget() that I thought might help with understanding them: <br />&#34;Each task has a file descriptor table. This file descriptor table is indexed by file descriptor number, and contains information (file descriptions) about each open file.</p>
<p>As many other objects in the kernel, file descriptions are reference-counted. This means that when some part of the kernel wants to access a file description, it has to take a reference, do whatever it needs to do, and release the reference. When the reference count drops to zero, the object can be freed. For file descriptions, <code>open()</code> increments the reference count and <code>close()</code> decrements it, so file descriptions cannot be released while they are open and/or the kernel is using them (e.g: imagine a thread in your process <code>close()</code>ing a file while another thread is still <code>read()</code>ing the file: the file description will not actually be released until the read <code>fput()</code>s its reference).</p>
<p>To get a reference to a file description from a file descriptor, the kernel has the function <code>fget()</code>, and <code>fput()</code> releases that reference. Since several threads may be accessing the same file description at the same time on different CPUs, <code>fget()</code> and <code>fput()</code> must use appropriate locking. In modern times they use RCU; mere readers of the file descriptor table incur no/almost no cost.&#34;</p>
<p></p>
<p>3. &#64;358</p>
</div>
</div>
</div></div><hr><h1>Spring 2017: Capsicum global namespace lookup</h1>
<h3>2018-03-20T01:16:26Z</h3>
<div><p>In section VII Capsicum question 11. The solution says use cap_enter and then fexec the scanner. But how is the file descriptor to &#34;/home/ben/bin&#34; passed into the scanner? I thought the scanner cannot read global namespace thus an unmodified scanner(that potentially does &#34;fopen(path_to_scan)&#34; will fail?</p></div>
<h2>Staff Answer</h2>
<div><p>In the lecture notes, it says that the application has to use &#34;openat&#34; or &#34;*at&#34; system calls. One way to do this is to have a daemon running in the background that can map open calls to openat.</p>
<p></p>
<p>If this kind of problem comes up in the exam, please state your assumptions, e.g. the application uses openat or there is a daemon that maps this.</p></div><hr><h1>Fall 2011: Question 4 about baggy bounds</h1>
<h3>2018-03-19T22:42:13Z</h3>
<div><p>In part A and related #10 of this problem, the solutions says that we should overwrite x.buf into x.f to cause the program to jump to an arbitrary address. I feel like I&#39;m drawing the stack frame completely wrong. I don&#39;t understand how we write 32 bytes into the x.buf variable and this will cause the program to fail. Is it because of line 18? That runs the function and if its a null byte, it fails??</p></div>
<h2>Staff Answer</h2>
<div><p>B diagram will be <br />-----<br />ret</p>
<p>-----<br />ebp<br />-----&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Baggy Bound <br /><br /><br />&lt;baggy_space&gt; 64 - 36<br />-------<br /><br />buf = 32<br />------</p>
<p>f = 4<br />------<br /><br />So in part B you can&#39;t overwrite f which is below and can&#39;t overwrite return address either because baggy bound will prevent you from doing that. <br /><br /><br /></p></div>
<h2>Followup</h2>
<div><p>Thank you for the response,  it makes sense to me except i don&#39;t get why the size of the baggy space is 64-36. Where does the 64 come from?</p></div>
<h3>Followup Response</h3>
<div><p>I have the same question! :)</p></div>
<h3>Followup Response</h3>
<div><p>Update: it appears (from the notes just posted) that the baggy bounds treats the struct as the object to do the bounds on so thats why its 64 bytes!</p></div>
<h3>Followup Response</h3>
<div><p>Yes you got it !</p></div>
<h2>Followup</h2>
<div><p>Wait are we allocating the space for the struct as one thing? that would make more sense if we had to round up to 64 because 32&#43;4=36 bytes, so sb would round up to 64 bytes....</p></div>
<h3>Followup Response</h3>
<div><p>Yes it treats the struct as one thing. They acknowledge this issue in their paper&#39;s &#34;section7 limitation and future work.&#34;<br />Thank you for asking. I just updated my review to make clear on that point about the round size is only for outermost object on the first page. <br />Check page 3 of <a href="http://css.csail.mit.edu/6.858/2018/reviews/baggy-buf.pdf" target="_blank">this review note</a> where I added my solution and draft of stack layout to this question.</p></div>
<h3>Followup Response</h3>
<div><p>ps. the review note can be accessed by the course website in Mar19 calendar.</p></div><hr><h1>Past year quizzes relevance?</h1>
<h3>2018-03-19T21:48:05Z</h3>
<div><p>Are all the questions on quizzes from recent years relevant or have the papers changed?</p></div>
<h2>Staff Answer</h2>
<div><p>No. Papers are not the same. Only the paper we learned this year will be on quiz. Some quiz topics are the same even if we used different paper &gt;&gt; in this case, the content will only be relate to this year papers not those papers.</p></div>
<h2>Followup</h2>
<div><p>The papers differ from year to year, but past quizzes covering the same papers are still relevant.</p></div><hr><h1>NaCl Indirect vs Direct jumps</h1>
<h3>2018-03-19T20:41:41Z</h3>
<div><p>Could you explain the difference between an indirect vs direct jump?</p>
<p></p>
<p>From my understanding:</p>
<p>- A direct jump is hard coded address that never changes. We can make sure that this is in Jump Targets. </p>
<p>- An indirect jump is an address that is dynamically computed and read from a register (eax). We use the special nacljump to make sure that this is at the start of a 32 byte block, and hence we don&#39;t run into any funky business by dropping into the middle of a sequence of instructions which results in a malicious interpretation.</p>
<p></p>
<p>If my above understanding is correct, the compiler must make sure that all the addresses that are indirectly jumped to are indeed at the start of 32 byte blocks, and pad with NOP if not. How does it know this if those addresses are dynamically loaded?</p></div>
<h2>Staff Answer</h2>
<div><p>Your understanding of direct jump and indirect jump is correct.</p>
<p></p>
<p>The validator is responsible for checking the compiler&#39;s output and it will ensure that all the indirect jumps will only land at the edge of a 32 byte block. And this is guaranteed because: <br />1. we know that no instruction can cross a 32-byte boundary (remember nacljmp is treated as a single instruction) and the validator does check for this</p>
<p>2. no indirect jumps  (must be using nacljmp) </p>
<p>3. the AND 0xffffffe0, %eax is going to clear out the lower 5 bits --&gt; enforcing that the jump address in %eax will be 32-byte aligned. So any attempt to jump to any instruction that isn&#39;t 32-byte aligned will result it jumping to the beginning of the 32-byte chunk that address is in instead</p>
<p></p>
<p>The compiler produces the assembly, but we are using the validator to check its output and makes sure that it follows all the NaCl rules. </p>
<p></p>
<p>I hope this helps, if not, please post any follow-up questions</p></div><hr><h1>Office hours today?</h1>
<h3>2018-03-19T20:41:33Z</h3>
<div><p>I&#39;m here now but I&#39;m not sure if there is a TA. Are there still office hours today? </p></div>
<h2>Student Answer</h2>
<div><p>were there ever office hours today?</p>
<p></p>
<p>(doesn&#39;t look like it according to: <a href="https://css.csail.mit.edu/6.858/2018/general.html">https://css.csail.mit.edu/6.858/2018/general.html</a>)</p></div><hr><h1>Quiz 1 2015 Problem 2.</h1>
<h3>2018-03-19T19:20:45Z</h3>
<div><p>I&#39;ve got a couple points of confusion on the solution to this problem.</p>
<p></p>
<p>First. Why is the solution to 2) &#34;Any&#34;. That means we overwrite the argument to the handler function. If we overwrite that, handler may seg-fault and not return control flow to our function, therefore our exploit will not work as expected.</p>
<p></p>
<p>Second. Why is the solution to 4) &#34;Any&#34;. How do we pass arguments to the unlink function call. As http_serve is being exited, the saved %ebp will be popped and replaced. Then, handler will look at that popped %ebp &#43; 8 to get the argument, yes? If so, don&#39;t we need to specifically replace saved %ebp instead of writing any?</p></div>
<h2>Staff Answer</h2>
<div><p>1. You will have to look into that function for example, if handler is &#34;http_serve_executable&#34;, I saw that it uses fd (file descriptor) in this line &#34;dup2(fd, 0);&#34; where <tt><a href="http://codewiki.wikidot.com/c:system-calls:dup2%20" target="_blank">dup2</a> </tt>returns negative return value means that an error occured, but doesn&#39;t raise any error. I didn&#39;t expect that student have to know this in detail, but as we tried exploit other function with return address, we might already overwrite fd with random values and doesn&#39;t fail to exploit. <br /><br />2. old_ebp doesn&#39;t affect us because when you continue to call the function, it will follow the <a href="https://en.wikipedia.org/wiki/Function_prologue" target="_blank">function prologue<br /></a>handler:</p>
<pre>push ebp<br />move ebp esp<br /></pre>
<p>so your ebp now refer to esp -&gt; your ebp is correct as expect because it reference to esp instead of random old_ebp value.</p></div><hr><h1>You won&#39;t believe how these MIT students cancelled their exam. Click here to find out!</h1>
<h3>2018-03-19T17:52:35Z</h3>
<div><p>As you can see from this link, the <a href="https://youtu.be/aLELsl9CKXk?t=41s" target="_blank">Snow Dance</a> is ultra effective in summoning snow. As our great instructors stated today in class, &#34;if there&#39;s a snow day, we will cancel the quiz entirely&#34;.</p>
<p></p>
<p>Please join us at 11:59 pm 3/20 on Killian to summon the snow!</p></div>
<h2>Followup</h2>
<div><p>On the other hand, our instructors &gt;&gt;&gt;&gt;&gt; <a href="https://www.youtube.com/watch?v=SD46f0TYDPk">https://www.youtube.com/watch?v=SD46f0TYDPk<br /><br /></a></p></div>
<h2>Followup</h2>
<div><p>did instructors actually say that (cancelling quiz entirely if snow day)? i didn&#39;t catch that</p></div>
<h3>Followup Response</h3>
<div><p>They said no quiz if we have a snow day, but I thought it was ambiguous whether they meant no quiz on Wednesday or no quiz ever.</p></div><hr><h1>Command to download course website</h1>
<h3>2018-03-19T17:44:58Z</h3>
<div><p>In case it is helpful for others:</p>
<p>wget --recursive --no-clobber --page-requisites --html-extension --convert-links --domains css.csail.mit.edu --no-parent <a target="_blank" href="https://l.messenger.com/l.php?u=https%3A%2F%2Fcss.csail.mit.edu%2F6.858%2F2018&amp;h=ATNUlm-KCwTPs2LcAzQOmKL8qU_o033qL6ipM-RRteyncvk7hDLTYFcVm-rGn07wKWmBrf7toK4ZqKbyVFiLWaENquerbCsPjyK8SKVqAXEwFxtQkOqQcL9oB3Y">https://css.csail.mit.edu/6.858/2018</a></p></div>
<h2>Followup</h2>
<div><p>it&#39;s nice, but just be aware some things won&#39;t be downloaded because they&#39;re links to external sites, which is prevented by --domains</p></div>
<h3>Followup Response</h3>
<div><p>Without --domains you could end up downloading an exponential amount of stuff :)</p></div>
<h3>Followup Response</h3>
<div><p>true, i just meant that you still need to manually download a few things after using the script</p></div><hr><h1>EXE paper on quiz</h1>
<h3>2018-03-19T17:06:51Z</h3>
<div><p>It didnt seem like it was in the topics, but i just wanted to make sure the EXE paper is not on the quiz</p></div>
<h2>Staff Answer</h2>
<div>EXE is not on quiz 1.</div>
<h2>Student Answer</h2>
<div><p>It&#39;s lectures 1-11.</p></div><hr><h1>SGX</h1>
<h3>2018-03-19T02:34:39Z</h3>
<div><p>I&#39;m trying to understand how SGX is used in practice but there&#39;s a few parts I&#39;m still missing.</p>
<p></p>
<p>Suppose I&#39;m trying to write a program that will work even on a compromised operating system. To achieve this I can create an enclave using SGX and put all of my critical code inside the enclave. But once the enclave has been created, how does the program start running the code inside the enclave? Is it as simple as jumping to an address inside the enclave?</p>
<p></p>
<p>How can my program verify that the enclave was initialized correctly? If my program is running on a compromised operating system, I&#39;m assuming the operating system can add malicious code to the enclave during initialization. Would the first instructions executed inside the enclave compare the measurement of the data added to the enclave against an expected measurement, representing the data I intended to add to the enclave?</p>
<p></p>
<p>Thanks!</p></div>
<h2>Staff Answer</h2>
<div>Yes; the program jumps to an address inside the enclave.

Remote attestation is used to verify that the enclave was initialized correctly. At a high level, someone external to the enclave can request a hash of the enclave signed by the CPU&#39;s private key. If the hash matches the expected hash for the initial enclave, then the remote party knows the enclave was initialized correctly.</div><hr><h1>Quiz 1 2017, Question 9 (SGX)</h1>
<h3>2018-03-19T01:43:21Z</h3>
<div><p>Suppose a program is in the middle of creating an enclave. Suppose the program adds a page to the enclave using EADD and then checks that the page contains the expected data using EEXTEND. Can a compromised operating system modify the data added to the enclave between the time the program calls EEXTEND and EINIT?</p>
<p></p>
<p>If so, does SGX have any way of defending against this type of attack?</p></div>
<h2>Staff Answer</h2>
<div>That&#39;s a good question. The OS can&#39;t write to the EPC directly, it can only load data using EADD. The OS could try to call EADD again, but that would change the measurement.</div><hr><h1>Quiz 1 2017, Question 10 (NaCl)</h1>
<h3>2018-03-18T21:28:14Z</h3>
<div><p>From my understand of how NaCl works, it replaces all &#96;jpm&#96;s with &#96;nacljmp&#96;s.</p>
<p>The provided answer is:</p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/hzmpto2zu9r1li/jexb8j261far/Screen_Shot_20180318_at_5.25.07_PM.png" alt="" /></p>
<p>1. How can they just add a &#96;JMP &#43;3&#96;, when all jumps are replaced by the AND &#43; JMP check?</p>
<p>2. Where do they actually jmp to the &#96;0f 05&#96; bytes to invoke the UNLINK call? </p></div>
<h2>Staff Answer</h2>
<div><p>1. Only indirect jumps are replaced by the nacljmp (AND&#43;JMP). For a direct jump (JMP &#43;3), the address is know at the verification time, so NaCl checks that the direct jump target is a valid instruction. Since Ben&#39;s verifier is broken, it treats nacljmp as a separate AND instruction and a JMP instruction, so it considers it &#34;valid&#34; to jump to the JMP *%eax instruction directly. Note that otherwise, it would view the AND&#43;JMP as a single instruction and disallow JMP &#43;3 since it appears to jump into the middle of an instruction. <br /><br /></p>
<p>2. That&#39;s a good question. What happens is JMP *%eax would jump to execute at the instruction address specified in %eax. So what is in %eax at the time of JMP ? It is the address 0x0001000d, so we jump to that address and start executing. It turns out that address is the middle of the last MOV instruction, specifically the SYSCALL bytes &#96;0f 05&#96; that we wanted to execute. Cool, we have now executed a SYSCALL within the broken NaCl!</p></div>
<h2>Followup</h2>
<div><p>So to clarify, a proper NaCl validator will NOT validate this program, right? The validator must see the atomic nacljmp, rather than two consecutive commands? </p></div>
<h3>Followup Response</h3>
<div><p>You are right, a properNaCl validator is NOT going to validate this program. See &#64;343 for a bit more about the checks based on the code in the paper. And yup, the validator needs to see that it is an atomic nacljmp</p></div>
<h2>Followup</h2>
<div><p>Does it matter what the last instruction is?  (i.e. does it matter that it&#39;s a MOV instruction)  Or is all that matters the fact that <tt>0f 05</tt> is embedded in there? </p></div>
<h3>Followup Response</h3>
<div><p>That is a good question, and you are right what matters more is that we are hiding the SYSCALL bytes within the MOV instruction. I don&#39;t think it matters that it is a MOV instruction, you could probably replace it with an ADD 0x050f, %eax. </p></div><hr><h1>Quiz 1 2013 Question 1</h1>
<h3>2018-03-18T15:50:43Z</h3>
<div><p>Where do the 16 x&#39;s above reqpath come from in the solution?</p>
<p><a href="https://css.csail.mit.edu/6.858/2018/quiz/q13-1-sol.pdf">https://css.csail.mit.edu/6.858/2018/quiz/q13-1-sol.pdf</a></p>
<p></p>
<p></p></div>
<h2>Student Answer</h2>
<div><p>1) I&#39;m not very confident here, but after &#96;reqpath&#96; we have two 4 byte pointers for &#96;env_len&#96; and &#96;env&#96;. So you would think that there should only be 8 x&#39;s, but then also I think the stack would be padded to 16 byte boundaries. So that&#39;s the 16 x&#39;s.</p>
<p></p>
<p>2) p requests 48 bytes which gets rounded up to 64, the next power of 2. At line 9 we are accessing p &#43; 56, which is past our object but still in the &#34;baggy&#34; part of the memory which is legal to use. </p></div>
<h2>Followup</h2>
<div><p>Could you explain why the stack would be padded to 16 byte boundaries?</p></div>
<h3>Followup Response</h3>
<div><p>(student answerer) I am not sure. If one of the TA&#39;s can comment on the first question (about 16 x&#39;s) it would be great!</p></div>
<h3>Followup Response</h3>
<div><p>I *think* it&#39;s because in http_request_line (if you look at the lab code) there are 4 pointers initialized at the beginning of the function: </p>
<p><tt> char *sp1, *sp2, *qp, *envp = env;</tt></p>
<p></p>
<p>Storing those pointers would create 16 additional bytes between the ebp and reqpath.  Though I&#39;m not sure how you would have realized that without opening up the lab code during the exam. </p></div>
<h2>Staff Answer</h2>
<div><p>I agree about the two pointers to env_len and env because even though you will place static variable in BSS section, you will need pointer refer to those address in the stack. <br /><br />Why 16 bytes not 8 bytes, I can&#39;t tell either. <br />My best guess is most time the compiler can do weird thing such as padding to make it cache align (for optimization purpose), reordering the local var on stack, etc. That&#39;s why we will always need gdb to observe the address rather than calculate everything by hand. This particular question doesn&#39;t require you to label these 16 bytes &lt;&lt; my guess is because it is hard to predict the compiler behavior. <br /><br />Most time, the quiz also gave you stack layout and its address to avoid having this issue. Still, you can assume that it is predictable as we do so far, but if it isn&#39;t they won&#39;t require you to label that.<br /><br /></p></div>
<h2>Followup</h2>
<div><p>Why did the adversary do len(shellcode) &#43; 8? If anything, shouldn&#39;t it be &#43;4, since the &#39;////&#39; is 4 bytes?</p></div>
<h3>Followup Response</h3>
<div><p>Before they reach return address they also have &#34;yyyy&#34;.</p></div><hr><h1>Quiz 1 (2017), Question 8</h1>
<h3>2018-03-18T07:12:47Z</h3>
<div><p>Why does zookd have to check the Content-Length header for every response sent by a service? Are we trying to prevent a compromised service from tricking a client into reading a response from the compromised service as a response from another service? For example, suppose a client requests something from service A and service B through one HTTP request pipeline.</p>
<p></p>
<p>Suppose the correct response from service A is:</p>
<p>aa</p>
<p>Content-Length: 2</p>
<p></p>
<p>And the correct response from service B is:</p>
<p>bb</p>
<p>Content-Length: 2</p>
<p></p>
<p>If both services aren&#39;t compromised, the client will receive a response of the form:</p>
<p>aabb</p>
<p>Content-Lengths: {2, 2}</p>
<p>So it will read the message from service A as &#34;aa&#34; and read the message from service B as &#34;bb&#34;, which is what we want.</p>
<p></p>
<p>But suppose service A is compromised and instead sends:</p>
<p>aaaa</p>
<p>Content-Length: 2</p>
<p></p>
<p>If this occurs, then the client would receive a response of the form:</p>
<p>aaaabb</p>
<p>Content-Lengths: {2, 2}</p>
<p>So it will read the message from service A as &#34;aa&#34; and read the message from service B as &#34;aa&#34; (uh-oh).</p>
<p></p>
<p><strong>Is this what this question was trying to get at?</strong></p>
<p></p>
<p>Also, the answer to this questions mentions that it&#39;s important that services don&#39;t have access to the socket descriptor. This is probably me not knowing enough about socket descriptors, but <strong>why is this so important?</strong></p></div>
<h2>Student Answer</h2>
<div><p>&#64;383</p></div><hr><h1>Understanding Capsicum Shortcomings</h1>
<h3>2018-03-17T20:12:26Z</h3>
<div><p>The class notes on Capsicum have a section describing &#34;What applications wouldn&#39;t be a good fit for Capsicum?&#34;</p>
<p>One of the listed categories of apps is described below:</p>
<blockquote>
<p>  Apps that need to connect to specific TCP/UDP addresses/ports from sandbox.</p>
<p>    Capsicum works by only allowing operations on existing open FDs.</p>
<p>    Need some other mechanism to control what FDs can be opened.</p>
<p>    Possible solution: helper program can run outside of capability mode,</p>
<p>      open TCP/UDP sockets for sandboxed programs based on policy.</p>
</blockquote>
<p>My question is: Why can we not just open those sockets ahead of time and pass them in to the process wrapped in file descriptors? I am not understanding how this is different than the normal plan with capsicum. </p>
<p></p></div>
<h2>Staff Answer</h2>
<div><p>You can, but here poliicy refers to some ACL behavior (think like a set of firewall rules, ie: <em>block all port 23</em>)<br />Here, the helper program is the firewall daemon that enforces these rules, so all applications must go and request FDs from the helper.</p>
<p></p>
<p>If we were to take your suggestion, we&#39;d have to duplicate behavior based on these rules for every application, instead of just having one process, responsible for all ports (like we suggest). A work-around that would make your solution good would be to keep the behavior the same (with a central configuration and library that enforces it) and a high-privileged process would read the config, open all ports needed (and allowed based on config) and pass them to child before dropping to a lower capability mode.</p></div><hr><h1>NaCl: In the NaCl paper, what does &#34;Bad indirect control transfer&#34; error message check against?</h1>
<h3>2018-03-17T20:00:24Z</h3>
<div><p>I am having trouble understanding the if statements that leads to this error for indirect jump checks.</p></div>
<h2>Staff Answer</h2>
<div><p>I think it&#39;s mostly checking to see if we have a valid nacljmp instruction for an indirect jump. Let&#39;s see if we can break it down: <br /><br />1.<tt> !is_2_inst_nacl_jmp_idiom</tt>:  This is probably checking that it is of the form of the nacljmp that we&#39;re expecting:  <br /><br /></p>
<p>and %eax, 0xffffffe0</p>
<p>jmp *%eax</p>
<p></p>
<p>2.<tt> icount &lt; 2</tt>: My guess is that since the nacljmp consists of 2 instructions it is impossible to have a valid nacljmp if we&#39;ve only seen 2 instructions so far. So this catches the edge case at the beginning of the verification</p>
<p></p>
<p>3. <tt>Block(StartAddr[icount-2]) != Block(IP)</tt> : This is to make sure that the nacljmp that we are using is part of the current 32-byte block of code and isn&#39;t straddling between the 32-byte boundaries. </p></div><hr><h1>Duplicate exercise numbers</h1>
<h3>2018-03-17T02:37:02Z</h3>
<div><p>In lab 3, exercises 4, 5, and 6 refer to two different sets of questions. </p></div>
<h2>Staff Answer</h2>
<div>Thanks for reporting that. It should be fixed now.</div><hr><h1>Late hours off by 1?</h1>
<h3>2018-03-17T01:25:27Z</h3>
<div><p>I was definitely 4 hours &#43; some change over the deadline but it&#39;s only saying 3? I think the submission website might not be taking daylight savings time into account or something.</p>
<p></p>
<p>Also I really thought the deadline was midnight. Oops. :(</p></div>
<h2>Followup</h2>
<div><p>hmm deadline is 11:59, also they take floor(sum(hours)) for each lab</p></div>
<h3>Followup Response</h3>
<div><p>Deadline is actually 5:00pm. It was 11:59 in 828 last semester, which was why I had thought that, too.</p></div>
<h3>Followup Response</h3>
<div><p>oh true, it&#39;s 11:59 in 824, which was why i thought that</p></div><hr><h1>Lab 2 All parts grading</h1>
<h3>2018-03-16T16:37:29Z</h3>
<div><p>In the final submission for lab 2, will we be graded for previous parts as well or only part 4?</p></div>
<h2>Staff Answer</h2>
<div>Yes, so please don’t fail the former parts pf lab2, i.e. parts1-3.</div>
<h2>Student Answer</h2>
<div><p>The labs are graded as a whole, also the later parts should not break the previous parts.</p></div><hr><h1>Final Project</h1>
<h3>2018-03-16T16:01:46Z</h3>
<div><p>Out of curiosity, what is the default final project going to be?</p></div>
<h2>Student Answer</h2>
<div><p>The default final project is Lab 5: http://css.csail.mit.edu/6.858/2018/labs/lab5.html</p></div><hr><h1>Installing packages for Challenges</h1>
<h3>2018-03-16T15:23:22Z</h3>
<div><p>Are we allowed to use additional packages for the challenges? I noticed a similar question (&#64;275) but I&#39;m wondering for general packages that could help for challenges (but not the main exercises) For example, I&#39;d like to &#96;import numpy&#96; but it is not natively installed on the VM -- is okay if I install it? Are there any restrictions for other packages given its still for the challenge? </p></div>
<h2>Staff Answer</h2>
<div>I don’t think the grading script support that. Although I agree that additional packages make thing easier, the chall shouldn’t need to be that complex :). Please stick to “no additional package”</div><hr><h1>lab 2 part 4, failing tests</h1>
<h3>2018-03-16T12:28:07Z</h3>
<div><p>i cant seem to pass any of the profile tests, and i cant figure out why. looking at the html out file isnt proving very helpful, where do i go from here?</p></div>
<h2>Student Answer</h2>
<div><p>I got a lot of weird bugs this lab too, if you post the specfic errors like in /tmp/zookld.out and your approach that might make it easier for me and others to offer help :)</p></div>
<h2>Followup</h2>
<div><p>Try seeing if it&#39;s permissions errors. I had a lot of problems with the profiles after implementing part 10.</p></div>
<h2>Staff Answer</h2>
<div><span style="background-color:#fff">Otherwise consider running the server and interact with the browser by including the .py you fail ex. Granter.py to the userX profile. Then, make other user view that userX so the script run and see the error in the terminal you run the server.</span></div><hr><h1>Exercise 10, creating folders for each user</h1>
<h3>2018-03-16T01:53:27Z</h3>
<div><p>I&#39;m trying to change rpc_run() so each user has their own folder inside /tmp, but I keep getting &#34;IOError: [Errno 13] Permission denied: u&#39;last_visit_test1_test2.dat.&#39;&#34;</p>
<p></p>
<p>I tried creating a new folder for each user using os.mkdir(), but it doesn&#39;t seem like it&#39;s actually creating new directories. When I enter &#34;ls /jail/tmp&#34;, no directories show up. Does anyone have any thoughts on what might be going on? The critical code from rpc_run() is show below.</p>
<pre>[rpc_run()]<br />userdir = &#39;/tmp&#39;
if ((user.find(&#34;/&#34;) == -1) and (user.find(&#34;.&#34;) == -1)):
    userdir &#43;= (&#34;/&#34; &#43; user)]
if not os.path.isdir(userdir):
    try:
        os.mkdir(userdir)
    except OSError as e:
        print &#34;OSError:&#34;, e
    except:
        print &#34;Unexpected error&#34;
        raise</pre>
<p>Thanks!</p></div>
<h2>Student Answer</h2>
<div><p>Try setting the permissions for the directory through os.mkdir() and making sure the file ownership is correct.</p>
<p></p>
<p>I believe the jail/tmp contents get copied into jail.check/tmp after the tests run, in case you want to try looking there for the directories!</p></div>
<h2>Followup</h2>
<div><p>I&#39;m having the same issue. I set the permissions using os.mkdir(userdir,777) and chown(0,profile_svc gid), but I still get the permission denied error. I suppose I&#39;m incorrectly setting the owners, but I&#39;m not sure why something else would make more sense?</p></div>
<h3>Followup Response</h3>
<div><p>Also make sure that you aren&#39;t creating the same directory more than once. I had that issue.</p>
<p></p>
<p>i.e. If it exists, don&#39;t create it. That will lead to an exception.</p></div>
<h3>Followup Response</h3>
<div><p>I also had to explicitly set the permissions via a chmod(userdir, 777) to get it to work after a mkdir.</p></div>
<h3>Followup Response</h3>
<div><p>Resolved</p></div>
<h3>Followup Response</h3>
<div><p>Can someone enlighten me as to why the permissions should be set to 777? Shouldn&#39;t we &#34;protect all of these files from other services on the same machine (such as the <tt>zookfs</tt> that serves static files)&#34;?</p></div>
<h3>Followup Response</h3>
<div><p>They shouldn&#39;t.</p></div><hr><h1>Exercise 9, Are we allowed to modify granter.py?</h1>
<h3>2018-03-16T00:39:05Z</h3>
<div><p>I don&#39;t see how can make a transfer from <strong>user</strong> to a <strong>visitor</strong> without passing <strong>user&#39;s</strong> token to granter.py. Of course, doing this requires adding another global variable to granter.py (see code below).</p>
<p></p>
<pre>[granter.py]
#!python
import sys, time, errno

global api
global user_token
...</pre>
<p>Is this the intended way to make a transfer from <strong>user</strong> to <strong>visitor</strong> or is there something I&#39;m missing? I&#39;m curious if the grading scripts expect us to use an unmodified granter.py file.</p>
<p></p></div>
<h2>Student Answer</h2>
<div><p>I don&#39;t think you can modify granter.py, and you don&#39;t need to. ProfileAPIServer will run as root for a short while. You should be able to do something during that time. </p></div>
<h2>Staff Answer</h2>
<div><p>Yes Yilun is right! Check &#64;302 for more detail</p></div><hr><h1>why are there 2 forks in rpc_run?</h1>
<h3>2018-03-15T23:04:04Z</h3>
<div><p></p><pre>        (sa, sb) = socket.socketpair(socket.AF_UNIX, socket.SOCK_STREAM, 0)
        pid = os.fork()
        if pid == 0:
            if os.fork() &lt;= 0:
                sa.close()
                ProfileAPIServer(user, visitor).run_sock(sb)
                sys.exit(0)
            else:
                sys.exit(0)
        sb.close()
        os.waitpid(pid, 0)

        sandbox = sandboxlib.Sandbox(userdir, uid, &#39;/profilesvc/lockfile&#39;)
        with rpclib.RpcClient(sa) as profile_api_client:
            return sandbox.run(lambda: run_profile(pcode, profile_api_client))</pre>
<p>What&#39;s the purpose of the second fork(). I know the first fork is to run the sandbox (in the parent process, it seems?). But what does the second fork inside the child process do? It seems to sys.exit(0) on both the child and parent process.</p></div><hr><h1>granter.py Failing : tokens</h1>
<h3>2018-03-15T22:51:16Z</h3>
<div><p>So I&#39;m currently trying to find the tokens by initializing a new cred database and querying tokens from that ... but it&#39;s still failing. What am I missing?</p>
<p></p></div>
<h2>Student Answer</h2>
<div><p>You might be attempting to get a cred object, rather than the token contained in the cred object. This tripped me up for a while.</p></div>
<h2>Staff Answer</h2>
<div><p>What was the error that the server gave you?</p></div><hr><h1>Is it ok to leak how a username is converted to a pathname?</h1>
<h3>2018-03-15T22:13:42Z</h3>
<div><p>I was wondering in case where the user has name like &#34;../../passwd&#34;, is it the user&#39;s responsibility to make sure each file he/she creates is valid path name, or should the profile_service enforce that? </p>
<p></p>
<p>Specifically, I am wondering if we should modify rpc_get_self, for instance, so that it always returns a sanitized path name. Otherwise, last-visits.py will raise an error complaining that the .dat file path is not valid(since it will be something like &#34;last_visits_../../passwd.dat&#34;). Not returning a sanitized path probably can&#39;t hamper the server in anyway, since it will be an exception in the sandbox. <br /><br /></p>
<p>I am confused as of what the responsibility of the user code is here and what the semantics of get_self really is? </p></div>
<h2>Staff Answer</h2>
<div><p>I really like your question which show how you turn to think like an attacker to make the system more secure. :D Keep doing that.<br />However, this lab doesn&#39;t require you to do that. Just the protect directory for each username is enough.<br /> If you have to handle every single security issue that the lab doesn&#39;t ask you to do so, there could be countless. </p></div><hr><h1>Somehow alphanumeric special characters?</h1>
<h3>2018-03-15T19:44:43Z</h3>
<div><p>I&#39;m creating a directory name using only characters that make it past a .isalnum() check, which I thought would be too restrictive if anything, but I&#39;m failing exercise 10 with a message about special characters in username. What characters that I need to be concerned about could be making it past that check?</p></div>
<h2>Student Answer</h2>
<div>You can probably read the checker code to see which usernames it tests, and try them yourself.</div>
<h2>Followup</h2>
<div><p>I did, but it seems to be trying . and /, both of which return False if i call .isalnum() on them?</p></div>
<h3>Followup Response</h3>
<div><p>instead of checking for special characters, try encoding/hashing </p></div>
<h3>Followup Response</h3>
<div>I think the spec is that users with these names should still be able to use the website.</div>
<h3>Followup Response</h3>
<div><p>ah right i see why i&#39;m failing that check, thanks!</p></div>
<h3>Followup Response</h3>
<div><p>yeah, they were able to use it, the problem was they were also able to use other people&#39;s stuff potentially since my approach just dropped characters and potentially &#34;mapped&#34; multiple users to the same dir</p></div><hr><h1>FAIL Profile granter.py : Zoobar grant check</h1>
<h3>2018-03-15T18:58:49Z</h3>
<div><p>My program passes the tests for hello-user.py, visit-tracker.py, last-visits.py, and xfer-tracker.py, but fails the test for granter.py. After some analysis, I found out that the test is failing because the checker can&#39;t find the phrase &#34;profile.*Thanks for visiting.  I gave you one zoobar&#34; in the html output of the profile. Any thoughts on what might be going on?</p>
<p></p>
<p>I added profile-server.py to zook.conf, I modified chroot-setup.sh to create a directory for profile-server&#39;s socket (/jail/profilesvc), and I changed the uid value in ProfileServer.rpc_run()</p>
<p></p>
<p>Thanks!</p></div>
<h2>Student Answer</h2>
<div>Have you tried running it manually, not in the test? You’ll probably get a more informative error.</div><hr><h1>Open Material</h1>
<h3>2018-03-15T17:55:09Z</h3>
<div><p>Can I use my notebook on the quiz as well or just laptop?</p></div>
<h2>Student Answer</h2>
<div><p>I believe it&#39;s open everything (except for Internet) as one can trivially scan notes to computer. </p></div><hr><h1>Are challenges for part 4 also extra credit?</h1>
<h3>2018-03-14T23:46:17Z</h3>
<div><p>They are not marked as such, as is the challenge for part 2. </p></div>
<h2>Staff Answer</h2>
<div><p>&#64;299</p></div><hr><h1>Exercise 10: dividing up profile file access</h1>
<h3>2018-03-14T21:10:41Z</h3>
<div><p>I wanted to chroot each profile into its own /tmp/username folder, so it can&#39;t access other profile&#39;s files. But this gives me an error, because &#34;No such file or directory exists&#34;. But I also get an error when I try to do os.mkdir with this same folder name. Am I going about this incorrectly?</p></div>
<h2>Staff Answer</h2>
<div>I think the Sandbox() class we provide you already does the chroot-ing so no need to do it yourself!</div>
<h2>Followup</h2>
<div><p>Yeah, I meant that i&#39;m chrooting into a different directory indirectly (like i just define a different userdir variable), but then am not able to see the files I want to see because I don&#39;t set the permissions correctly. But since those files aren&#39;t there when I make the folder, how do I set those permissions when I&#39;m chrooting?</p></div>
<h3>Followup Response</h3>
<div><p>You can set perms when you do os.mkdir()!</p></div>
<h3>Followup Response</h3>
<div><p>You may also want to check who the owner is when you create it!</p></div><hr><h1>OH pushed back 1 hour 3/14</h1>
<h3>2018-03-14T18:27:01Z</h3>
<div>Hey everyone, my OH today (Wed 3/14) will happen at 5:30pm instead of 4:30. Just for today, at the 32-G9 lounge.<div><br /></div><div>Lef</div></div><hr><h1>Machine Learning Project</h1>
<h3>2018-03-14T18:18:20Z</h3>
<div><p>Our project group members all do research in ML (in other application areas), and we&#39;d be interested to do some application in security for the project, but we&#39;re not really sure what would be feasible / useful. Do any of the TAs have experience using ML for security or ideas about applications we could try that would be good for the project?</p></div>
<h2>Staff Answer</h2>
<div>There’s definitely projects you can try, but I don’t want to attest to how feasible they are compared to a more straight forward implementation. Read at your own risk!<div><br /></div><div>A nice implementation of ML is for authentication, you can train on some user input data (keystrokes, accelerometer signal, gyroscope etc) and use that data to authenticate the user later.</div></div>
<h2>Followup</h2>
<div><p>IS&amp;T has lots of data it collects about network traffic and potential security events.  They have too much data, and it would be great to have a system that helps them figure out what are more likely security incidents.  We could put you in touch with the right people at IS&amp;T if you want to build a real system that helps with this.</p></div><hr><h1>Confused about lab1 grade</h1>
<h3>2018-03-13T19:24:34Z</h3>
<div><p>Is there a way to get more detail about what tests I failed in lab1?</p>
<p></p>
<p>I know when I submitted all my tests were passing, but now when I run it again, it seems like the addresses of unlink and exit changed by 0x1000? I took detailed notes at the time and was sure that the address of &#96;unlink&#96; when I ran my original code was 0x40100680; now it seems like it&#39;s 0x40101680 in libc? When I change those two variables in my exploit-4a and 4b everything works again...</p>
<p></p></div>
<h2>Staff Answer</h2>
<div><p>the address of unlink can change if you <br />1. modify the .c</p>
<p>or<br />2. forget to run ./clean-env... or didn&#39;t run it properly such as run ./clean-env... gdb ./zookd <br />rather than running ./clean-env.. ./zookd then attach gdb to the zookd</p></div>
<h2>Followup</h2>
<div><p>Thanks, keep me updated!</p>
<p></p>
<p>I&#39;m still not 100% sure how this could have happened on my VM--I&#39;ve been running ./clean-env before zookd then attaching to gdb (like <code>./clean-env.sh ./zookd-nxstack 8080</code> then <code>gdb -p $(pgrep zookd)</code>), and I should have been originally running the exploit on the unmodified zipped binary. </p></div>
<h3>Followup Response</h3>
<div><p>Hi Kim,<br /><br />I run your submission in vm manually without changing to the grader script but it still doesn&#39;t pass. If you can go to any office hour and verify with the staff that your submission version work correctly on your vm, we should be able to gave you most of your credit back for this points :).</p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/iebp5si0qx78q/jet0jpddg71p/Screen_Shot_20180315_at_5.14.43_PM.png" alt="" /></p>
<p></p>
<p></p></div>
<h3>Followup Response</h3>
<div><p>Please come to any OH by this Thursday for regrade :)  (Regrade extension)</p></div>
<h3>Followup Response</h3>
<div><p>Ah yeah I&#39;ll come before then for sure! There weren&#39;t OH last Friday :( Thanks so much!</p></div>
<h3>Followup Response</h3>
<div><p>You&#39;re very welcome. Specifically come to my OH (if possible) :) </p></div>
<h3>Followup Response</h3>
<div><p>I&#39;ll come on Thursday!</p></div><hr><h1>How to run a profile</h1>
<h3>2018-03-13T19:21:34Z</h3>
<div><p>I&#39;m not sure how to run a profile. Do we just copy and paste the code from the 5 supplied profiles onto the profile text box on the website? Because from what I see, the server just reads the text from user.profile and executes it.</p></div>
<h2>Staff Answer</h2>
<div><p>Yes exactly! <br />Then you can make the script for userA profile executed by search for &#34;userA&#34;.</p></div><hr><h1>Lab1 grade</h1>
<h3>2018-03-13T18:43:50Z</h3>
<div><p>Lab1 grade has been posted in the course website.<br />Please let us know if you don&#39;t see your grade and spent late hours.<br />You can request for regrading within Mar 20th via private piazza. <br />Enjoy your snow day :D</p></div>
<h2>Followup</h2>
<div><p>Thanks for grading the labs. I don&#39;t see a grade for lab1a. I do have a grade for lab1 though. Is that normal? </p></div>
<h3>Followup Response</h3>
<div><p>That&#39;s normal. Only total score for each lab will be available.</p></div><hr><h1>3/13 Tuesday morning OH canceled</h1>
<h3>2018-03-12T18:55:38Z</h3>
<div>Due to snow storm.</div><hr><h1>Studying for Quiz 1</h1>
<h3>2018-03-12T04:52:30Z</h3>
<div><p>Will there be a review session before our first quiz?</p>
<p></p>
<p>Also, what is a recommended way to study? Is going through the material (readings, lecture, lab) and doing the past exams a good strategy? Will there be a huge focus on the papers we have been reading for class preparation (and their details), or is the extent to which they were covered in lecture enough?</p>
<p></p>
<p>Thank you!</p></div>
<h2>Staff Answer</h2>
<div><p>I suggested you review the lecture notes, doing past exams, and read papers especially those you aren&#39;t understand. <br />You may skim through the past exams first to know what kind of question and how much detail you need to know. <br />Mostly, the quiz tested that you understand the concept and can apply them to similar situations, but it is possible that some questions like T/F questions ask you in more detailed manner.<br /><br />Keep in mind that questions involving material in the paper is a fair game, and the exam is open book.<br />Good luck everyone :D</p></div><hr><h1>How should rpc_get_user_info access a user&#39;s profile?</h1>
<h3>2018-03-12T04:48:53Z</h3>
<div><p>The provided code for &#96;ProfileAPIServer&#96; accesses the person database when &#96;rpc_get_user_info&#96; is called in order to access the given user&#39;s profile text, This is causing problems in exercise 11 of lab 2, because &#96;ProfileAPIServer&#96; is no longer running as root, so it doesn&#39;t have access to the user database. There are a few workarounds that I can think of, but I&#39;m not sure whether they are allowed.</p>
<p></p>
<ul><li>Would I be allowed to modify &#96;rpc_get_user_info&#96; so that it simply doesn&#39;t return the user&#39;s profile text? I noticed that none of the example profile scripts use the profile text, so this makes the tests pass, but I&#39;m unsure if that part of the API needs to be preserved.</li><li>My &#96;Person&#96; database doesn&#39;t contain any sensitive info (only usernames and profiles). Would I be allowed to make it readable by any user?</li></ul></div>
<h2>Staff Answer</h2>
<div><p>Since this lab is really design lab: I have no idea what kind of access you give to each UID, dir permissions etc.<br /> I can only give you some advice and you will need to decide based on your design.<br /><br />1.You should consider the way that give you high security and avoid limiting functionality. Even though you didn&#39;t currently use the profile but this support might allow you to make some features?.<br />2. I agree, and again you can further make it even more secured with group. (you will need to decide &gt;&gt; sometimes we don&#39;t need to be that strict haha)<br />3. &#34;same UID as dynamic_svc&#34;: you will have to decide whether this is violate any security, but &#34;it&#39;s the owner of the user database&#34; may mean that it has write access -&gt; do you need to allow profile to do that?</p></div><hr><h1>confusion ex9</h1>
<h3>2018-03-11T19:14:11Z</h3>
<div>So I guess I&#39;m a little confused. Wasn&#39;t it the entire purpose of ex8 to ensure that in order to make a transfer from A to B, we had to have A&#39;s token? And yet in ex9, rpc_xfer is making a transfer from A to B without having any information about A other than a username. Doesn&#39;t this defeat the purpose of ex8? It doesn&#39;t seem super secure...</div>
<h2>Followup</h2>
<div><p>I&#39;m also confused. I don&#39;t know how to pass the token to the rpc_xfer function in a way that won&#39;t break the security sandboxing constraints we already established in ex8.</p></div>
<h3>Followup Response</h3>
<div>See if the explaination above make sense. Remember that Cred access is acceptable as long as you call it in the right place that doesn’t cause more insecure issue.</div>
<h2>Staff Answer</h2>
<div><p>Ex9.<br /><br />That&#39;s doesn&#39;t defeat the purpose of ex8. <br />Two periods to considered when the profilesvc get compromised.<br />1. &#34;Root privilege&#34;<br />You can suddenly realize that compromising that profilesvc during this period give you root permission which allow you to even access&#43;modify all the files including cred.db.  That&#39;s why the exercise 11 make you force the uid to be other less privileged user rather than root after you have &#34;everything&#34; you want from having &#34;root&#34; permission. Think about how you can minimize root situation that the process have access to confidential access.<br /><br />2. &#34;User privilege&#34;<br />The profile service is something you can decide whether to support to user or not; in this lab, we want to give users rights to grant free zoobar for others. If the attacker can attack the service in this period, he/she shouldn&#39;t be able to call cred or force the sender to be other user (&#43; token) that doesn&#39;t have xfer (granting) functionality in their profile.  <br /><br />- Yes you can call bank directly.<br /><br />Ex.10 <br />- Yes you get the idea that the attack can give some username like  ../../../../etc/passwd if we have that vulnerability in our server, so you will need to encode that to avoid special characters.<br /><br />Hope this make sense. Let me know if you still have more question<br /><br /></p></div>
<h2>Followup</h2>
<div>This was super helpful. Thanks!!</div>
<h2>Followup</h2>
<div><p>Ah, I see the point now! And the protection against #1 is basically what we will do in exercise 11. However, I&#39;m a bit confused on what you meant by #2 -- how should we protect against this? Thanks!</p></div><hr><h1>Exercise 5 fail: more than one running process has access to cred.db</h1>
<h3>2018-03-10T21:36:41Z</h3>
<div><p></p><p>What are some sources that can be the cause of the Exercise 5 test case fail: &#34;</p>
<p>more than one running process has access to cred.db&#34;? </p></div>
<h2>Staff Answer</h2>
<div>A hint: creds.db can have 700 permissions for this exercise. </div>
<h2>Followup</h2>
<div><p>I had set auth_svc to be the owner of cred and cred.db with 700 permissions. Is there another process that can have access to cred.db? </p></div>
<h3>Followup Response</h3>
<div><p>And UID only belongs to auth_svc? You can also take a look at check_lab2.py to see how they check for this particular case.</p></div><hr><h1>Issue with running transfer in browser.</h1>
<h3>2018-03-10T20:22:38Z</h3>
<div>I am passing the functionality and exercise 7 test, but any time I try and do a transfer in browser I get a 500 error and this traceback.

/zoobar/debug.py:23 :: __try : caught exception in function transfer:
 Traceback (most recent call last):
  File &#34;/zoobar/debug.py&#34;, line 20, in __try
    return f(*args, **kwargs)
  File &#34;/zoobar/login.py&#34;, line 62, in loginhelper
    return page(*args, **kwargs)
  File &#34;/zoobar/transfer.py&#34;, line 15, in transfer
    zoobars = eval(request.form[&#39;zoobars&#39;])
  File &#34;&#34;, line 1, in 
NameError: name &#39;a&#39; is not defined

Any idea what this might be caused by?</div>
<h2>Followup</h2>
<div>Resolved.</div><hr><h1>are challenges extra credit?</h1>
<h3>2018-03-09T23:21:16Z</h3>
<div><p>do challenges give extra credit or are they for learning more and challenging ourselves?</p></div>
<h2>Staff Answer</h2>
<div>I don’t think they give extra credit, but they do give extra respect points from TAs and Instructors which are priceless :)</div>
<h2>Student Answer</h2>
<div><p>For Challenge 1 in Lab 2, it distinctly states that it&#39;s &#34;(optional) For extra credit&#34;. I don&#39;t typically mind but I spent more late hours doing it and find it kind of frustrating that there&#39;s actually no extra credit associated with it.</p></div>
<h2>Followup</h2>
<div><p>For Challenge 1 in Lab 2, it distinctly states that it&#39;s &#34;(optional) For extra credit&#34;. I don&#39;t typically mind but I spent more late hours doing it and find it kind of frustrating that there&#39;s actually no extra credit associated with it.</p></div>
<h3>Followup Response</h3>
<div><p>I remember getting more than 100% scores on labs I did challenges last year. <br />I also don&#39;t think it will be different for this year, but to be sure let me double check with Nickolai, Frans, and also Lef again tomorrow.</p></div>
<h2>Followup</h2>
<div><p>Do we get extra credit just for Challenge 1 or all the challenges?</p></div>
<h3>Followup Response</h3>
<div><p>You can do any challenges for extra credit or multiple, but we only give credit for one challenge for each &#34;lab&#34; (not each part).</p></div>
<h3>Followup Response</h3>
<div><p>Ah okay, so extra credit is a boolean (per lab), you either get it or you don&#39;t, and you get it if you do any of the challenges in a given lab.</p></div><hr><h1>When is our quiz</h1>
<h3>2018-03-09T22:16:11Z</h3>
<div><p>Is it during class time or is it an evening quiz?</p></div>
<h2>Staff Answer</h2>
<div><p>During class hours.</p></div><hr><h1>New server file can&#39;t find python2</h1>
<h3>2018-03-09T20:45:16Z</h3>
<div><p>I created a new python file called honey-server.py meant to run as a separate service to complete the challenge. I set it with the 775 permission which should allow it to execute. I included the line &#34;#!/usr/bin/env python2&#34; at the top just like the other server .py files have.</p>
<p></p>
<p>However, when I run the server, I get an error</p>
<p><code>/usr/bin/env: python2: No such file or directory<br /><br /></code></p>
<p>And it looks like any subsequent calls that my honey-server.py makes to python 2 (like calling functions in python2.7/socket.py) fail.</p>
<p></p>
<p>Is there anything else I need to do to make a new server .py work? (I&#39;ve done the same things in zook.conf and chmod_setup.sh that I did for the auth-server and bank-sever.</p></div>
<h2>Student Answer</h2>
<div><p>oh god, the error is actually python2/r no such file or directory. I think the shell is interpreting a return line in the file (as saved by the Sublime application) and that is throwing it off. Gonna look into it....</p></div>
<h2>Followup</h2>
<div><p>I guess the solution is to use Linux or Mac :O</p>
<p></p>
<p>It does seem a lot of things don&#39;t work on Windows though... For the ML classes the Windows people really struggled with trying to get Pytorch to work.</p></div>
<h2>Followup</h2>
<div>&lt;removed&gt;</div>
<h2>Staff Answer</h2>
<div><span style="background-color:#fff">There is a dos2unix utility to do that, or you can just use sed. Glad you figured it out </span></div><hr><h1>late hours?</h1>
<h3>2018-03-09T20:04:24Z</h3>
<div><p>Since lab 1 hasn&#39;t been graded yet (so no late hours show up), I was wondering how late hours are counted. Also, since late hours are counted for each lab, rather than each subpart, I was wondering if late hours is:</p>
<p></p>
<p>late_hours is list(float)</p>
<ul><li>sum(floor(late hours))</li><li>sum(ceil(late hours))</li><li>sum(round(late hours))</li><li>floor(sum(late hours))</li><li>ceil(sum(late hours))</li><li>round(sum(late hours))</li></ul>
<p></p>
<p>Thanks!</p></div>
<h2>Staff Answer</h2>
<div>I think floor(sum(late hours)) is the most fair option.</div><hr><h1>Can&#39;t start server</h1>
<h3>2018-03-09T18:46:38Z</h3>
<div><p>Keep getting this output whenever I try and run the server. What is this error?</p>
<p><br />httpd&#64;vm-6858:~/lab$ sudo ./zookd zook.conf<br />zookd: recvmsg: Socket operation on non-socket<br />zookd: recvfd sockfd: Socket operation on non-socket</p>
<p></p>
<p></p></div>
<h2>Staff Answer</h2>
<div><p>./zookld not ./zookd :)</p></div><hr><h1>Storing a list in the database</h1>
<h3>2018-03-09T18:36:22Z</h3>
<div><p>I implemented honeywords, but currently store each honeyword as a separate field (password, password1, password2, etc.) This works, but is not very scalable. I was wondering if it is possible to store the list in just one field (password)? One way I was thinking could be using json.dumps and json.loads to convert to and from strings. Are there better/more common ways?</p></div>
<h2>Followup</h2>
<div><p> Not actually helpful, but json sounds soooo useful. Thanks! I didn&#39;t think of that</p>
<p></p>
<p>I was thinking of storing all the pw&#39;s concatenated and also storing the indices at which to slice the pw&#39;s, but it would have been really troublesome. </p></div>
<h2>Staff Answer</h2>
<div><p>Can you think of a way to use a single column for &#34;password&#34; without concat, but you still be able to support honeychecker (multiple passwords)?<br />Hint: Does each user really need to have &#34;only a single row&#34; in the password table?</p></div><hr><h1>unable to open database file</h1>
<h3>2018-03-09T16:31:44Z</h3>
<div><p></p><pre>sqlalchemy.exc.OperationalError: (pysqlite2.dbapi2.OperationalError) unable to open database file [SQL: u&#39;INSERT INTO person (username, zoobars, profile) VALUES (?, ?, ?)&#39;] [parameters: (u&#39;a&#39;, 10, &#39;&#39;)</pre>
<p></p>
<p>I&#39;ve set the owner to dynamic_svc and the group to one that contains auth_svc, but it still cannot access the Person DB. I thought it was a permissions error, but I guess not?</p>
<p></p>
<pre>Traceback (most recent call last):
  File &#34;/zoobar/auth-server.py&#34;, line 21, in &lt;module&gt;
    s.run_sockpath_fork(sockpath)
  File &#34;/zoobar/rpclib.py&#34;, line 67, in run_sockpath_fork
    self.run_sock(conn)
  File &#34;/zoobar/rpclib.py&#34;, line 43, in run_sock
    ret = m(**kwargs)
  File &#34;/zoobar/auth-server.py&#34;, line 13, in rpc_register
    return auth.register(username, password)
  File &#34;/zoobar/auth.py&#34;, line 38, in register
    persondb.commit()
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py&#34;, line 813, in commit
    self.transaction.commit()
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py&#34;, line 392, in commit
    self._prepare_impl()
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py&#34;, line 372, in _prepare_impl
    self.session.flush()
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py&#34;, line 2027, in flush
    self._flush(objects)
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py&#34;, line 2145, in _flush
    transaction.rollback(_capture_exception=True)
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/util/langhelpers.py&#34;, line 60, in __exit__
    compat.reraise(exc_type, exc_value, exc_tb)
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/orm/session.py&#34;, line 2109, in _flush
    flush_context.execute()
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py&#34;, line 373, in execute
    rec.execute(self)
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/orm/unitofwork.py&#34;, line 532, in execute
    uow
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/orm/persistence.py&#34;, line 174, in save_obj
    mapper, table, insert)
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/orm/persistence.py&#34;, line 767, in _emit_insert_statements
    execute(statement, multiparams)
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py&#34;, line 914, in execute
    return meth(self, multiparams, params)
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/sql/elements.py&#34;, line 323, in _execute_on_connection
    return connection._execute_clauseelement(self, multiparams, params)
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py&#34;, line 1010, in _execute_clauseelement
    compiled_sql, distilled_params
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py&#34;, line 1146, in _execute_context
    context)
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py&#34;, line 1341, in _handle_dbapi_exception
    exc_info
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/util/compat.py&#34;, line 200, in raise_from_cause
    reraise(type(exception), exception, tb=exc_tb)
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py&#34;, line 1139, in _execute_context
    context)
  File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py&#34;, line 450, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (pysqlite2.dbapi2.OperationalError) unable to open database file [SQL: u&#39;INSERT INTO person (username, zoobars, profile) VALUES (?, ?, ?)&#39;] [parameters: (u&#39;a&#39;, 10, &#39;&#39;)]
/zoobar/debug.py:23 :: __try : caught exception in function login:
 Traceback (most recent call last):
  File &#34;/zoobar/debug.py&#34;, line 20, in __try
    return f(*args, **kwargs)
  File &#34;/zoobar/login.py&#34;, line 81, in login
    cookie = user.addRegistration(username, password)
  File &#34;/zoobar/login.py&#34;, line 29, in addRegistration
    token = auth_client.register(username, password)
  File &#34;/zoobar/auth_client.py&#34;, line 14, in register
    ret = c.call(&#39;register&#39;, username=username, password=password)
  File &#34;/zoobar/rpclib.py&#34;, line 81, in call
    return parse_resp(self.lines.next())
StopIteration</pre>
<p></p></div>
<h2>Followup</h2>
<div><p>I don&#39;t think it&#39;s a permission error, because I tried with chmod 777 and it still didn&#39;t work.</p></div>
<h3>Followup Response</h3>
<div><p>Did you make sure the surrounding directories had the right permissions? You might also want to check your code for typos when creating the dbs (accidentally carrying over the tablename, etc.) because I remember I had this issue and I solved it without too much permissions changing,</p></div>
<h2>Staff Answer</h2>
<div><p>See if &#64;255 help.</p></div>
<h2>Followup</h2>
<div><p>They&#39;re 755 permissions along the way.</p>
<p>So it should be able to read and execute any directories, regardless of what process it is.</p></div>
<h3>Followup Response</h3>
<div><p>What are the permissions for the db file itself? If the auth_svc is the group, the group needs more permissions than in previous exercises.</p></div>
<h3>Followup Response</h3>
<div><p>660</p>
<p></p>
<p>so read and write</p></div>
<h3>Followup Response</h3>
<div><p>resolved, needed 775 permissions</p>
<p></p>
<p>i don&#39;t get it, why does auth_svc need to write the directory file for person?</p></div>
<h3>Followup Response</h3>
<div><p>When a person first registers, you need to create their row in cred db and person db because they dont exist in either yet</p></div><hr><h1>multiple values for keyword arguments RPC</h1>
<h3>2018-03-09T15:33:45Z</h3>
<div><p></p><pre>TypeError: rpc_register() got multiple values for keyword argument &#39;username&#39;
/zoobar/debug.py:23 :: __try : caught exception in function login:
 Traceback (most recent call last):
  File &#34;/zoobar/debug.py&#34;, line 20, in __try
    return f(*args, **kwargs)
  File &#34;/zoobar/login.py&#34;, line 81, in login
    cookie = user.addRegistration(username, password)
  File &#34;/zoobar/login.py&#34;, line 29, in addRegistration
    token = auth_client.register(username, password)
  File &#34;/zoobar/auth_client.py&#34;, line 14, in register
    ret = c.call(&#39;register&#39;, username=username, password=password)
  File &#34;/zoobar/rpclib.py&#34;, line 81, in call
    return parse_resp(self.lines.next())
StopIteration</pre>
<p>Any ideas why this is happening? Is username not allowed as a keyword argument?</p></div>
<h2>Student Answer</h2>
<div><p>You may have forgotten to add the <tt>self</tt> parameter to the methods for the auth RPC server.</p>
<p></p></div><hr><h1>RPC data</h1>
<h3>2018-03-09T14:58:14Z</h3>
<div><p>Can the arguments and return value for a RPC call be arbitrary Python objects (including None) or are they restricted to strings?</p></div>
<h2>Student Answer</h2>
<div><p>Any Python object, as far as I can tell.</p></div><hr><h1>Transfer database permissions</h1>
<h3>2018-03-09T14:47:01Z</h3>
<div><p>Is it okay if something other than the bank_svc can read from the Transfer database (but not write to it)</p>
<p></p>
<p>I know I can pass the tests even if I allow something other than bank_svc to read the Transfer database, but I&#39;m wondering if this is the intent of the lab.</p>
<p></p>
<p>Thanks!</p></div>
<h2>Staff Answer</h2>
<div><p>According to the handout, &#34;As long as only the <tt>bank_svc</tt> service can modify the <tt>Bank</tt> and <tt>Transfer</tt> databases&#34;, my interpretation is that it maybe ok. However, it might be still a good practice to not allow other compromised services to see &#34;all&#34; transactions happen in Transfer db or only allow the services that need read to read. </p></div><hr><h1>database in /home/httpd/lab/zoobar/db</h1>
<h3>2018-03-09T13:55:54Z</h3>
<div><p>Do the databases in /home/httpd/lab/zoobar/db need to be updated (to split Cred and Bank off from Person)? It seems that the zoodb.py only sets up /jail/zoobar/db not /home/httpd/lab/zoobar/db. Does the DB layout in /home/httpd/lab/zoobar/db need to change for the exercises? If so, do we need to manually change them with sqlite?</p>
<p></p>
<p>Or changing the DB layout in /jail with zoodb.py sufficient?</p></div>
<h2>Student Answer</h2>
<div><span style="background-color:#fff">I think since the zoobar site is actually run from /jail, just changing /jail should be fine... also if &#96;sudo make check&#96; passes, you’re good.</span></div><hr><h1>Lab 2 - any adhoc OH today?</h1>
<h3>2018-03-09T12:23:39Z</h3>
<div><p>thank you </p></div>
<h2>Staff Answer</h2>
<div><p>We have conversation regarding overtime OH and emergency OH since the second week that we shouldn&#39;t do any overtime OH or emergency OH. I&#39;m so sorry, but I&#39;m here to help. If you have very specific question that might spoil other students, you can also post privately :) </p></div><hr><h1>Serializing sqlalchemy object to JSON</h1>
<h3>2018-03-09T08:26:29Z</h3>
<div><p>I&#39;m a bit confused about how to serialize an sqlalchemy object to JSON. Lots of people have pointed to this link (<a href="https://stackoverflow.com/questions/1958219/convert-sqlalchemy-row-object-to-python-dict">https://stackoverflow.com/questions/1958219/convert-sqlalchemy-row-object-to-python-dict</a>) but I&#39;m not sure how to use it.</p>
<p></p>
<p>In the link they propose converting an sqlalchemy object into a dictionary (which I believe is serializable) as follows.</p>
<pre>def row2dict(row):
    d = {}
    for column in row.__table__.columns:
        d[column.name] = str(getattr(row, column.name))

    return d</pre>
<p>I tried to use this &#96;row2dict&#96; function in &#96;get_log&#96; (bank.py), but I got the following error: AttributeError: &#39;Query&#39; object has no attribute &#39;__table__&#39;</p>
<p></p>
<p>Here&#39;s my code in &#96;get_log&#96;</p>
<pre>[bank.py]<br />def get_log(username):<br />	db = transfer_setup()<br />	return row2dict(db.query(Transfer).filter(or_(Transfer.sender==username, Transfer.recipient==username)))</pre>
<p></p>
<p>I&#39;ve never worked with sqlalchemy objects before so there&#39;s probably something very wrong with what I&#39;m doing. Is there anything you&#39;d recommend reading or looking at to figure out the source of this bug?</p></div>
<h2>Student Answer</h2>
<div>Query does not have a __table__ attribute, but some other related object in the function does, I think</div>
<h2>Staff Answer</h2>
<div><p>So the real issue is actually this.</p>
<pre>row2dict(row)</pre>
<p>expect the &#34;row&#34; as an argument not &#34;rows&#34;<br />As you can observe from </p>
<pre>get_log()</pre>
<p>that it will return multiple rows: each correspond to each transfer ex. sender, recipient, amount, ...<br /><br />After you fix this, you should be good to go :)<br /><br /></p></div>
<h2>Followup</h2>
<div><p>What do you mean??</p>
<p>When I print the &#34;db.query(Transfer).filter(or_(Transfer.sender==username,Transfer.recipient==username))&#34;</p>
<p>it outputs the following sql querry:</p>
<p>&#34;SELECT transfer.id AS transfer_id, transfer.sender AS transfer_sender, transfer.recipient AS transfer_recipient, transfer.amount AS transfer_amount, transfer.time AS transfer_time <br />FROM transfer <br />WHERE transfer.sender = :sender_1 OR transfer.recipient = :recipient_1&#34;<br /><br /></p>
<p></p></div>
<h3>Followup Response</h3>
<div>This query is a python Generator object, it is executed lazily when next() is called on it either explicitly of implicitly (ie:<div>“for row in query”</div><div>)</div><div><br /></div><div>That’s why you can’t see the actual rows until you iterate through them.</div><div><br /></div><div>More on generators: </div><div><a href="https://wiki.python.org/moin/Generators">https://wiki.python.org/moin/Generators</a></div><p></p><p></p></div><hr><h1>Exercise 7</h1>
<h3>2018-03-09T04:57:26Z</h3>
<div><p>I&#39;m getting a TypeError when I try to create a socket with the following line of python.</p>
<pre>[bank-server.py]<br />s.run_sockpath_fork(sockpath)  # sockpath = /banksvc/sock</pre>
<p>Here&#39;s the traceback</p>
<pre>Traceback (most recent call last):<br />  File &#34;/zoobar/bank-server.py&#34;, line 29, in &lt;module&gt;<br />    s.run_sockpath_fork(sockpath)<br />  File &#34;/zoobar/rpclib.py&#34;, line 67, in run_sockpath_fork<br />    self.run_sock(conn)<br />  File &#34;/zoobar/rpclib.py&#34;, line 44, in run_sock<br />    sock.sendall(format_resp(ret) &#43; &#39;\n&#39;)<br />  File &#34;/zoobar/rpclib.py&#34;, line 20, in format_resp<br />    return json.dumps(resp)<br />  File &#34;/usr/lib/python2.7/json/__init__.py&#34;, line 244, in dumps<br />    return _default_encoder.encode(obj)<br />  File &#34;/usr/lib/python2.7/json/encoder.py&#34;, line 207, in encode<br />    chunks = self.iterencode(o, _one_shot=True)<br />  File &#34;/usr/lib/python2.7/json/encoder.py&#34;, line 270, in iterencode<br />    return _iterencode(o, 0)<br />  File &#34;/usr/lib/python2.7/json/encoder.py&#34;, line 184, in default<br />    raise TypeError(repr(o) &#43; &#34; is not JSON serializable&#34;)<br />TypeError: &lt;sqlalchemy.orm.query.Query object at 0xb7488a0c&gt; is not JSON serializable</pre>
<p></p>
<p>I&#39;m pretty sure I initialized the socket for the bank service correctly. Below are the critical sections of zook.conf and chroot-setup.sh</p>
<pre>zook.conf<br />[zook]<br />	extra_svcs = echo_svc, auth_svc, bank_svc<br /><br />[bank_svc]
	cmd = /zoobar/bank-server.py
	args = /banksvc/sock
	dir = /jail
	uid = 61012
	gid = 61012<br /><br />chroot-setup.sh<br />create_socket_dir /jail/banksvc 61012:61012 755</pre>
<p>Any thoughts on what might be going on?</p></div>
<h2>Followup</h2>
<div><p>I am facing the same issue. Do you have a solution now?</p></div>
<h2>Followup</h2>
<div><p>Had the same problem. Solved it by calling get_log() directly (not as a rpc), because get_log() returns a query object. Alternatively, you can <a href="https://stackoverflow.com/questions/1958219/convert-sqlalchemy-row-object-to-python-dict" target="_blank">manually transform the query object into json</a></p></div>
<h2>Staff Answer</h2>
<div><p>Take a look at &#64;246 &#64;285<br /> It is an issue with the RPC socket transferring data where your data is the Sqlalchemy.orm.query.Query type that python doesn&#39;t recognize how to serialize as json</p></div><hr><h1>Grades for earlier labs</h1>
<h3>2018-03-09T03:52:32Z</h3>
<div><p>When are the grades for earlier labs gonna be released? If the grading is automated, it there a reason why its taking so long?</p>
<p>It would be really helpful if you could release the grades for one lab before the next lab is due, so we can correct any problems in our solution and don&#39;t submit the same mistakes again.</p>
<p>If you point out flaws in my code a month after I submit it how is it gonna aid my learning?</p></div>
<h2>Staff Answer</h2>
<div>We’re doing our best to grade lab1, it should be out soon. As for lab2, I believe grading will be orthogonal to lab1 so past mistakes will not affect your grade.</div>
<h2>Followup</h2>
<div>The grading is only partially automated.</div><hr><h1>favicon.ico</h1>
<h3>2018-03-09T02:39:39Z</h3>
<div><p>I get the following error: zookd: [8108] Request failed: Error dispatching request: /favicon.ico (because I only dispatch URLs that start with zoobar/...) </p>
<p>But it doesn&#39;t seem to be much of a problem (and the code passes the tests)...Should I worry about this, and if so, what can I do to fix it?</p></div>
<h2>Student Answer</h2>
<div><p>It&#39;s because favicon.ico is in the top level (so lab/favicon.ico). It&#39;s that cute icon on the left side of the window tab (so like the blue and white p for piazza, the red play button for youtube).</p>
<p></p>
<p>it&#39;s nice for aesthetics, so you could try something to allow your programs to dispatch the favicon. Don&#39;t know if the  more rigorous tests check for this, but it is only an aesthetic nit at most.</p></div>
<h2>Followup</h2>
<div><p>I tried what Kevin suggested and am no longer seeing an error about the favicon, but I&#39;m also not seeing the icon actually appear when I run the web server. What does the icon actually look like, and any ideas for why I&#39;m still not seeing it?</p></div>
<h3>Followup Response</h3>
<div><p>Resolved: I wasn&#39;t copying the file to /jail</p></div><hr><h1>Everything passing except exercise 4</h1>
<h3>2018-03-09T01:25:54Z</h3>
<div><p>What services are supposed to be allowed to access person.db? Currently, I change person.db using auth_svc and bank_svc, so the permissions in chroot-setup.sh allow the others to read and write person.db. However, if I do this, I get the error</p>
<pre>person.db is directly accessible</pre>
<p>Should I be rewriting the code to make it so that auth_svc and bank_svc cannot access person.db?</p></div>
<h2>Staff Answer</h2>
<div>Use group ids instead of allowing Other to read/write the database </div><hr><h1>Bad file descriptor when trying to run web app?</h1>
<h3>2018-03-09T00:50:49Z</h3>
<div><p>I&#39;m currently passing all test cases up through Exercise 7, as well as the app functionality tests. When I try to run the web app I&#39;m getting bad file descriptor errors-- how can I fix this?</p>
<p></p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/ieboj0psk4v3lc/jej82qlbk0nx/Screen_Shot_20180308_at_7.47.41_PM.png" alt="" /></p></div>
<h2>Staff Answer</h2>
<div>The command to run server for lab2 is<div><pre><span style="font-weight:bold;background-color:#fff">sudo ./zookld zook.conf</span></pre></div><div>Clean env is for making stack address deterministic and zookld = zook launcher used in lab 2 to launch all the services instead of executing the zookd directly.</div><div><br /></div><div><br /></div></div><hr><h1>Socket connection refused error</h1>
<h3>2018-03-08T23:38:07Z</h3>
<div><p>I&#39;ve been debugging this error for several days, can someone please help?</p>
<p>I couldn&#39;t figure out how to fix it, so I scrapped my code and started over from scratch but still get this error:</p>
<p></p>
<p>Traceback (most recent call last):<br />  File &#34;/zoobar/auth-server.py&#34;, line 24, in &lt;module&gt;<br />    s.run_sockpath_fork(sockpath)<br />  File &#34;/zoobar/rpclib.py&#34;, line 72, in run_sockpath_fork<br />    os.waitpid(pid, 0)<br />OSError: [Errno 10] No child processes<br />zookd: Forward /zoobar/index.cgi/ to service 1<br />/zoobar/debug.py:23 :: __try : caught exception in function check_token:<br /> Traceback (most recent call last):<br />  File &#34;/zoobar/debug.py&#34;, line 20, in __try<br />    return f(*args, **kwargs)<br />  File &#34;/zoobar/auth_client.py&#34;, line 22, in check_token<br />    with rpclib.client_connect(&#39;/authsvc/sock&#39;) as c:<br />  File &#34;/zoobar/rpclib.py&#34;, line 96, in client_connect<br />    sock.connect(pathname)<br />  File &#34;/usr/lib/python2.7/socket.py&#34;, line 228, in meth<br />    return getattr(self._sock,name)(*args)<br />error: [Errno 111] Connection refused<br /><br />zookd: Forward /zoobar/index.cgi/login to service 1<br />zookd: Forward /zoobar/index.cgi/login to service 1<br />/zoobar/debug.py:23 :: __try : caught exception in function register:<br /> Traceback (most recent call last):<br />  File &#34;/zoobar/debug.py&#34;, line 20, in __try<br />    return f(*args, **kwargs)<br />  File &#34;/zoobar/auth_client.py&#34;, line 15, in register<br />    with rpclib.client_connect(&#39;/authsvc/sock&#39;) as c:<br />  File &#34;/zoobar/rpclib.py&#34;, line 96, in client_connect<br />    sock.connect(pathname)<br />  File &#34;/usr/lib/python2.7/socket.py&#34;, line 228, in meth<br />    return getattr(self._sock,name)(*args)<br />error: [Errno 111] Connection refused<br /><br />zookfs: recvfd: Success<br /><br /></p></div>
<h2>Staff Answer</h2>
<div>What happens if you give the /authsvc directory 777 permissions recursively? Still getting the same error?</div><hr><h1>Exercise 10 Permission error</h1>
<h3>2018-03-08T22:29:34Z</h3>
<div><p>I changed rpc_run such that each user has their own folder inside of /tmp. But I got permission error in last-visits.py. I have been stuck at this problem for very long now. Any hints would be highly appreciated.</p>
<p></p>
<p>Thanks!</p></div>
<h2>Staff Answer</h2>
<div>Hm what’s the error look like? Maybe try creating a dir /tmp/myPermissibleDir/user1, user2 etc and give it 770 permissions?</div>
<h2>Followup</h2>
<div><p>Here is part of the error:</p>
<p></p>
<p>File &#34;/zoobar/profile-server.py&#34;, line 95, in &lt;lambda&gt;<br /> File &#34;/zoobar/profile-server.py&#34;, line 67, in run_profile<br /> File &#34;&lt;string&gt;&#34;, line 27, in &lt;module&gt;<br />IOError: [Errno 13] Permission denied: u&#39;last_visits_test1.dat&#39;</p>
<p></p>
<p>Here is the permission for /tmp/user1</p>
<p></p>
<p>drwxr-xr-x  2 root root 4096 Mar  8 21:41 test1</p>
<p></p>
<p>Should I change the owner of the directory?</p></div>
<h3>Followup Response</h3>
<div><p>* of /tmp/test1</p></div>
<h2>Followup</h2>
<div>The problem should be obvious after you did ls -l and saw what bits are set, I think you know what’s wrong :)</div>
<h3>Followup Response</h3>
<div><p>I think the output above looks fine? Why do you want to make it 770?</p></div>
<h3>Followup Response</h3>
<div>It does not look fine, as it is only root can write to that directory.</div>
<h2>Followup</h2>
<div><p>I&#39;ve been getting the same error.</p>
<p></p>
<p>I created a directory &#39;userfiles&#39; under &#39;tmp&#39; where I&#39;m storing the user profile files:</p>
<pre>mkdir -p /jail/tmp/userfiles<br />chmod a&#43;rwxt /jail/tmp/userfiles</pre>
<p></p>
<p>When I run ls -la /jail/tmp/userfiles, I get:</p>
<pre>ls: cannot access &#39;/jail/tmp/userfiles&#39;: No such file or directory</pre>
<p></p>
<p>When I run ls -la /jail/tmp/, root seems to have full access:</p>
<pre>drwxrwxrwt  2 root root 4096 Mar  3 23:10 .</pre>
<p>I also tried specifying the permission of root and the forked process to 777 in chroot-setup.sh:</p>
<pre>set_perms 80000:80000 777 /jail/tmp/userfiles<br />set_perms 0:0 777 /jail/tmp/userfiles</pre>
<p></p>
<p>I&#39;m still getting the same error, and I&#39;m not really sure what to do next.</p></div>
<h3>Followup Response</h3>
<div><p>Following up, I was getting</p>
<pre>ls: cannot access &#39;/jail/tmp/userfiles&#39;: No such file or directory</pre>
<p>because I forgot to run &#39;make setup&#39; but I&#39;m still having the same error.</p>
<p></p>
<p>-la /jail/tmp/userfiles now gives me:</p>
<pre>drwxrwxrwx 2 root root 4096 Mar 14 18:51 .</pre>
<p>so root should be able to access the directory...?</p></div>
<h3>Followup Response</h3>
<div><p>Also tried:</p>
<pre>set_perms 80000:0 777 /jail/tmp/userfiles</pre>
<p>because I realized we&#39;re only setting the uid, but no luck</p></div>
<h3>Followup Response</h3>
<div><p>Are you creating new directories for each user? Can you ls /jail/tmp/userfiles to check that the folders you created exits? </p></div>
<h2>Followup</h2>
<div><p>Should this be /tmp, or /jail/tmp? I&#39;m having similar issues and noticed posters above have these differing dirs.</p></div>
<h3>Followup Response</h3>
<div><p>I&#39;m using /tmp (that&#39;s where I thought these are going).</p></div>
<h3>Followup Response</h3>
<div><p>Also, I can&#39;t see the new directory (eg &#39;/tmp/test1&#39;) when I cd into /tmp, even though I print os.path.exists(userdir) and it returns True ... any idea what I could be doing wrong?</p></div>
<h3>Followup Response</h3>
<div><p>1. If you&#39;re in profile-server.py, using &#39;/tmp&#39; is fine because at that point we&#39;re running from the /jail directory. If you are changing in chroot-setup.sh, then you would need to use /jail/tmp instead. </p>
<p></p>
<p>2. I might be misunderstanding, but if you cd in to /tmp, what happens if you try to list the directories in that directory at that point in time? One way to debug might be to use the log() function  &#43; python&#39;s os module to do a ls to log what the process is seeing</p></div><hr><h1>Lab 2 RPC guide</h1>
<h3>2018-03-08T21:30:11Z</h3>
<div>This guide was written by Jon Gjengset, a 6.858 TA in previous years.

To set up an RPC service, you need two components, an RPC server and (one or more) RPC clients. In the case of the echo service, the server is in <tt>echo-server.py</tt>, and the client is echo.py. The way the two communicate is by using a <em>socket</em>; essentially a file that allows bidirectional communication between processes. In many ways, a socket functions similar to binding/connecting to a TCP port.

When the RPC server starts, it binds to the socket file given by the arguments passed when the process is started (see the <tt>args</tt> parameter set to <tt>/echosvc/sock</tt> in <tt>zook.conf</tt>), and starts listening to incoming requests. An RPC client connects to the server&#39;s socket by opening the socket file that the server is listening to, and then issuing read/write calls on that file handle. The RPC library does this behind the scenes when you call <tt>rpclib.client_connect</tt>. Consider the following code fragment from <tt>echo.py</tt> that calls <tt>echo-server.py</tt>:
<pre>def echo():
    with rpclib.client_connect(&#39;/echosvc/sock&#39;) as c:
        ret = c.call(&#39;echo&#39;, s=request.args.get(&#39;s&#39;, &#39;&#39;))
        return render_template(&#39;echo.html&#39;, s=ret)</pre>
You&#39;ll notice i that the same file is passed to this function as the one <tt>echo-server.py</tt> is instructed to bind to by <tt>zook.conf</tt>. If you wanted to connect to some other RPC service, you would simply change the path in the <tt>client_connect</tt> call (assuming an RPC server has bound to that file already).

Note also that there is no mention of <tt>rpc_echo()</tt> in <tt>echo.py</tt> (the function in <tt>echo-server.py</tt> that performs the echo). This is because <tt>rpc_echo</tt> is never invoked locally by the client. Instead, the RPC library will send a request through the open socket to the server with the name of the function it wants to execute (&#34;echo&#34;), as well as the arguments (s=...). The RPC server will then look for a function called <tt>rpc_echo</tt> in the RPC server class (<tt>EchoRpcServer</tt>), call it with the given arguments, collect the return value, and ship it back to the caller. The caller will then report this back as the return value of <tt>c.call</tt>.

So, if you wanted to write your own server, we can now see what components you would need:
<ul><li>A server file with a class that extends <tt>rpclib.RpcServer</tt> similar to <tt>EchoRpcServer</tt> in <tt>echo-server.py</tt>
</li><li>An entry in <tt>zook.conf</tt> to launch this new RPC server
</li><li>A socket file that can be used to contact that RPC server (passed through <tt>args</tt> in the service entry, as well as to <tt>rpclib.client_connect</tt>)
</li><li>Definitions of <tt>rpc_*</tt> functions inside the RPC server class
</li></ul>

Calling the functions in the new server would be done similarly to how the echo server function is invoked, except with a different socket file, and different function name/arguments.

Note that you will need to explicitly create the socket file in <tt>chroot-setup.sh</tt>. You should look at how this is done for <tt>/echosvc/sock</tt>.
Remember that <tt>create_socket_dir</tt>, as the name implies, only creates the directory for the socket. Creating a file manually called &#34;sock&#34; in that directory will not create a socket file (which is a special kind of file), but just a regular file without the ability to do socket-y things. If you create the socket file yourself, you&#39;ll likely just see &#34;connection refused&#34; messages when trying to use it. The actual socket file is created by the RPC server when it starts. You should make sure that you&#39;ve written a service entry in <tt>zook.conf</tt>, that the service entry has the path to where you want the socket file to be as its argument (<tt>args=</tt>), <strong>and that you&#39;ve added that service to the list of services to start</strong> (see <tt>extra_svcs</tt> at the top of <tt>zook.conf</tt>).

One useful thing to mention is that you can pass multiple (named) arguments to an RPC command like so:

<pre>with rpclib.client_connect(&#39;/echosvc/sock&#39;) as c:
    return c.call(&#39;echo&#39;, firstarg=&#39;abc&#39;, secondarg=&#39;def&#39;)</pre>
where

<pre>def rpc_echo(self, firstarg, secondarg):</pre>

Another useful trick is connecting to an RPC service directly from an interactive python prompt (by running <code>python</code> on the command line. This will come in particularly handy for Exercise 8. First, start the zoobar application normally, create users, etc. Then, in another terminal, run:

<pre>~/lab/zoobar $ sudo python2
&gt;&gt;&gt; import rpclib
&gt;&gt;&gt; with rpclib.client_connect(&#39;/jail/banksvc/sock&#39;) as c:
...     print(c.call(&#39;transfer&#39;, sender=&#39;victim&#39;, recipient=&#39;attacker&#39;, zoobars=10, token=&#39;wrong_token&#39;))
...
False
&gt;&gt;&gt; with rpclib.client_connect(&#39;/jail/banksvc/sock&#39;) as c:
...     print(c.call(&#39;transfer&#39;, sender=&#39;user1&#39;, recipient=&#39;user2&#39;, zoobars=10, token=&#39;right_token_for_user1&#39;))
...
True</pre>

For exercise 8 specifically, there are several ways of getting the right token for a user, but one that is particularly straightforward is to log in in your browser, press Ctrl&#43;Shift&#43;I (brings up the developer console), and then type <tt>document.cookie</tt> at the command prompt. The token will be the string following the <tt>#</tt>.</div>
<h2>Followup</h2>
<div><p>Another, perhaps less elegant way to get the token is</p>
<pre>sudo sqlite3 /jail/zoobar/db/cred/cred.db &#39;select token from cred where username=&#34;&lt;username&gt;&#34;&#39;</pre>
<p></p></div>
<h3>Followup Response</h3>
<div>Works for me!</div><hr><h1>Exercise 6: Storing salts in database</h1>
<h3>2018-03-08T21:08:49Z</h3>
<div><p>I get the following error when trying to store the salt as str(os.urandom(8)).</p>
<p></p>
<pre>sqlalchemy.exc.ProgrammingError: (pysqlite2.dbapi2.ProgrammingError) You must not use 8-bit bytestrings unless you use a text_factory that can interpret 8-bit bytestrings (like text
_factory = str). It is highly recommended that you instead just switch your application to Unicode strings. [SQL: u&#39;INSERT INTO cred (username, password, token, salt) VALUES (?, ?,
?, ?)&#39;] [parameters: (u&#39;test1&#39;, &#39;7834ea6369cd8d3f2bbc92547c19c8c865470dbcf434866d5acfe42d7ffb9b40&#39;, None, &#39;{!\xc4-\\T0\\&#39;)]</pre>
<p></p>
<p>I also got a similar error with os.urandom(8) without casting to a string. How should I try storing the salt in the database?</p></div>
<h2>Staff Answer</h2>
<div>Try casting it to a string via base64 encoding </div>
<h2>Student Answer</h2>
<div><p>I did </p>
<pre>str(os.urandom)</pre>
<div>and it gave me no error?</div></div><hr><h1>installing python packages</h1>
<h3>2018-03-08T21:01:36Z</h3>
<div><p>I installed attrdict to help change the return of the sqlalchemy to something serializable. Will this cause grading scripts to fail?</p></div>
<h2>Staff Answer</h2>
<div><p>better to avoid that. check &#64;246 or the link below. It can be done within 5 lines<br /><a href="https://stackoverflow.com/questions/1958219/convert-sqlalchemy-row-object-to-python-dict">https://stackoverflow.com/questions/1958219/convert-sqlalchemy-row-object-to-python-dict<br /><br /></a><a href="https://stackoverflow.com/questions/1958219/convert-sqlalchemy-row-object-to-python-dict" target="_blank"></a></p></div><hr><h1>Exercise 4 Check hanging</h1>
<h3>2018-03-08T19:59:45Z</h3>
<div><p>When I run sudo make check, the check seems to hang while checking Exercise 4.</p>
<p></p>
<p>I put print statements and they don&#39;t print, but when I CTRL&#43;C to kill the script, all of a sudden I get output indicating it had been progressing through the different checks (check_ex4a, checkex4b, etc...) without outputting my print statements.</p>
<p></p>
<p>Should it take very long for the Exercise 4 check to run? Any ideas as to why my print statements aren&#39;t showing up?</p></div>
<h2>Staff Answer</h2>
<div>It shouldn’t take that long, if it hangs for you try stopping by office hours and debug with a TA.</div>
<h2>Student Answer</h2>
<div><p>I had a similar error, and this was caused by not having complete handling in the regex for the urls in the zook.conf. When mine was hanging, the url request was being assigned to the wrong service which didn&#39;t actually have permissions to execute the request. Try running in browser with the urls being used in the exercise 4 tests and its easier to debug. </p></div><hr><h1>http_svcs vs extra_svcs?</h1>
<h3>2018-03-08T17:50:36Z</h3>
<div><p>What is the distinction here? Do I need to put any service I want to run (e.g. echo_svc) in http_svcs? In that case, what is extra_svcs for?</p></div>
<h2>Staff Answer</h2>
<div><p>http_svcs =  services for handling http request from client. <br />extra_svcs = services for other purposes depend on what you want it to do such as authentication using auth_svc. </p></div><hr><h1>/echosvc/sock</h1>
<h3>2018-03-08T17:36:45Z</h3>
<div><p>What is /echosvc/sock? Is it supposed to be a file? A directory? A socket name that just looks like a file path? Since there&#39;s no /echosvc/sock file or directory (that I can find), I&#39;m assuming it&#39;s the last one? I&#39;m kind of confused as to what sockets are or how they work... Is there any reference material on this?</p></div>
<h2>Staff Answer</h2>
<div>Yeah tons of it! BSD sockets (also in Linux) look like files but are treated more like “pipes” from the kernel.<div><br /></div><div><a href="https://en.m.wikipedia.org/wiki/Berkeley_sockets">https://en.m.wikipedia.org/wiki/Berkeley_sockets</a></div></div>
<h2>Followup</h2>
<div><p>But how can you modify the permissions if the file doesn&#39;t exist? /jail/echosvc/sock doesn&#39;t exist</p>
<p></p>
<pre>chmod: cannot access &#39;/jail/echosvc/sock&#39;: No such file or directory</pre>
<p></p></div>
<h3>Followup Response</h3>
<div>After it gets created you can set the permissions </div>
<h3>Followup Response</h3>
<div><p>So we&#39;re supposed to chmod that socket in echo-server.py, not chroot-setup.sh?</p></div>
<h3>Followup Response</h3>
<div>Or you can create it in before hand, similarly to /authsvc/sock<p></p><div><br /></div><div>FYI I didn’t say you need to set the permissions for this lab, I said you can as far as POSIX is concerned </div></div>
<h3>Followup Response</h3>
<div><p>Wait, so is making echo_svc work an exercise? I thought it was supposed to work already...</p>
<p></p>
<p>I don&#39;t know why it doesn&#39;t :(</p></div>
<h3>Followup Response</h3>
<div>Yeah it’s supposed to work already as an example of rpclib, I thought  you changed something that broke echosvc and now you were trying to fix it. If it doesn’t work for you after ‘git checkout lab2’ then come to office hours.<p></p><p></p></div>
<h3>Followup Response</h3>
<div><p></p><pre>zookld: Listening on port 8080
zookld: Launching zookd
zookld: zookd: pid 32140
zookld: Launching service 1: dynamic_svc
zookld: dynamic_svc: pid 32141
zookld: Launching service 2: static_svc
zookld: static_svc: pid 32142
zookld: Launching service 3: echo_svc
zookld: echo_svc: pid 32143
zookld: execv /zoobar/echo-server.py 8: Permission denied
zookd: Start with 3 service(s)
zookd: zookfs: cgi uid 19, gid 19
Dispatch ^(/zoobar/index.cgi(/[-_0-9a-zA-Z]*)?)$ for service 1
zookd: Dispatch ^(/zoobar(/[-_0-9a-zA-Z]*)*(/[-_0-9a-zA-Z]&#43;.[-_0-9a-zA-Z]&#43;)?)$ for service 2
zookd: Dispatch ^(.*)$ for service 3
zookfs: cgi uid 16, gid 18
zookd: Forward /zoobar/index.cgi/echo to service 1
/zoobar/debug.py:23 :: __try : caught exception in function echo:
 Traceback (most recent call last):
  File &#34;/zoobar/debug.py&#34;, line 20, in __try
    return f(*args, **kwargs)
  File &#34;/zoobar/echo.py&#34;, line 7, in echo
    with rpclib.client_connect(&#39;/echosvc/sock&#39;) as c:
  File &#34;/zoobar/rpclib.py&#34;, line 96, in client_connect
    sock.connect(pathname)
  File &#34;/usr/lib/python2.7/socket.py&#34;, line 228, in meth
    return getattr(self._sock,name)(*args)
error: [Errno 2] No such file or directory</pre>
<p></p>
<p>Is there a reason zookld can get permission denied? I thought zookld was executing as root, and root can do anything.</p>
<p></p>
<p>(according to my zook.conf and chroot-setup.sh, echo-server.py is owned by dynamic_svc)</p></div>
<h3>Followup Response</h3>
<div>Ah zookld forks a child process before calling execv though, in order to set the uid for the process. My guess is that’s what’s getting permission denied, make sure echo_server.py is executable by that process.<p></p></div><hr><h1>Exercise 5</h1>
<h3>2018-03-08T15:50:30Z</h3>
<div><p>I&#39;m trying to connect to the new authentication service I created with this line of python:</p>
<pre>with rpclib.client_connect(&#39;/loginauthsvc/sock&#39;) as c:</pre>
<p></p>
<p>However, &#96;rpclib.client_connect()&#96; throws an exception saying &#34;No such file or directory&#34;.</p>
<p></p>
<p>I&#39;m pretty sure I started my authentication service correctly. Here are the critical lines from my zook.conf and chroot-setup.sh</p>
<pre>zook.conf<br />[loginauth_svc]
	cmd = /zoobar/auth-server.py
	args = /loginauthsvc/sock
	dir = /jail
	uid = 61011
	gid = 61011<br /><br />chroot-setup.sh<br />create_socket_dir /jail/loginauthsvc 61011:61011 755</pre>
<p>Any thoughts on what might be going on?</p></div>
<h2>Student Answer</h2>
<div><p>Did you add loginauth_svc to extra_svcs (under zook)?</p></div><hr><h1>Manually connect to transfer service</h1>
<h3>2018-03-08T15:14:03Z</h3>
<div><p>For checking Exercise 8, how do we manually connect to the transfer service? </p></div>
<h2>Staff Answer</h2>
<div><p>&#64;242<br />Then interact with transfer directly from the browser.</p></div>
<h2>Followup</h2>
<div><p>the part I&#39;m not sure is how to interact with transfer directly from the browser. How do we send a request to the transfer RPC with a different token?  </p></div><hr><h1>Exercise 9</h1>
<h3>2018-03-08T11:13:18Z</h3>
<div><p>&#34;Depending on how you implemented privilege separation in lab 2, you may need to adjust how <tt>ProfileAPIServer</tt> implements <tt>rpc_get_xfers</tt> or <tt>rpc_xfer</tt>.&#34;</p>
<p></p>
<p>I am not sure how to get this part to work. To transfer zoobars, you need a valid token which means that you need to login but I don&#39;t think there is a way to access the password from granter.py because ProfileServer.rpc_run only takes in user and visitor. What am I missing here?</p>
<p></p></div>
<h2>Student Answer</h2>
<div><p>Think about other places you could feed in the token - like what gets called after you call rpc_run. </p>
<p></p>
<p>Also this line from the lab is a hint: &#34;You will need to make sure that <tt>rpc_xfer</tt> can still perform transfers from the profile owner&#39;s account. It may be helpful to obtain the correct token before giving up root privileges.&#34;</p></div>
<h2>Followup</h2>
<div><p>Ok, I think I got it to work by getting the token directly in rpc_run. But now I&#39;m confused about exercise 11. I can&#39;t figure out how to make rpc_run work at all without root privilege because I won&#39;t even be able to chroot when running the sandbox.</p></div>
<h3>Followup Response</h3>
<div><p>Resolved. Thanks!</p></div><hr><h1>Ex. 7: Correctly initializing zoobars?</h1>
<h3>2018-03-08T06:58:38Z</h3>
<div><p>Can someone point me in the right direction for correctly initializing zoobars to 10?</p>
<p></p>
<p>I&#39;ve tried using the &#34;default=10&#34; approach in zoobar/zoodb.py, and I&#39;ve tried setting zoobars to 10 in zoobar/bank-server.py when I register a new user. It appears that I&#39;m still setting the initial value to None, though. Am I missing something obvious?</p></div>
<h2>Staff Answer</h2>
<div>It shouldn’t be hard to debug since we already had the default Zoobar initial amount set to 10 for a new account. Maybe check the zoobar number during new user registration is what you expect it to be?</div><hr><h1>Creating user in bank.db on registration?</h1>
<h3>2018-03-08T06:04:59Z</h3>
<div><p>I created a new function in the bank interface to create a new record(?) in the bank database initialized to 10 zoobars, accessible via bank_client.py. It seems like auth.py needs to call this function somehow. Right now I get a socket error if auth.py tries to call anything from bank_service.py, but giving the auth service permission to access the banksvc socket seems to defeat the purpose of separating them. Am I wrong that auth.register() is where I should be adding a new user to the bank db?</p></div>
<h2>Student Answer</h2>
<div><p>The bank db is controlled only by bank_svc. How should things outside of bank_svc like zoodb.py communicate with bank_svc to see balances, make transfers, etc?</p></div>
<h2>Followup</h2>
<div><p>Whoops, typo, I meant bank_client.py. I assume everything should be going through there, but for auth.py to use it, doesn&#39;t it need read/write permissions to the banksvc socket, and doesn&#39;t that give it the ability to make arbitrary transfers?</p></div>
<h3>Followup Response</h3>
<div>Having access to the socket is okay, I think — what can you do from the socket? Only call the bank-server.py methods, and these have internal checks (you can’t transfer more $ than you have, etc.). You still can’t check who is asking for the transfer, but that’s handled in exercise 8.<div><br /></div><div>I guess this depends on what you mean by “arbitrary” transfers—if you compromised auth.py you could call transfer(src, dest, amt) as much as you wanted, but that’s allowed at this point in the lab afaik...</div></div>
<h3>Followup Response</h3>
<div><p>Ohhh right I see, the point was just not letting anything else mess with the database directly. Thanks!</p></div><hr><h1>Assigning main vs. extra gid&#39;s</h1>
<h3>2018-03-08T05:40:07Z</h3>
<div><p>Is there any difference between</p>
<ol><li>setting permissions of something to gid of service A and then giving that gid as an extra gid to service B;</li><li>and setting permissions of something to gid of service B and then giving that gid as an extra gid to service A?</li></ol>
<p></p>
<p>I didn&#39;t think there was (maybe I&#39;m missing some edge case) but noticed a difference.</p>
<p></p>
<p>Additionally, what are situations where UID and GID must not be equal?</p>
<p></p></div>
<h2>Student Answer</h2>
<div><p>I don&#39;t think the UIDs and GIDs being equal actually means anything to the system--UIDs and GIDs are considered separately, so they&#39;re just the same so they&#39;re convenient for us to remember (AFAIK).</p></div><hr><h1>Exercise 6 hashing password</h1>
<h3>2018-03-08T05:31:47Z</h3>
<div><p>The exercise passes if I hash passwords in auth.py, but in that case, couldn&#39;t a man in the middle listen between auth_client and auth-server and replay the request?</p>
<p></p>
<p></p>
<p>If so, would it be better to hash the password in auth_client and then pass it to auth-server? (I tried this but since auth_client doesn&#39;t have privileges to access the Cred db, it doesn&#39;t work)</p></div>
<h2>Staff Answer</h2>
<div>Depends on the permissions on the socket file, you should take care that the right group can read from it and no one else.</div>
<h2>Student Answer</h2>
<div><p>I think for this lab we aren&#39;t worrying about network compromises (passwords are sent in the clear over the network). I think the current threat model is the db being broken into.</p>
<p></p>
<p>But also, how will hashing the password on the client side help?</p></div><hr><h1>Exercise 8: What should transfer do when token check fails?</h1>
<h3>2018-03-08T04:43:54Z</h3>
<div><p>I currently have it set to raise an attribute error, but is there some specific function that we should implement/makes more sense?</p></div>
<h2>Staff Answer</h2>
<div>You can just ignore the transfer if the token check fails, either way this exercise is not automatically checked so the checker is not looking for some particular behavior (only checks that the transfer did NOT happen)</div><hr><h1>Exc 5 :: leaving a hole to person.db</h1>
<h3>2018-03-07T22:55:03Z</h3>
<div><p>In login.py we keep </p>
<p></p>
<p>def setPerson(self, username, token):<br />      persondb = person_setup()<br />      self.person = persondb.query(Person).get(username)</p>
<p></p>
<p>which allows to directly access person.db w/o using RPC. I was able to pass the test, but can this solution be considered as secure enough? </p>
<p></p>
<p>Thanks </p></div>
<h2>Staff Answer</h2>
<div><p>It seems to me that lab doesn&#39;t concern much about person db after you separate the authentication, so I think that should be enough up to this point. :)</p></div><hr><h1>Exercise 5 Error: make_sockpath_fork</h1>
<h3>2018-03-07T22:31:00Z</h3>
<div><p>I&#39;ve been debugging my code for a long time, and implemented all of the changes to make auth_svc, the Cred database, so I thought it was a permissions error. I was getting an error while it was checking Ex 0 in &#96;sudo make check&#96;, and i didn&#39;t know how to procede, so I started the server. It renders the home page, but I get this error when I attempt to log in:</p>
<p></p>
<p>Traceback (most recent call last):<br />  File &#34;/zoobar/auth-server.py&#34;, line 25, in &lt;module&gt;<br />    s.run_sockpath_fork(sockpath)<br />  File &#34;/zoobar/rpclib.py&#34;, line 72, in run_sockpath_fork<br />    os.waitpid(pid, 0)<br />OSError: [Errno 10] No child processes<br /><br /></p></div>
<h2>Staff Answer</h2>
<div><p>make sure that...<br />- you set args in .conf correctly for the &lt;sockpath&gt;</p>
<p>- /jail/&lt;sockpath&gt; exist (by cd and observe) <br />- your service has right permission to the &lt;sockpath&gt;</p></div>
<h2>Followup</h2>
<div><p>I did an equivalent sockpath as the echo_svc example in the zook.conf, checked that my /jail/authsvc folder existed with correct permissions, and it seems fine. i still don&#39;t know what&#39;s going on</p></div><hr><h1>Failing functionality test after Exercise 5</h1>
<h3>2018-03-07T22:10:31Z</h3>
<div><p>I am failing the very first app functionality check after adding my implementation for Exercise 5. The error message isn&#39;t super descriptive, so I&#39;m not sure what&#39;s going on.</p>
<p></p>
<p>I&#39;m able to load it on my browser and create an account and log in and so on though. is it an issue with favicon or something because that&#39;s the only one my browser complains about?</p>
<p></p>
<p>Alternatively I assume it doesn&#39;t recognize the login url or something, but I changed nothing about the urls except add an &#34;extra_svc&#34; called auth_svc that is very similar to the echo_svc.</p></div>
<h2>Staff Answer</h2>
<div><p>Still, I will need actual error from server for assumption on why it doesn&#39;t work. Although the error is not very descriptive, it is still better than nothing. The useful thing I found from error is the actual line that make it fail. Then you can try to think about what might go wrong. </p></div>
<h2>Followup</h2>
<div>The favicon is not an issue! It didn’t have one from the very start.</div>
<h2>Followup</h2>
<div><p>Here&#39;s what the output looks like:</p>
<pre>./check_lab2.py
&#43; setting up environment in fresh /jail..
&#43; running make.. output in /tmp/make.out
&#43; running zookld in the background.. output in /tmp/zookld.out
---
Request: [&#39;wget&#39;, &#39;http://localhost:8080/zoobar/index.cgi/login&#39;, &#39;--save-cookies&#39;, &#39;/tmp/cookies.txt&#39;, &#39;--post-data&#39;, &#39;login_username=test1&amp;login_password=supersecretpassword&amp;nexturl=%2Fzoobar%2Findex.cgi%2F&amp;submit_registration=Register&#39;, &#39;--keep-session-cookies&#39;, &#39;-O&#39;, &#39;-&#39;]
Response:
  &lt;!DOCTYPE html&gt;
  &lt;html&gt;
      &lt;head&gt;
          &lt;meta charset=&#34;utf-8&#34;&gt;
          &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/zoobar/media/zoobar.css&#34;&gt;
          &lt;title&gt;
            Login - Zoobar Foundation
          &lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;h1&gt;&lt;a href=&#34;/zoobar/index.cgi/&#34;&gt;Zoobar Foundation for Trustworthy
                        Learning&lt;/a&gt;&lt;/h1&gt;
        &lt;h2&gt;Supporting the loyal
            thinkers of the United States&lt;/h2&gt;
  &lt;div id=&#34;login&#34; class=&#34;centerpiece&#34;&gt;
  &lt;form name=&#34;loginform&#34; method=&#34;POST&#34; action=&#34;/zoobar/index.cgi/login&#34;&gt;
  &lt;table&gt;
  &lt;tr&gt;
     &lt;td&gt;Username:&lt;/td&gt;
    &lt;td&gt;&lt;input type=&#34;text&#34; name=&#34;login_username&#34; size=&#34;20&#34;
    autocomplete=&#34;no&#34; value=&#34;&#34;&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
     &lt;td&gt;Password:&lt;/td&gt;
    &lt;td colspan=2&gt;&lt;input type=&#34;password&#34; name=&#34;login_password&#34; size=20 autocomplete=&#34;no&#34;&gt;
    &lt;input type=&#34;submit&#34; name=&#34;submit_login&#34; value=&#34;Log in&#34;&gt;
    &lt;input type=&#34;submit&#34; name=&#34;submit_registration&#34; value=&#34;Register&#34;&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;/table&gt;
  &lt;input type=&#34;hidden&#34; name=&#34;nexturl&#34; value=&#34;http://localhost:8080/zoobar/index.cgi/&#34;&gt;
  &lt;/form&gt;
  &lt;/div&gt;
  &lt;div class=&#34;footer warning&#34;&gt;
  &lt;/div&gt;
  &lt;script&gt;document.loginform.login_username.focus();&lt;/script&gt;
      &lt;/body&gt;
  &lt;/html&gt;
---
Request: [&#39;wget&#39;, &#39;http://localhost:8080/zoobar/index.cgi/login&#39;, &#39;--save-cookies&#39;, &#39;/tmp/cookies.txt&#39;, &#39;--post-data&#39;, &#39;login_username=test2&amp;login_password=pass&amp;nexturl=%2Fzoobar%2Findex.cgi%2F&amp;submit_registration=Register&#39;, &#39;--keep-session-cookies&#39;, &#39;-O&#39;, &#39;-&#39;]
Response:
  &lt;!DOCTYPE html&gt;
  &lt;html&gt;
      &lt;head&gt;
          &lt;meta charset=&#34;utf-8&#34;&gt;
          &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/zoobar/media/zoobar.css&#34;&gt;
          &lt;title&gt;
            Login - Zoobar Foundation
          &lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;h1&gt;&lt;a href=&#34;/zoobar/index.cgi/&#34;&gt;Zoobar Foundation for Disciplined
                        Dialogue&lt;/a&gt;&lt;/h1&gt;
        &lt;h2&gt;Supporting the skillful
            representatives of the 21st-century&lt;/h2&gt;
  &lt;div id=&#34;login&#34; class=&#34;centerpiece&#34;&gt;
  &lt;form name=&#34;loginform&#34; method=&#34;POST&#34; action=&#34;/zoobar/index.cgi/login&#34;&gt;
  &lt;table&gt;
  &lt;tr&gt;
     &lt;td&gt;Username:&lt;/td&gt;
    &lt;td&gt;&lt;input type=&#34;text&#34; name=&#34;login_username&#34; size=&#34;20&#34;
    autocomplete=&#34;no&#34; value=&#34;&#34;&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
     &lt;td&gt;Password:&lt;/td&gt;
    &lt;td colspan=2&gt;&lt;input type=&#34;password&#34; name=&#34;login_password&#34; size=20 autocomplete=&#34;no&#34;&gt;
    &lt;input type=&#34;submit&#34; name=&#34;submit_login&#34; value=&#34;Log in&#34;&gt;
    &lt;input type=&#34;submit&#34; name=&#34;submit_registration&#34; value=&#34;Register&#34;&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;/table&gt;
  &lt;input type=&#34;hidden&#34; name=&#34;nexturl&#34; value=&#34;http://localhost:8080/zoobar/index.cgi/&#34;&gt;
  &lt;/form&gt;
  &lt;/div&gt;
  &lt;div class=&#34;footer warning&#34;&gt;
  &lt;/div&gt;
  &lt;script&gt;document.loginform.login_username.focus();&lt;/script&gt;
      &lt;/body&gt;
  &lt;/html&gt;
FAIL App functionality error fetching user page
&#43; restoring /jail; test /jail saved to /jail.check..
Makefile:15: recipe for target &#39;check&#39; failed
make: *** [check] Error 1</pre>
<p></p></div>
<h3>Followup Response</h3>
<div><p>The issue was some error in the register function which wasn&#39;t automatically logging a newly registered user in.</p></div>
<h3>Followup Response</h3>
<div>Can you clarify this? There was never logic in the register function for logging a newly registered user in.</div>
<h3>Followup Response</h3>
<div><p>The error message from server is in /tmp/zookld.out when you run make check<br />However, I highly recommend you interact with the server from your browser instead of debugging from make check result. By interacting from browser you will get the error log in the terminal you run the server zookld. <br />See what action you do that make it generates error and what is the error.</p></div>
<h3>Followup Response</h3>
<div><p>I was returning an incorrect token, because it was using the person db to return the token instead of cred</p></div><hr><h1>Should we fix bugs in zoobar?</h1>
<h3>2018-03-07T19:57:26Z</h3>
<div><p>As implemented now, the zoobar web app allows users to arbitrarily increase the number of zoobars they have, as well as force other users to give them zoobars. Should we put in protections against this?</p>
<p></p>
<p></p></div>
<h2>Staff Answer</h2>
<div><p>Up to lab2 part 2-3, there is no need to fix this as long as it doesn&#39;t said so. However, future lab or future part may require you to fix this bug which related to web or zoobars transferring. </p></div><hr><h1>Full permissions, yet lookup fails...!?</h1>
<h3>2018-03-07T17:19:14Z</h3>
<div><p></p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/hlmw7ncksqb1mz/jehck5ql8v4c/Screen_Shot_20180307_at_12.17.35_PM.png" alt="" /></p>
<p></p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/hlmw7ncksqb1mz/jehckmi0l8ru/Screen_Shot_20180307_at_12.17.39_PM.png" alt="" /></p>
<p></p>
<p>There&#39;s no additional set_perms call below the one you see above. I don&#39;t understand how permission to zoobar/db/bank can be denied after setting 777 privileges for the folder.</p></div>
<h2>Staff Answer</h2>
<div><p>[Repeat answering in case other students have same issues]<br />Make sure that your service also has permission of directories along the way to access the file. <br />(execute permission for cd and read permission for list file in directory).<br />Think about the scenario when your card has access permission to the room but not the elevator, building, and so on. How can you access the room.</p></div><hr><h1>Final Project Group Size</h1>
<h3>2018-03-07T16:35:41Z</h3>
<div><p>How big are final project groups?</p></div>
<h2>Staff Answer</h2>
<div><p>Ideally 2-3 students.</p></div>
<h2>Followup</h2>
<div><p>Does this apply for default project as well?</p></div>
<h3>Followup Response</h3>
<div><p>Yes.</p></div><hr><h1>Printing Stuff for Debugging Purposes</h1>
<h3>2018-03-07T05:33:23Z</h3>
<div><p>What&#39;s the best way to print stuff from rpclib.py to the terminal? I was thinking about opening a file in rpclib.py and writing debug statements to the file, but I was wondering if there was a better way to do it.</p></div>
<h2>Student Answer</h2>
<div><p>The <tt>log</tt> function! Quote from lab2:</p>
<p></p>
<ul><li>One problem that you might run into is that it&#39;s tricky to debug a complex application that&#39;s composed of many pieces. To help you, we have provided a simple debug library in <tt>debug.py</tt>, which is imported by every Python script we give you. The <tt>debug</tt> library provides a single function, <tt>log(msg)</tt>, which prints the message <tt>msg</tt> to stderr (which should go to the terminal where you ran <tt>zookld</tt>), along with a stack trace of where the <tt>log</tt> function was called from.</li></ul></div><hr><h1>Understanding sqlalchemy better</h1>
<h3>2018-03-07T05:06:43Z</h3>
<div><p>I&#39;m having a strange bug where somehow the entry in my Bank database gets deleted between my call to creating a new entry in the Bank database and the call to balance. I have a method called reg_bank that creates a new Bank() and such, then inserts it into the database. Then at some point (I&#39;m running sudo make check) I assume something calls balance and we query the database for the user. Problem is, seems like the data entry I just saved to the database has disappeared.</p>
<p></p>
<p>I know this because in my debugging, I&#39;ve tried to run db.query(Bank).all(), both in my reg_bank function and in balance. In the former, i get back one entry, in the latter, 0 entries.</p>
<p></p>
<p>So i guess my question is: is it possible sqlalchemy deleted my entry somewhere? If so, how do I go about finding where it got deleted?</p></div>
<h2>Student Answer</h2>
<div><p>Resolved! Forgot a pair of parens on commit()</p></div><hr><h1>wednesday office hours</h1>
<h3>2018-03-07T04:48:55Z</h3>
<div><p>The 9th floor of state is closed wednesday for a grad student event. Does this mean that office hours will be moved?</p></div>
<h2>Staff Answer</h2>
<div>Nope, we’re here.</div><hr><h1>get_log issue?</h1>
<h3>2018-03-07T04:18:14Z</h3>
<div><p>Exercise 7 does not specify whether to implement get_log in bank-server or on the client side. If I try to implement it in bank-server over RPC, I get an error saying that the log object is not JSON-serializable. On the other hand, if I implement it in the client (dynamic_svc) I have to make transfer.db group-readable, which causes the check for Exercise 4 to fail. How should I fix this? Do I need to change the serialization code?</p></div>
<h2>Student Answer</h2>
<div><p>Try to make the return value of get_log serializable! </p></div><hr><h1>sudo make check - weird issue!</h1>
<h3>2018-03-07T02:33:31Z</h3>
<div><p>Failing sudo make check on Exercise 7. Sudo make check says: </p>
<p>&#34;FAIL App functionality invalid sender zoobars after transfer and view user&#34;</p>
<p></p>
<p>I launched the server. Made two accounts. Performed transfers. Both accounts reflect the correct balance. I notice there is a slight lag when it comes to loading the zoobars balance on the transfers page, I assume as a result of the RPC. Could this be causing the test case to fail?</p></div>
<h2>Staff Answer</h2>
<div><p>Shouldn&#39;t be an issue with lag, if it persists stop by office hours and ask a TA to have a look.</p></div>
<h2>Student Answer</h2>
<div><p>Resolved. I updated some javascript files to read from g.user.bank.zoobars. Apparently you should not modify any JS code. I found a pythonic way to have g.user.zoobars display the correct value.</p></div><hr><h1>matching auth.py to new db setup</h1>
<h3>2018-03-07T01:44:51Z</h3>
<div><p>Does &#34;The implementation of this service should use the existing functions in <tt>auth.py</tt>&#34; mean I shouldn&#39;t modify auth.py at all, or just not mess with the function signatures? </p>
<p></p></div>
<h2>Staff Answer</h2>
<div><p>You can modify auth.py. The auth server can use the functions in auth.py.</p></div><hr><h1>Can&#39;t serialize JSON</h1>
<h3>2018-03-07T01:30:05Z</h3>
<div><p>does anyone know why the code is trying to serialize a query object? I&#39;m getting this error:</p>
<p></p>
<p>File &#34;/usr/lib/python2.7/json/encoder.py&#34;, line 184, in default<br /> raise TypeError(repr(o) &#43; &#34; is not JSON serializable&#34;)<br />TypeError: &lt;sqlalchemy.orm.query.Query object at 0xb748832c&gt; is not JSON serializable<br />/zoobar/debug.py:23 :: __try : caught exception in function users:<br /> Traceback (most recent call last):<br /> File &#34;/zoobar/debug.py&#34;, line 20, in __try<br /> return f(*args, **kwargs)<br /> File &#34;/zoobar/login.py&#34;, line 64, in loginhelper<br /> return page(*args, **kwargs)<br /> File &#34;/zoobar/users.py&#34;, line 28, in users<br /> args[&#39;transfers&#39;] = bank_client.get_log(user.username)<br /> File &#34;/zoobar/bank_client.py&#34;, line 18, in get_log<br /> return c.call(&#39;get_log&#39;, username=u)<br /> File &#34;/zoobar/rpclib.py&#34;, line 81, in call<br /> return parse_resp(self.lines.next())<br />StopIteration</p>
<p></p></div>
<h2>Staff Answer</h2>
<div><p>What did you try to debug this?</p></div>
<h2>Student Answer</h2>
<div><p>I figured it out after some googling:</p>
<p></p>
<p><a href="https://stackoverflow.com/questions/5022066/how-to-serialize-sqlalchemy-result-to-json">https://stackoverflow.com/questions/5022066/how-to-serialize-sqlalchemy-result-to-json</a></p>
<p></p>
<p>Turns out translating the sqlalchemy to a dictionary helps.</p></div>
<h2>Followup</h2>
<div><p>Can you explain more on how you used this resource to make get_log&#39;s return value serializable?</p></div>
<h3>Followup Response</h3>
<div><p>try translating it into a python dictionary</p></div>
<h3>Followup Response</h3>
<div><p>Yes python list and dictionary is good enough.</p></div>
<h2>Followup</h2>
<div><p>Is there an opportunity to get an advice on how exactly to convert the result we&#39;re getting </p>
<p></p>
<p>db.query(Transfer).filter(or_(Transfer.sender==username, Transfer.recipient==username))</p>
<p></p>
<p>to a dictionary? I have tried several hits from stackoverflow, but wasn&#39;t able to succeed. </p>
<p></p>
<p>Thank you in advance </p></div>
<h3>Followup Response</h3>
<div><p>I follow this one, but the student&#39;s answer about stackoverflow above is also a good one.<br /><a href="https://stackoverflow.com/questions/1958219/convert-sqlalchemy-row-object-to-python-dict">https://stackoverflow.com/questions/1958219/convert-sqlalchemy-row-object-to-python-dict</a></p></div><hr><h1>Exercise 8 g.user.token error</h1>
<h3>2018-03-06T23:47:20Z</h3>
<div><p>I&#39;m running into an issue with accessing the token using g.user.token. I get the following error: &#34;AttributeError: &#39;User&#39; object has no attribute &#39;token&#39;&#34;</p>
<p></p></div>
<h2>Staff Answer</h2>
<div><p>Check the schema for g.user (print it) and make sure you&#39;re looking for token in the right place.</p></div><hr><h1>Echo server not working</h1>
<h3>2018-03-06T22:30:44Z</h3>
<div><p></p><pre>/zoobar/debug.py:23 :: __try : caught exception in function echo:
 Traceback (most recent call last):
  File &#34;/zoobar/debug.py&#34;, line 20, in __try
    return f(*args, **kwargs)
  File &#34;/zoobar/echo.py&#34;, line 7, in echo
    with rpclib.client_connect(&#39;/echosvc/sock&#39;) as c:
  File &#34;/zoobar/rpclib.py&#34;, line 96, in client_connect
    sock.connect(pathname)
  File &#34;/usr/lib/python2.7/socket.py&#34;, line 228, in meth
    return getattr(self._sock,name)(*args)
error: [Errno 2] No such file or directory</pre>
<p>I can&#39;t get the echo server to work. Do you know why this is?</p></div>
<h2>Staff Answer</h2>
<div><p>The error says:</p>
<p></p>
<pre>No such file or directory</pre>
<p></p>
<p>What&#39;s your guess based on that message?</p></div>
<h2>Followup</h2>
<div><p>So </p>
<pre>&#39;/echosvc/sock&#39;</pre>
<p>doesn&#39;t exist?</p>
<p></p>
<p>But that&#39;s not a real directory or file so I&#39;m not sure it&#39;s even supposed to exist?</p></div><hr><h1>good way to test ex8?</h1>
<h3>2018-03-06T20:50:48Z</h3>
<div><p>What&#39;s a good way to verify ex8 works? I tried running the &#96;bank_client.transfer&#96; code in a Python shell but can&#39;t figure out how to run it with the correct privileges. Is there another easy way to send an RPC to the bank service?</p></div>
<h2>Staff Answer</h2>
<div><p>If running and checking externally is hard, can you think of a way that you can check internally such as from the transfer.py itself ?<br />One way you can achieve that is hardcoding some value that can make you differentiate between success and failure of authentication.</p></div>
<h2>Followup</h2>
<div><p>I&#39;m still not sure how that helps if we can&#39;t get it to execute a sample transfer RPC call via a url or something</p></div>
<h3>Followup Response</h3>
<div>There’s an example of how to test ex8 in &#64;277</div><hr><h1>In case you&#39;re wondering how to do part 6...</h1>
<h3>2018-03-06T20:30:12Z</h3>
<div><p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/ieboi20jsiy28r/jeg3xpii5f9x/l19732.jpg" width="312" height="288" /></p></div>
<h2>Followup</h2>
<div>this is a good meme &#43;1</div>
<h3>Followup Response</h3>
<div><p>&#43;2</p></div>
<h3>Followup Response</h3>
<div><p>&#43;3</p></div>
<h3>Followup Response</h3>
<div><p>&#43;4</p></div>
<h3>Followup Response</h3>
<div><p>&#43;5</p></div>
<h2>Followup</h2>
<div><p>I don&#39;t get it. pls explain</p></div>
<h3>Followup Response</h3>
<div><p>much salt.</p></div><hr><h1>Piazza &amp; Office hours</h1>
<h3>2018-03-06T18:16:36Z</h3>
<div><p>I was wondering if the course staff could be more prompt about answering questions about labs on Piazza. Some questions have gone unanswered for 12-24 hours by instructors, and it&#39;s hard to get help for students who cannot attend the current office hours.</p>
<p></p>
<p>Otherwise, would it be possible to schedule more office hours?</p></div>
<h2>Staff Answer</h2>
<div><p>I&#39;m so sorry about that. I will try to be more active and will raise this concern during the meeting today.</p></div><hr><h1>Editing files</h1>
<h3>2018-03-06T12:20:11Z</h3>
<div><p>For auth-server.py and bank-server.py I copied and then modified the relevant code from auth.py and bank.py respectively and then made sure auth.py and bank.py aren&#39;t used anywhere. Is this okay or am I required to modify auth.py and bank.py and use them in the server files?</p></div>
<h2>Staff Answer</h2>
<div>Either work.</div><hr><h1>Can anyone see the Person and Transfer dbs?</h1>
<h3>2018-03-06T05:39:10Z</h3>
<div><p>Is it ok if the permissions for Person and Transfer are permissive? Of course cred db should only allow viewing and writing for the owner, but what are the requirements for the other two?</p></div>
<h2>Staff Answer</h2>
<div>I’d say it’s good practice to give the minimum permissions that work, even if the exercises don’t specify that directly. </div><hr><h1>Help on Debugging Permission Errors</h1>
<h3>2018-03-06T02:58:40Z</h3>
<div><p>Hi, I&#39;m working on exercise 5 right now, and am getting this error:</p>
<p></p>
<p>Traceback (most recent call last):<br /> File &#34;/zoobar/auth-server.py&#34;, line 19, in &lt;module&gt;<br /> s.run_sockpath_fork(sockpath)<br /> File &#34;/zoobar/rpclib.py&#34;, line 67, in run_sockpath_fork<br /> self.run_sock(conn)<br /> File &#34;/zoobar/rpclib.py&#34;, line 43, in run_sock<br /> ret = m(**kwargs)<br /> File &#34;/zoobar/auth-server.py&#34;, line 13, in rpc_register<br /> return auth.register(username, password)<br /> File &#34;/zoobar/auth.py&#34;, line 25, in register<br /> pdb = person_setup()<br /> File &#34;/zoobar/zoodb.py&#34;, line 45, in person_setup<br /> return dbsetup(&#34;person&#34;, PersonBase)<br /> File &#34;/zoobar/zoodb.py&#34;, line 40, in dbsetup<br /> base.metadata.create_all(engine)<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/sql/schema.py&#34;, line 3695, in create_all<br /> tables=tables)<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py&#34;, line 1855, in _run_visitor<br /> with self._optional_conn_ctx_manager(connection) as conn:<br /> File &#34;/usr/lib/python2.7/contextlib.py&#34;, line 17, in __enter__<br /> return self.gen.next()<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py&#34;, line 1848, in _optional_conn_ctx_manager<br /> with self.contextual_connect() as conn:<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py&#34;, line 2039, in contextual_connect<br /> self._wrap_pool_connect(self.pool.connect, None),<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py&#34;, line 2078, in _wrap_pool_connect<br /> e, dialect, self)<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py&#34;, line 1405, in _handle_dbapi_exception_noconnection<br /> exc_info<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/util/compat.py&#34;, line 200, in raise_from_cause<br /> reraise(type(exception), exception, tb=exc_tb)<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py&#34;, line 2074, in _wrap_pool_connect<br /> return fn()<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/pool.py&#34;, line 376, in connect<br /> return _ConnectionFairy._checkout(self)<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/pool.py&#34;, line 713, in _checkout<br /> fairy = _ConnectionRecord.checkout(pool)<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/pool.py&#34;, line 480, in checkout<br /> rec = pool._do_get()<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/pool.py&#34;, line 1151, in _do_get<br /> return self._create_connection()<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/pool.py&#34;, line 323, in _create_connection<br /> return _ConnectionRecord(self)<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/pool.py&#34;, line 449, in __init__<br /> self.connection = self.__connect()<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/pool.py&#34;, line 607, in __connect<br /> connection = self.__pool._invoke_creator(self)<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/engine/strategies.py&#34;, line 97, in connect<br /> return dialect.connect(*cargs, **cparams)<br /> File &#34;/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py&#34;, line 385, in connect<br /> return self.dbapi.connect(*cargs, **cparams)<br />sqlalchemy.exc.OperationalError: (pysqlite2.dbapi2.OperationalError) unable to open database file<br />/zoobar/debug.py:23 :: __try : caught exception in function login:<br /> Traceback (most recent call last):<br /> File &#34;/zoobar/debug.py&#34;, line 20, in __try<br /> return f(*args, **kwargs)<br /> File &#34;/zoobar/login.py&#34;, line 81, in login<br /> cookie = user.addRegistration(username, password)<br /> File &#34;/zoobar/login.py&#34;, line 29, in addRegistration<br /> token = auth_client.register(username, password)<br /> File &#34;/zoobar/auth_client.py&#34;, line 13, in register<br /> return c.call(&#39;register&#39;, username=u, password=p)<br /> File &#34;/zoobar/rpclib.py&#34;, line 81, in call<br /> return parse_resp(self.lines.next())</p>
<p></p>
<p>I have no idea where to even start debugging this- does anyone have any tips?</p></div>
<h2>Staff Answer</h2>
<div>Looks like it’s unable to open the dB file, can you check the permissions on it?</div><hr><h1>Exercise 5 Understanding</h1>
<h3>2018-03-05T22:56:28Z</h3>
<div><p>We need to create a new service (read: process) that is communicated to by RPC&#39;s from the main body of code. The RPC&#39;s will communicate username, passwords, tokens and return whether or not they are reliable. To accomplish this, we create the service, write new methods to separate the way the database is accessed, call those new methods from the service, then call that service from our original code body (login.py)?</p>
<p></p>
<p>Just want to make sure I have the right understanding here before I waste a few hours debugging/pulling hair.</p></div>
<h2>Student Answer</h2>
<div>yeah, that sounds about right</div><hr><h1>socket error for exercise 7</h1>
<h3>2018-03-05T17:40:35Z</h3>
<div><p>I am getting the following error when I run make check for exercise 7:</p>
<pre>socket.error: [Errno 2] No such file or directory
zookd: Forward /zoobar/index.cgi/login to service 1
/zoobar/debug.py:23 :: __try : caught exception in function login:
 Traceback (most recent call last):
  File &#34;/zoobar/debug.py&#34;, line 20, in __try
    return f(*args, **kwargs)
  File &#34;/zoobar/login.py&#34;, line 81, in login
    cookie = user.addRegistration(username, password)
  File &#34;/zoobar/login.py&#34;, line 31, in addRegistration
    return self.loginCookie(username, token)
  File &#34;/zoobar/login.py&#34;, line 22, in loginCookie
    self.setPerson(username, token)
  File &#34;/zoobar/login.py&#34;, line 46, in setPerson
    self.zoobars = bank_client.balance(username)
  File &#34;/zoobar/bank_client.py&#34;, line 12, in balance
    with rpclib.client_connect(&#39;/banksvc/sock&#39;) as c:
  File &#34;/zoobar/rpclib.py&#34;, line 96, in client_connect
    sock.connect(pathname)
  File &#34;/usr/lib/python2.7/socket.py&#34;, line 228, in meth
    return getattr(self._sock,name)(*args)
error: [Errno 2] No such file or directory</pre>
<p>I created the socket in chroot-setup, but I am not sure what is going wrong. Is this a problem with permissions?</p></div>
<h2>Student Answer</h2>
<div><p>you probably haven&#39;t updated banksvc as an &#96;extra_svcs&#96; in &#96;zook.conf&#96;</p></div>
<h2>Followup</h2>
<div><p>I have, but it still isn&#39;t working</p></div>
<h3>Followup Response</h3>
<div><p>~resolved~</p>
<p>I wasn&#39;t calling the create_socket_dir correctly</p></div>
<h3>Followup Response</h3>
<div><p>How did you fix this? I&#39;ve been stuck on the same problem for a very long time and I still don&#39;t have a clue.</p></div>
<h3>Followup Response</h3>
<div><p>I was missing an underscore in create_socket_dir</p></div>
<h3>Followup Response</h3>
<div><p>I see. Thanks for the feedback.</p></div><hr><h1>Understanding file relationships for Exercise 5</h1>
<h3>2018-03-05T05:42:06Z</h3>
<div><p>I want to make sure my understanding is correct. </p>
<p></p>
<p>auth_server.py (similar to echo_server) handles the RPC calls by calling upon methods from auth_client.py (which would be using the credential database instead of the person db that has all of the other information). login.py would now make all calls via RPCs (like the sample code in echo.py) to the auth_svc which the auth_server would respond to after passing the right arguments (extracting them from s in the rpc call) and calling the corresponding function in auth_client.py.</p>
<p></p>
<p>I guess what I don&#39;t understand is this &#34;The implementation of this service should use the existing functions in <tt>auth.py</tt>.&#34; Since auth.py calls the person db for all of its queries and updates, this doesn&#39;t particularly make sense to me unless we have to go in and modify auth.py itself to use &#39;cred&#39; instead of &#39;person&#39;.</p></div>
<h2>Followup</h2>
<div><p>I&#39;m having the same misunderstanding.</p></div>
<h2>Student Answer</h2>
<div><p>I think you might also be misunderstanding how to use auth_client.py. I don&#39;t think the server should be calling corresponding function in auth_client, but rather it should be calling the correct function in auth.py. In this case, login.py is the auth client. So you could import auth_client into login.py and use those functions to make RPCs to the auth service.  </p>
<p></p>
<p>Also, I think we are allowed to re-write auth.py such that it is mostly the same but now uses the correct db. </p></div>
<h2>Followup</h2>
<div><p>Can someone clarify this? Then does auth_client just wrap arguments and make an rpc call to auth_server.py which calls methods in auth to do the job?</p></div>
<h3>Followup Response</h3>
<div><p>Yep. We still want to use those same methods in &#96;auth&#96; (except modified a bit, as mentioned above, to have the separate databases), but now we restrict access to them by only letting &#96;auth_server&#96; call those methods; all other processes must make an RPC to &#96;auth_server&#96; using the RPC calls you define in &#96;auth_client&#96;.</p></div><hr><h1>Passing functionality tests but server won&#39;t run?</h1>
<h3>2018-03-05T01:15:25Z</h3>
<div><p>If I run sudo make check I pass everything from app functionality through Ex4. But when I try to launch the server, this happens:</p>
<p></p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/hzneed7i7y26oj/jedimrevectx/Screen_Shot_20180304_at_7.52.37_PM.png" alt="" /></p>
<p></p>
<p>I assume something I did in exercise 4 is causing it; I didn&#39;t think to check running the server directly since all the make check tests passed (yes, dumb, I know). It looks like zookfs and zookd can&#39;t get at some file they need, but I&#39;m having a hard time figuring out what I could&#39;ve done that would make both of them pass the make check tests but fail here?</p>
<p></p>
<p>zookld.out has this:</p>
<p></p>
<p>zookd: Forward /zoobar/index.cgi/users to service 1</p>
<p>Traceback (most recent call last):</p>
<p>  File &#34;/zoobar/profile.py&#34;, line 11, in run_profile</p>
<p>    with rpclib.client_connect(&#39;/profilesvc/sock&#39;) as c:</p>
<p>  File &#34;/zoobar/rpclib.py&#34;, line 96, in client_connect</p>
<p>    sock.connect(pathname)</p>
<p>  File &#34;/usr/lib/python2.7/socket.py&#34;, line 228, in meth</p>
<p>    return getattr(self._sock,name)(*args)</p>
<p>error: [Errno 2] No such file or directory</p>
<p></p></div>
<h2>Student Answer</h2>
<div><p>Try running make and sudo make setup before running the server.</p></div>
<h2>Followup</h2>
<div><p>Thank you! My server launches. It crashes when I try to access it in my browser saying this:</p>
<p></p>
<p>zookd: [32042] Request failed: Error dispatching request: /</p>
<p></p>
<p>I guess / doesn&#39;t match either of my URL regexes, but it doesn&#39;t seem like it should, either. Was I responsible for doing something to forward that to /zoobar/index.cgi?</p></div>
<h3>Followup Response</h3>
<div><p>Resolved, had some wrong permissions</p></div><hr><h1>CPU time</h1>
<h3>2018-03-04T20:08:18Z</h3>
<div><p>The 2B instructions say : &#34;If your solution uses much more than a minute of real time for the 2B tests, or much more than 5 seconds of CPU time, you may run into trouble later on&#34;. My solution uses this much:</p>
<p></p>
<p>PASS</p>
<p>ok   raft 43.961s</p>
<p></p>
<p>real 0m44.491s</p>
<p>user 2m35.474s</p>
<p>sys 0m1.319s</p>
<p></p>
<p>Does this mean I will fail the test cases for 2B or does this mean that I will have trouble in 2C. I am trying to decide if I should fix this problem now or just submit 2B and fix this problem in 2C. </p></div>
<h2>Student Answer</h2>
<div><p>Wrong class.</p></div>
<h2>Followup</h2>
<div><p>wrong class sorry!!</p></div><hr><h1>FAIL Exercise 5: no auth-server.py running with access to cred.db</h1>
<h3>2018-03-03T21:54:11Z</h3>
<div><p>I passed up to Exercise 6, but then I&#39;m failing Exercise 5 again after I implemented to use bank-server.py for Exercise 7.</p>
<p></p>
<p>When I open the page from my browser, registrations and logins work fine as before, so I&#39;m not exactly sure what&#39;s meant by &#39;no auth-server.py runing&#39;. If all registrations and logins are done through authsvc, and &#39;auth-server.py&#39; was not running, how come registrations and logins still work?</p></div>
<h2>Student Answer</h2>
<div><p>Resolved after changing permissions for bank_svc</p></div><hr><h1>No reading question for Monday right?</h1>
<h3>2018-03-03T17:19:26Z</h3>
<div><p>Monday March 5 says</p>
<pre>LEC 8 (guest): Paul Youn from Airbnb </pre>
<p>So there&#39;s no reading or reading question, right?</p></div>
<h2>Staff Answer</h2>
<div><p>Correct.</p></div><hr><h1>Setting up permissions so dynamic_svc can&#39;t access files in &#96;/zoobar/templates&#96;</h1>
<h3>2018-03-03T00:31:53Z</h3>
<div><p>When I set up my permissions so dynamic_svc <strong>can&#39;t</strong> access files in &#96;/zoobar/templates&#96; (which contains static files) I get the following error. </p>
<pre>/zoobar/debug.py:23 :: __try : caught exception in function index:
 Traceback (most recent call last):
  File &#34;/zoobar/debug.py&#34;, line 20, in __try
    return f(*args, **kwargs)
  File &#34;/zoobar/login.py&#34;, line 62, in loginhelper
    return page(*args, **kwargs)
  File &#34;/zoobar/index.py&#34;, line 17, in index
    return render_template(&#39;index.html&#39;)
  File &#34;/usr/lib/python2.7/dist-packages/flask/templating.py&#34;, line 127, in render_template
    return _render(ctx.app.jinja_env.get_or_select_template(template_name_or_list),
  File &#34;/usr/lib/python2.7/dist-packages/jinja2/environment.py&#34;, line 851, in get_or_select_template
    return self.get_template(template_name_or_list, parent, globals)
  File &#34;/usr/lib/python2.7/dist-packages/jinja2/environment.py&#34;, line 812, in get_template
    return self._load_template(name, self.make_globals(globals))
  File &#34;/usr/lib/python2.7/dist-packages/jinja2/environment.py&#34;, line 774, in _load_template
    cache_key = self.loader.get_source(self, name)[1]
  File &#34;/usr/lib/python2.7/dist-packages/flask/templating.py&#34;, line 60, in get_source
    return loader.get_source(environment, local_name)
  File &#34;/usr/lib/python2.7/dist-packages/jinja2/loaders.py&#34;, line 171, in get_source
    f = open_if_exists(filename)
  File &#34;/usr/lib/python2.7/dist-packages/jinja2/utils.py&#34;, line 151, in open_if_exists
    return open(filename, mode)
IOError: [Errno 13] Permission denied: &#39;/zoobar/templates/index.html&#39;</pre>
<p>Then, when I set up my permissions so dynamic_svc <strong>can</strong> access files in &#96;/zoobar/templates&#96; the error goes away and my code passes all tests for lab 2, part 1.</p>
<p></p>
<p>This tells me dynamic_svc needs to have access to &#96;/zoobar/templates&#96; in order to not throw errors, but this isn&#39;t what I want to do from a security perspective since it&#39;ll give dynamic_svc permission to modify static files inside &#96;/zoobar/templates,&#96; so I&#39;m not sure what I&#39;m supposed to do to get rid of the error while also making sure dynamic_svc <strong>can&#39;t</strong> access &#96;/zoobar/templates&#96;.</p>
<p></p>
<p>Is it true that dynamic_svc needs to have access to &#96;/zoobar/templates&#96; in order to not throw the error above or am I missing something?</p>
<p></p>
<p>Thanks!</p></div>
<h2>Student Answer</h2>
<div><p>To me it seems that it dynamically renders the templates.</p></div><hr><h1>How do I know what processes is trying to open &#96;/zoobar/templates/index.html&#96;?</h1>
<h3>2018-03-02T21:33:41Z</h3>
<div><p>In my chroot-setup.sh, I have the following lines of code, where 1002 is the uid of static_svc.</p>
<pre># set permissions for files in templates<br />chown -R 1002:1002 /jail/zoobar/templates<br />chmod -R 505 /jail/zoobar/templates    # later changed to: chmod -R 500 /jail/zoobar/templates</pre>
<p>With this setup, all the tests for lab2, part 1 passed, however, when I reduced the number of users who are allowed to access &#96;/jail/zoobar/templates&#96; by changing the othe&#96; permissions from read/execute to none (change from 505 to 500), I got the following error:</p>
<pre>/zoobar/debug.py:23 :: __try : caught exception in function index:<br /> Traceback (most recent call last):<br />  File &#34;/zoobar/debug.py&#34;, line 20, in __try<br />    return f(*args, **kwargs)<br />  File &#34;/zoobar/login.py&#34;, line 62, in loginhelper<br />    return page(*args, **kwargs)<br />  File &#34;/zoobar/index.py&#34;, line 17, in index<br />    return render_template(&#39;index.html&#39;)<br />  File &#34;/usr/lib/python2.7/dist-packages/flask/templating.py&#34;, line 127, in render_template<br />    return _render(ctx.app.jinja_env.get_or_select_template(template_name_or_list),<br />  File &#34;/usr/lib/python2.7/dist-packages/jinja2/environment.py&#34;, line 851, in get_or_select_template<br />    return self.get_template(template_name_or_list, parent, globals)<br />  File &#34;/usr/lib/python2.7/dist-packages/jinja2/environment.py&#34;, line 812, in get_template<br />    return self._load_template(name, self.make_globals(globals))<br />  File &#34;/usr/lib/python2.7/dist-packages/jinja2/environment.py&#34;, line 774, in _load_template<br />    cache_key = self.loader.get_source(self, name)[1]<br />  File &#34;/usr/lib/python2.7/dist-packages/flask/templating.py&#34;, line 60, in get_source<br />    return loader.get_source(environment, local_name)<br />  File &#34;/usr/lib/python2.7/dist-packages/jinja2/loaders.py&#34;, line 171, in get_source<br />    f = open_if_exists(filename)<br />  File &#34;/usr/lib/python2.7/dist-packages/jinja2/utils.py&#34;, line 151, in open_if_exists<br />    return open(filename, mode)<br />IOError: [Errno 13] Permission denied: &#39;/zoobar/templates/index.html&#39;</pre>
<p>This tells me another process aside from static_svc is trying to open &#96;/zoobar/templates/index.html&#96;, but I&#39;m having a hard time figuring out which one. Does anyone have any suggestions about things I can do to figure out which process is trying to open &#96;/zoobar/templates/index.html?</p>
<p></p>
<p>Thanks!</p></div><hr><h1>zookfs: [20087] Request failed: File does not exist: //zoobar/index.cgi/login</h1>
<h3>2018-03-02T17:04:20Z</h3>
<div><p>I know this has been asked before, but the answer was that there is a permissions issue.</p>
<p></p>
<p>But even when setting permissions to 777, this still occurs. So I&#39;m completely lost, since granting full permissions still yields the error, so it can&#39;t be a permissions issue.</p></div>
<h2>Student Answer</h2>
<div>Run ls -l of a dir to see what the permissions are for each file and folder in it. Maybe the file has correct permissions but the folder it’s contained in does not?</div>
<h2>Followup</h2>
<div><p></p><pre>chmod -R 777 /jail/zoobar</pre>
<p>So everything should be full permission...</p>
<p></p>
<p>But it still doesn&#39;t work</p></div>
<h3>Followup Response</h3>
<div>Double check with ls -l that it actually did what you think it did?</div>
<h2>Staff Answer</h2>
<div><p>Did you make sure that you have a rule that handle this url request properly in .conf?</p></div>
<h2>Followup</h2>
<div><p>resolved, turned out regex was wrong</p></div><hr><h1>zookld UID/GID?</h1>
<h3>2018-03-02T16:23:41Z</h3>
<div><p></p><pre>zookld: execv /zoobar/echo-server.py 4: Permission denied</pre>
<p></p>
<p>Are my permissions too strict?</p>
<p>What UID/GID does zookld run under?</p>
<p>For that matter, what does zookd and zookfs run under?</p>
<p></p>
<pre>zookfs: [18459] Request failed: File does not exist: //zoobar/index.cgi/login</pre>
<p></p>
<p>I&#39;m really lost because I don&#39;t want to make the permissions too permissive (so I&#39;m setting things like chmod 600), but that seems to make zoold,zookd, and zookfs not work. </p></div>
<h2>Student Answer</h2>
<div>UIDs are defined in zook.conf (you also have to call fns in the C code to actually set them).</div><hr><h1>Lab 2, Exercise 3</h1>
<h3>2018-03-02T16:21:08Z</h3>
<div><p>Originally I though I should set the permissions of the files in /zoobar/db to 600 (only user can read/write), however, when I did that I got the following error:</p>
<pre>OperationalError: (pysqlite2.dbapi2.OperationalError) unable to open database file</pre>
<p>Then I changed the permissions to 755 (user can read/write/execute, group can read/execute, other can read/execute) and I passed the tests for exercise 3.</p>
<p></p>
<p><strong>Why am I getting &#96;OperationalError: unable to open database file&#96; when I set the permissions to 600?</strong> I might be missing something but I don&#39;t see why 600 is incorrect. <strong>Why do the exercise 3 tests pass when I set the permissions to 755?</strong> Again, I might be missing something but I thought we only wanted user to be able to read the files in the database.</p></div>
<h2>Student Answer</h2>
<div><p>It looks like someone else was tryin to access the files! You should look at what services might need to access the database, and fine tune the permissions from there.</p></div>
<h2>Followup</h2>
<div><p>But how do we figure out what the permissions for zookld, zookd, and zookfs are?</p></div>
<h3>Followup Response</h3>
<div><p>You set those in zook.conf.</p>
<p></p>
<p>Other question, what would you recommend doing to find out which processes need to read files from the database?</p></div><hr><h1>make submit throwing an error</h1>
<h3>2018-03-02T06:57:25Z</h3>
<div><p>I&#39;m trying to submit my lab2 part A via the make submit-a and make prepare-submit-a commands but I get this error:</p>
<p></p>
<pre><br />rm -f *.o *.pyc *.bin zookld zookfs zookd
tar cf - &#96;find . -type f | grep -v &#39;^\.*$&#39; | grep -v &#39;/CVS/&#39; | grep -v &#39;/\.svn/&#39; | grep -v &#39;/\.git/&#39; | grep -v &#39;lab[0-9].*\.tar\.gz&#39; | grep -v &#39;/submit.token$&#39; | grep -v libz3str.so&#96; | gzip &gt; lab2a-handin.tar.gz
tar: ./.TemporaryItems/folders.501/._Cleanup: Cannot stat: No such file or directory
tar: At: Cannot stat: No such file or directory
tar: Startup: Cannot stat: No such file or directory
tar: Exiting with failure status due to previous errors
./submit.py lab2a-handin.tar.gz
Submitted lab2a-handin.tar.gz.
Please visit http://css.csail.mit.edu/6.858/2015/labs/handin.html
to verify the upload.</pre>
<p></p>
<p>It seems to have uploaded the tar.gz file onto the server, but the messages concern me.</p></div>
<h2>Staff Answer</h2>
<div><p>I&#39;m not sure about that error, but you can still verify that you upload successfully by downloading the .tar.gz you just uploaded and extract to see if you latest change in some file is as expected or not. Hope this help.</p></div><hr><h1>make check</h1>
<h3>2018-03-02T05:49:19Z</h3>
<div><p>Do we need to pass the tests below &#34;App functionality&#34; (e.g. Profile hello-user.py) ?</p></div>
<h2>Student Answer</h2>
<div>I’m almost sure those are for part 2, so no. Staff can confirm, though!</div><hr><h1>Exercise 3 Extent of Permissions Setting</h1>
<h3>2018-03-02T05:37:33Z</h3>
<div>Does every file in /jail need to be set so that it can only be read by intended processes?</div>
<h2>Staff Answer</h2>
<div><p>That&#39;s really depend on the secured level you want. <br /><br />Let me speak in general.<br />Some files don&#39;t really need much protection. Meanwhile some files need that even if it is not serve in zook.conf to the client<br />Think about this scenario<br />only service X should be able to read SECRET<br />But you allow Y to have that permission without allowing Y to serve it.<br />Y get compromised -&gt; the attacker get the SECRET.<br /><br />That&#39;s why OKWS make multiple services, right?</p></div><hr><h1>Enforce strong permission?</h1>
<h3>2018-03-02T05:06:41Z</h3>
<div><p>Are we expected to use permission other than 755? From my understanding, any executable script in zoobar will not be modified once &#34;make setup&#34; is run, so no user should be able to write to those files? Similarly, should we disable permission to &#34;other&#34; user, if appropriate?</p></div>
<h2>Student Answer</h2>
<div><p>One of our goals is to minimize damage if an adversary compromises some part of the system, so you should probably see if you can get by with stronger permissions... For example, when would we need an &#34;other&#34; use to read, write, or execute our files?</p></div><hr><h1>Exercise 4</h1>
<h3>2018-03-02T04:05:54Z</h3>
<div><p>This question is similar to &#64;195 and &#64;176.</p>
<p></p>
<p>When I modified &#96;launch_svc()&#96; so that it jails the process being created using &#96;chroot()&#96;, I got the following error: &#34;Exception: wget failed: --2018-03-02 03:18:35-- http://localhost:8080/zoobar/index.cgi/login&#34;</p>
<p></p>
<p>Then, when I looked at the &#96;/tmp/zookld.out&#96; I found one line that said the following: &#34;zookfs: [8275] Request failed: File does not exist: (unreachable)/home/httpd/lab/zoobar/index.cgi/login&#34;</p>
<p></p>
<p>This suggests that the exception was thrown because &#96;zookfs&#96; couldn&#39;t reach &#96;/home/httpd/lab&#96;, which makes sense since I called &#96;chroot()&#96;, but I&#39;m not sure how to fix the application so that &#96;zookfs&#96; requests things from &#96;/jail/&#96; instead of from &#96;/home/httpd/lab&#96;. Is there anything you&#39;d recommend looking at to figure this out? </p>
<p></p></div>
<h2>Student Answer</h2>
<div><p>I also run into this an solved it by changing the working directory to the jail.</p>
<p>So that all relative paths are also constrained.</p>
<p></p>
<p></p></div>
<h2>Followup</h2>
<div><p>Thanks! Out of curiosity, did you do anything else aside from changing the working directory? I added the following lines of code inside &#96;launch_svc()&#96; but I&#39;m still getting the same error: &#34;zookfs: [8731] Request failed: File does not exist: (unreachable)/home/httpd/lab/zoobar/index.cgi/login&#34;</p>
<p></p>
<pre>chroot(dir);<br />chdir(dir);<br />// dir = &#34;/jail&#34;</pre>
<p></p>
<p></p></div>
<h3>Followup Response</h3>
<div><p>&#64;201</p></div>
<h3>Followup Response</h3>
<div><p>Nevermind. I figured it out. I was supposed to call chdir() before calling chroot(). Thanks!</p></div>
<h3>Followup Response</h3>
<div><p>Ah sorry I just saw that you did chdir already. Maybe I should avoid answering Piazza during very late night ;)</p></div><hr><h1>Why do we need to set permissions for /index/login.cgi to work?</h1>
<h3>2018-03-02T02:53:30Z</h3>
<div><p>Like, I did it after reading through the piazza posts, and it worked... but why? Does setting permissions name the uid and gid for a process? Why couldn&#39;t the program checker find &#34;/index/login.cgi&#34; otherwise? </p>
<p></p>
<p></p></div>
<h2>Student Answer</h2>
<div><p>You can check the permissions of the files/directories inside of jail by using &#34;sudo ls -al {directory}&#34; and it will show the list of the contents of the directory with the owner and group id&#39;s that have access to the file and their permissions rwx. I think unless you add permissions, these all should belong to root, which is why the other service cannot access the db. </p></div><hr><h1>No args in static_svc?</h1>
<h3>2018-03-02T02:05:13Z</h3>
<div><p>Why do we need args in static_svc, especially since we don&#39;t want them to execute any cgi scripts? Make check is failing my ex4 test because of that. </p>
<p></p>
<p>Also how do we associate cgi scripts with args? Do we make new sections and associate them with uids/gids?</p></div>
<h2>Student Answer</h2>
<div><p>I set it to a uid/gid that isn&#39;t used so to prevent it to start any cgi scripts.</p>
<p>Think about the situation where a user might be able to upload a file and then it will be owned by static_svc.</p>
<p></p></div>
<h2>Followup</h2>
<div><p>Why should it be owned by static_svc? </p></div>
<h3>Followup Response</h3>
<div><p>zookd passes all requests that match the regex value for static_svc&#39;s &#34;url&#34; key to static_svc. If, as Valentin said, the user could upload a file from one of these requests, static_svc would handle it, so static_svc would be its owner afaik.</p></div>
<h3>Followup Response</h3>
<div><p>Or if your application actually handles user uploaded content you often have to serve them back to the user.</p>
<p></p>
<p>Think about profile pictures, so you would want to chown them to staric_svc and also prevent static_svc from executing any of them. Defense in depth.</p></div><hr><h1>Exec Format Error?</h1>
<h3>2018-03-02T01:36:24Z</h3>
<div><p>I am working on exercise three and trying to edit permissions. I am getting a:</p>
<p></p>
<pre>Request failed: execl //zoobar/media/zoobar.css: Exec format error</pre>
<p></p>
<p>I&#39;m wondering what exactly this is? Does this mean I didn&#39;t set the permission for that particular file properly?</p></div>
<h2>Staff Answer</h2>
<div><p>My guess is that server may try to serve .css  as an executable file. Think about when you want to use css. What kind of file format (permission) you want ?</p></div><hr><h1>Are the tests comprehensive?</h1>
<h3>2018-03-02T01:10:50Z</h3>
<div><p>Are there hidden tests beyond the &#39;Exercise 2...Exercise 4&#39; ones that will be used to grade our code? Or is it fine if we just pass those?</p></div>
<h2>Staff Answer</h2>
<div><p>Most time, tests aren&#39;t comprehensive. However, the lab handout already gave you ideas and examples of what you should do. The goal of labs is to make sure that you understand what you are doing and be able to put that into practice rather than beating all the edge cases like 6.005, 6.170, or 6.172.<br /><br />Usually when you pass the test we provided without using bad tricks and no prominent security issues, you should be able to pass the grading script :)</p></div><hr><h1>How to set Permissions?</h1>
<h3>2018-03-02T00:45:48Z</h3>
<div><p>I am currently trying to edit chroot-setup.sh to set permissions for exercise 3. How exactly do you edit the permissions in this file? I continually get &#34;No such file or directory&#34; errors when trying to sudo make setup, even if I just try to set the owner to root, and when the files are definitely there.</p></div>
<h2>Student Answer</h2>
<div><p>Resolved - make sure you put /jail/ in front of all of your files in zoobar!</p></div><hr><h1>Part 4: DB directly accessible error</h1>
<h3>2018-03-01T23:26:38Z</h3>
<div><p>I&#39;ve ensured that the zoobar/db and zoobar/db/person and transfer folders all have RWX but I am constraining the person.db and transfer.db to be RW only but I&#39;m still getting this error and not sure why. All of these are further only accessible to the dynamic_svc.</p></div>
<h2>Student Answer</h2>
<div><p>Try looking at the regex you are using for the URL field of <em>dynamic_svc</em>. You don&#39;t want it to just serve the database file if it&#39;s requested directly in the URL. Looking at the failing test case might help, too.</p></div><hr><h1>Ex 3 Unable to Open Database File</h1>
<h3>2018-03-01T22:02:44Z</h3>
<div><p>I set the permissions for 755 for /jail/zoobar/db/person/person.db files for my processes, but I&#39;m getting an operational error: Unable to open database file.</p>
<p></p>
<p>I tried 777 permissions, but that didn&#39;t work either. Should I be working in the jail directory? Before I changed permissions, the error I was getting was &#34;cannot write to an read-only file&#34;.</p></div>
<h2>Student Answer</h2>
<div><p>OK, the reason that happened was because I only granted permission to &#34;jail/zoobar/db/person/person.db&#34;, but I also need to grant permission to &#34;jail/zoobar/db/person&#34; so that the process could also access the containing folder.</p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p></div>
<h2>Followup</h2>
<div><p>Ok, so I think I&#39;m doing the right thing, and when I run the server with sudo ./zookld zook.conf, I am able to log in just fine. I checked the ownership of the person.db file and the jail.zoobar/db/person folder (using ls -al /jail/zoobar) and service 1 (zookfs_svc) has rwx to all of it by the permissions I set in zook.conf, but when I run make check, I still get the same 500 error you had before. </p></div>
<h3>Followup Response</h3>
<div><p>I had put the set_perm items before the db gets deleted and remade in the file...</p></div><hr><h1>Quiz 1: 2017 (III Baggy Bounds Checking)</h1>
<h3>2018-03-01T21:49:44Z</h3>
<div><p>In #7, how do we know the start address is 0x10010060?</p></div>
<h2>Staff Answer</h2>
<div><p>Hope this make sense :)<br /><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/iebp5si0qx78q/jew51k66o4qa/29314749_10213829489425501_2329642698606116864_o.jpg" alt="" /></p></div>
<h2>Followup</h2>
<div><p>so is the slot on both sides of the buffer?</p></div>
<h3>Followup Response</h3>
<div><p>You only need to be concerned with the slot between 0x10010050 and 0x10010060 because the slot size is 16 bits, and 0x1001005a falls between those two addresses. Because the OOB bit is set and the program didn&#39;t produce an error, you know that the pointer is within half a slot from the allocated buffer. Therefore you know that the beginning of your buffer must start at 0x10010060.</p></div>
<h3>Followup Response</h3>
<div><p>is the 0xc the 3 other variables on the stack above the buffer?</p></div>
<h3>Followup Response</h3>
<div><p>p-&gt;d = p&#43; 0xC because the relative location of its is 0xC from the struct base location</p></div><hr><h1>clarifying question about exercise 3</h1>
<h3>2018-03-01T21:39:10Z</h3>
<div><p>In the first part of this, we are supposed to edit the launch_svc function in zookld.c, to implement the setresuid, setresgid, and setgroups system calls. There is skeleton code for where we are supposed to implement these calls. However, it asks us if we are supposed to set the uid before chroot or setting the groupid. Does this mean that the skeleton code is wrong? Are we supposed to move the order around? I&#39;m confused ...</p></div>
<h2>Staff Answer</h2>
<div><p>Yes you can change the skeleton. The skeleton is provided to help guide you but still does want you to think about the order so that you can learn about this setting these uid, gid, ...<br />My advice to verify that your order work or not is to check the result of function call to set those stuff which return meaningful result of whether it succeed or not. </p></div><hr><h1>Are we allowed to modify http.c for Lab 2 Part 1?</h1>
<h3>2018-03-01T21:23:23Z</h3>
<div><p></p></div>
<h2>Staff Answer</h2>
<div><span style="background-color:#fff">In this lab2 part 1, you’ll only need to modify zookld.c, zook.conf, and chroot-setup.sh :)</span><div><br /><div><span style="background-color:#fff">We highly recommend not changing other files because it may cause unknown issues later or fail backward compatibility. </span></div></div></div><hr><h1>&#96;check_ex&#96; in &#96;check_lab2.py&#96;</h1>
<h3>2018-03-01T19:18:19Z</h3>
<div><p></p><pre>sh(&#34;find /jail -uid %d -gid %d &gt; /tmp/executable.log&#34; % (uid, gid))</pre>
<p></p>
<p>This check is supposed to find all executable files belonging to a certain user. </p>
<p>At least that how I understand it&#39;s usage and the failure it causes. But rather </p>
<p>than finding all executables, it finds all files (and directories) belonging to a user</p>
<p>causing spurious failures.</p>
<p></p>
<p>Using instead:</p>
<p></p>
<pre>find /jail -uid %d -gid %d -perm /111 -not -type d</pre>
<p></p>
<p>  Correctly finds all executable files belonging to &#96;uid&#96; (technically we should have an &#96;uid&#96; OR &#96;gid&#96;) test.</p>
<p>I encounter this because SQLLite fails if the directory that contains the db is not writable by the uid...</p>
<p></p>
<p></p>
<pre>-perm /mode<br />              Any of the permission bits mode are set for the file</pre>
<p></p></div><hr><h1>Exercise 4: confusing question syntax</h1>
<h3>2018-03-01T15:54:42Z</h3>
<div><p>&#34;Both should use <tt>cmd = zookfs</tt>. <tt>dynamic_svc</tt> should execute just <tt>/zoobar/index.cgi</tt> (which runs all the Python scripts), but should not serve any static files. <tt>static_svc</tt> should serve static files but not execute anything.&#34;</p>
<p></p>
<p>This says we should use zookfs.dynamic_svc for both static_svc and dynamic_svc. Is that a correct interpretation?</p>
<p></p>
<p></p></div>
<h2>Student Answer</h2>
<div><p>cmd = zookfs. The period is not a dot as in object notation, it&#39;s a period as in grammar.</p></div><hr><h1>Trying to fix lab 1</h1>
<h3>2018-03-01T14:30:34Z</h3>
<div><p>Hi,</p>
<p>When I run the server, I&#39;m getting /home/httpd/lab(null) does not exist. Since I&#39;m limiting the char buffer of reqpath to 2048, is this because I&#39;m truncating my buffer too much? I&#39;m confused since it looks like we&#39;re supposed to try and fix the buffer overflow by limiting the total number of characters for reqpath.</p></div>
<h2>Followup</h2>
<div><p>Resolved</p></div><hr><h1>Exercise 4 Zookd not adding /jail to services</h1>
<h3>2018-03-01T06:44:00Z</h3>
<div><p>zookd in the zookld.out shows to be launching services by adding a / in front.</p>
<p></p>
<p>So the log has:</p>
<p>zookd: Forward /zoobar/index.cgi/login to service 1</p>
<p>zookfs: [4511] Request failed: File does not exist: //zoobar/index.cgi/login</p></div>
<h2>Staff Answer</h2>
<div><p>Actually that&#39;s not the real issue that cause an error. Focusing on the permission you gave to login.py.</p></div>
<h2>Followup</h2>
<div>Can&#39;t find file //zoobar/index.cgi
I&#39;m passing the tests, but when I try to access IP:8080/zoobar/index.cgi/ I get told that the server can not find file //zoobar/index.cgi/. Any idea what may be wrong?</div>
<h2>Student Answer</h2>
<div><p>so apparently you have to do &#39;sudo make setup&#96; every time you change the chroot-setup.sh file if you want to see the changes. i had no idea until just now, maybe that will help you</p></div><hr><h1>Static files?</h1>
<h3>2018-03-01T06:29:40Z</h3>
<div><p>What does the term static files mean? I know that HTML files count as static files, but I&#39;m not sure where to draw the line. Do images, javascript, css, other media, and text files count as static files? What about python scripts and CGI scripts and shell scripts? If the dynamic serve cannot modify <em>static files</em>, can they <em>modify</em> the script files?</p>
<p></p>
<pre>Set file and directory permissions (using chroot-setup.sh) to ensure that the static service cannot read the database files, that the dynamic service cannot modify static files.</pre>
<p></p></div>
<h2>Student Answer</h2>
<div><p>I believe html and css are enough.</p></div><hr><h1>Are UIDs/GIDs deterministic (same every run)?</h1>
<h3>2018-03-01T06:16:30Z</h3>
<div><p>If we use id # command to determine which UIDs and GIDs are unused (as per &#64;172), then will it ever the case that another process uses up those GIDs or UIDs? As in, is it okay to hard-code the UIDs and GIDs based on what we determine statically is available, or do we need to dynamically calculate it (seems difficult, since zook.conf is a static file that doesn&#39;t execute arbitrary code)?</p></div>
<h2>Followup</h2>
<div><p>I have the same questions. Are we supposed to hardcode the UIDs and GIDs? Can those IDs be anything as long as they are unused? If we hardcode the IDs, how can we be sure that our code will work on the grader&#39;s machine?</p></div>
<h2>Student Answer</h2>
<div><p>It seems from looking at setresuid and setresgid that there&#39;s some idea of your &#34;real&#34; id and also an id that the os can use to check your permissions. I think this helps? </p></div><hr><h1>Permissions</h1>
<h3>2018-03-01T06:13:52Z</h3>
<div><p>I&#39;m trying to figure out what the permissions should be, and there seems to be a lot of discretion involved. For example, should only HTML pages be served? What about CSS or Javascript? Image files? Other media? The database shouldn&#39;t be displayed, but what about the python scripts, or local text files? Is it enough that they aren&#39;t executable, or should they not be shown either? I&#39;m trying to figure out how much freedom to express in my URL handler, so I cover all the cases I&#39;m supposed to cover.</p>
<p></p>
<p>It&#39;s just I&#39;m not sure exactly what security restrictions the lab wants us to place on zookws. Are we, for example, allowed to assume that the current contents of zoobar/ is what is going to be in the application, or do we need to handle general cases where some files present now may be missing in the future, and additional files may be added? Can we assume anything about the directory structure (presence of zoobar/db/ for example)?</p></div>
<h2>Followup</h2>
<div><p>Can we cherry-pick the files in /jail that we think will be needed for each service and set permissions appropriately in chroot-setup.sh? Or do we need to handle general cases in which the /jail directory contents will be different?</p></div><hr><h1>Exercise 3 - 404 error</h1>
<h3>2018-03-01T04:24:23Z</h3>
<div><p>In exercise 3, I have correctly added the IDs and groups in zookld.c and am working on changing permissions in chroot-setup. Earlier, when I ran make check, I got a 500 error about attempting to write to a read only database. Now, after restarting my VM and running make setup again, I have a 404 file does not exist //zoobar/index.cgi/login. Any idea how I can resolve the 404 error? </p></div>
<h2>Staff Answer</h2>
<div><p>That means your server didn&#39;t handle the login request properly. Check the server log for more detail.<br />It usually come from <br />1. the handle process doesn&#39;t have permission on login.py, or other related files.<br />2. no handler for this request because the url route doesn&#39;t match any of your rule in zookd.conf<br />Keep in mind that you may came across more 404 after fixing this one, so think about this general ideas of permission, handler, and maybe other issue that will make you have problem. Always check the server log and test from browser (like what you do now) before running any check. :)</p></div><hr><h1>static_svc allows execution of /jail/tmp/http_request_headers</h1>
<h3>2018-02-28T23:50:11Z</h3>
<div><p>When working on exercise 4 for lab 2, I get an error when running &#96;sudo make check&#96; that &#34;static_svc allows execution of /jail/tmp/http_request_headers.&#34; After digging into this file a bit, I noticed that it&#39;s created in &#96;http.c&#96; when handling requests, seemingly for the sole purpose of checking which uid processed which request. So, a test checks to see if &#96;static_svc&#96; and &#96;dynamic_svc&#96; serve content from different uids, and a following test verifies that &#96;static_svc&#96; can&#39;t execute anything in the &#96;/jail&#96; directory by checking that &#96;find /jail -uid {{uid}} -gid {{gid}}&#96; is empty. &#96;http_request_headers&#96; is not deleted before the next test is run.</p>
<p></p>
<p>&#96;static_svc&#96; creates &#96;http_request_headers&#96;, so I&#39;m assuming it&#39;ll show up in the &#96;find&#96; command, even though its permissions are 644, I believe. But, this doesn&#39;t mean that &#96;static_svc&#96; can erroneously execute the file. Is the logic of this test correct?</p></div>
<h2>Staff Answer</h2>
<div><p>One thing to note is that the uid and gid of &#96;find /jail -uid {{uid}} -gid {{gid}}&#96; isn&#39;t the uid / gid of the process, but instead they are taken from a particular setting in the conf file (I&#39;ll leave it as an exercise to find out which line it is). </p>
<p></p>
<p>You&#39;re right that the permissions are 644. If &#96;static_svc&#96; created &#96;http_request_headers&#96;, that also means that it is the owner of the file. The owner can always change the permissions on the file, so having 644 on the file may not prevent the owner from executing the file. One exercise that you can try for fun to see this (at least this convinced me): </p>
<p></p>
<p>1. touch tmp.txt</p>
<p>2. ls -la to see the permissions and the owner</p>
<p>3. chmod 000 tmp.txt</p>
<p>4. ls -la to see the permissions again</p>
<p>5. chmod 777 tmp.txt<br />6. ls -la to compare permissions</p></div>
<h2>Followup</h2>
<div><p>Thanks for elaborating - I still have a few questions, though. So the permissions are 644, which means that (without chmoding at least) someone trying to execute &#96;http_request_headers&#96; through  &#96;static_svc&#96; would still get a &#34;Permission denied&#34; error. So, the error message that &#34;static_svc allows execution of /jail/tmp/http_request_headers&#34; is incorrect. My question is if these files are supposed to be deleted before running &#96;find /jail -uid {{uid}} -gid {{gid}}&#96;</p></div>
<h3>Followup Response</h3>
<div><p>Thank you, that is a fair point about the error message, let me get back to you on that. For the files, no I don&#39;t think they are supposed to be deleted before running the &#96;find /jail -uid {{uid}} -gid {{gid}}&#96;. Did you find out where uid / gid for that test was from? </p></div>
<h3>Followup Response</h3>
<div><p>It&#39;s from zook.conf, args line for [static_svc], correct? I have that properly set to the uid and gid of static_svc</p></div>
<h3>Followup Response</h3>
<div><p>My concern is that &#96;find /jail ...&#96; doesn&#39;t filter out non-executable files (I believe). But it is treated as the list of files that &#96;static_svc&#96; can execute</p></div>
<h3>Followup Response</h3>
<div><p>Maybe think of it in terms of limiting the damage that could happen if static_svc is compromised by an attacker. Would the attacker be able to change the contents of the non-executable file or create new files? Think about args as maybe a way to limit damage of an isolated static_svc</p></div><hr><h1>Error when running make check for ex 0</h1>
<h3>2018-02-28T22:45:52Z</h3>
<div><p></p><pre>[sudo] password for httpd: 
./check_lab2.py
&#43; setting up environment in fresh /jail..
&#43; running make.. output in /tmp/make.out
&#43; running zookld in the background.. output in /tmp/zookld.out
ERROR: Traceback (most recent call last):
  File &#34;./check_lab2.py&#34;, line 314, in main
    check_ex0()
  File &#34;./check_lab2.py&#34;, line 300, in check_ex0
    x = z_client.check()
  File &#34;/home/httpd/lab/z_client.py&#34;, line 84, in check
    html1, cookies1 = register(&#34;test1&#34;, &#34;supersecretpassword&#34;)
  File &#34;/home/httpd/lab/z_client.py&#34;, line 52, in register
    return login_page(&#34;register&#34;, user, password)
  File &#34;/home/httpd/lab/z_client.py&#34;, line 47, in login_page
    postdata, &#34;--keep-session-cookies&#34;])
  File &#34;/home/httpd/lab/z_client.py&#34;, line 22, in run_wget
    raise Exception(&#34;wget failed: %s&#34; % p.stderr.read())
Exception: wget failed: --2018-02-28 21:53:45--  http://localhost:8080/zoobar/index.cgi/login
Resolving localhost (localhost)... 127.0.0.1
Connecting to localhost (localhost)|127.0.0.1|:8080... connected.
HTTP request sent, awaiting response... 404 Error
2018-02-28 21:53:45 ERROR 404: Error.</pre>
<p></p>
<p>Is this due to lab 1 part 6 issues? Or are there configuration issues with merging (or problems with lab 2)? Since exercise 0 (which just tests functionality) isn&#39;t even passing, I&#39;m guessing it&#39;s issues with lab 1 that causes this? But the app ran just fine during part 1 (and I can still run the website locally fine...) Does part 2 require the stack to be a certain way (since I did have to change the stack layout/function headers) during part 6 in lab 1)?</p></div>
<h2>Followup</h2>
<div><p>I&#39;m having the same issue</p></div>
<h3>Followup Response</h3>
<div><p>so apparently chroot broke everything :(</p>
<p></p>
<p></p></div>
<h3>Followup Response</h3>
<div><p>&#64;176</p></div>
<h2>Staff Answer</h2>
<div><p>Usually if you&#39;re able to pass Ex1 of Lab2 (being able to run and view the web site  / create users ...), I think your Lab 1 is fine (and ex0 should pass). Working on the following parts of the lab may sometimes cause errors before reaching the first test. One good place to check when debugging is also /tmp/zookld.out, or looking in /jail.check which will is what the jail directory looked like during the test, so you can look at the directory contents, permissions etc...</p></div><hr><h1>How are labs graded?</h1>
<h3>2018-02-28T22:31:52Z</h3>
<div><p>Are labs graded manually or automatically (as in by running tests or by manually inspecting the code)?</p></div>
<h2>Staff Answer</h2>
<div>Depend on the lab. Most lab are automated tests but lab1 have both, so lab1 grading will take longer than usual.</div><hr><h1>Not seeing /tmp/zookld.out</h1>
<h3>2018-02-28T22:03:13Z</h3>
<div><p>The lab says &#34;Hint: look in <tt>/tmp/zookld.out</tt> for information about permission failures.&#34;  I haven&#39;t given my users permission for any of the folders, and as I expected I&#39;m getting a message that the server encountered an error when I try to log in, yet I don&#39;t see this file in the tmp folder. When is that file supposed to show up?</p></div>
<h2>Student Answer</h2>
<div><p>Oh, you know what, maybe I should give the processes permission to write to that file first. sigh, knucklehead moment....</p></div>
<h2>Staff Answer</h2>
<div>For debugging the server functionality, try run the server and test manually from the browser, you should be able to see the log from from stdout/stderr in the terminal you started the server.<div><br /></div><div>Another trick to get around the problem that your httpd permission is limited.</div><div>You can switch to “root” user and observe (read) the file /tmp/zookld.out in this case.</div></div><hr><h1>E3. Which directories are needed by each service.</h1>
<h3>2018-02-28T20:47:14Z</h3>
<div><p>I don&#39;t understand how we are supposed to figure out which files will be needed by each service.</p>
<p>As is, I understand that E3 is asking us to restrict some of the directories within /jail/ so that they can be accessed exclusively by either the zookd or the zookfs processes.</p>
<p>Reading through their source files, there is nothing within the processes that clearly indicates what data they need to access.</p>
<p></p>
<p>Can anyone clarify?</p></div>
<h2>Student Answer</h2>
<div><p>If you have assigned inadequate rights, some error will be printed. </p></div>
<h2>Staff Answer</h2>
<div><p>^&#43;1 . To further understand on what zookd and zookfs do which will be helpful for ex4, you can also observe which request is handle by zookd, zookfs from the server log and what file they are trying to execute or access.</p></div>
<h2>Followup</h2>
<div><p>Where is the server log?</p></div>
<h3>Followup Response</h3>
<div>In the terminal that you start the server by running sudo ./zookld zook.conf</div>
<h3>Followup Response</h3>
<div><p>After running the tests, if something fails you can check /tmp/zookld.out to see which server call has permission issues.</p></div><hr><h1>Merging Lab 1 code into Lab 2</h1>
<h3>2018-02-28T20:09:51Z</h3>
<div><p>When you are merging code from Lab 1 into Lab 2, remember to include http.c and zookd.c as part of the merge. </p>
<p></p>
<p>If you&#39;re having trouble viewing the web site during Exercise 1 of Lab 2, one cause might be the fixes made in Exercise 6 of Lab 1 were too strict. Please make sure the fixes from Lab 1 don&#39;t break the functionality and that you are able to see the web site before continuing. </p>
<p></p>
<p>Good luck with lab 2!</p>
<p></p>
<p></p>
<p>#pin</p></div><hr><h1>Comment in conf file?</h1>
<h3>2018-02-28T19:50:40Z</h3>
<div><p>In Exercise 4, should we completely delete the zookfs_svc section (below) and add [dynamic_svc] and [static_svc] with similar syntax? </p>
<p></p>
<pre>[zookfs_svc]<br />    cmd = zookfs<br />    url = .*<br />    uid = 200<br />    gid = 300<br />    dir = /jail<br />    # You can control what executables zookfs will run as CGI scripts<br />    # by specifying the UID/GID of allowed CGI executables, as follows;<br />    # uncomment and replace 123 and 456 with your intended UID and GID:<br />    #args = 123 456</pre>
<p>If so, I think I prefer to have it commented out. I tried appending &#34;#&#34; to each line in that segment but it seems to be still able to recognize zookfs_svc, but raises an error because &#34;cmd&#34; is commented out. </p>
<p></p></div>
<h2>Student Answer</h2>
<div><p>seems like # will work, and I can&#39;t reproduce the problem now. </p></div><hr><h1>Difference between user/group/other</h1>
<h3>2018-02-28T18:56:39Z</h3>
<div><p>I&#39;m a bit unclear on what each of these mean</p></div>
<h2>Staff Answer</h2>
<div><p>user = owner of the file/dir.<br />group = a group of user(s) that related to the file/dir.<br />other = all users<br /><br />You can set the permissions including read/write/execute apply to each of these groups so that different users have different privileges on these files.</p></div>
<h2>Followup</h2>
<div><p>What if a given user a belongs to a group y such that permissions on a file are RX for the user a but R only for the group y. Which has precedence? Or would such a situation generally not arise?</p></div>
<h3>Followup Response</h3>
<div><p>Only one set of permissions is used, and the order would be (user &gt; group &gt; other)</p></div>
<h3>Followup Response</h3>
<div><p>In your example, the user would have the RX permissions</p></div>
<h3>Followup Response</h3>
<div><p>To add on that. Think about &#34;giving a permission&#34; starting from initial state where no one has any permission. <br />An analogous real world example could be...<br /> Nickolai and Frans gave Yee Ling Gan permission to edit the lab handout and gave TAs (group) permission to grade the lab. Will Yee Ling Gan now canNOT edit the lab handout because of the group permission doesn&#39;t have that? <br />No. -&gt; She can still edit the lab handout because she has both permission.</p></div><hr><h1>No Jail Directory</h1>
<h3>2018-02-28T15:28:31Z</h3>
<div><p>There&#39;s no jail directory in my merged lab1, lab2 code.</p></div>
<h2>Student Answer</h2>
<div><p>It should be at the very root: /jail, parallel with /etc and /home. </p></div>
<h2>Staff Answer</h2>
<div>That’s expected because /jail is initialized by our server when you try to jail the root directory. The server can even use different directory name as root dir. You will find this directory after you run make, make setup.</div><hr><h1>Questions about Native Client</h1>
<h3>2018-02-28T05:56:28Z</h3>
<div><p>Page 5: I don&#39;t understand what they do to ensure that all indirect branches target an instruction identified during disassembly. How does ensuring that all targets of an indirect branch are aligned mod 32 guarantee that all indirect branches target an instruction identified during disassembly? What if the target is 0xFFFE0? This target is aligned mod 32 but might be outside the address space of the binary, so there might be no instruction there.</p>
<p></p>
<p>Page 5: Why is it necessary to constrain the executable text to a zero-based address range, sized to a multiple of 4K bytes?</p>
<p></p>
<p>Page 5: What is the CS segment and how can it be used to constrain the executable text?</p>
<p></p>
<p>Thanks!</p></div>
<h2>Staff Answer</h2>
<div><p>The x86 has variable-length instruction and the risk is that a computed jump in the NaCl module could jump in the middle of an instruction, and those bytes might be the opcode of an instruction that should be disallowed.  By making sure that all possible jump targets are at specific addresses (32-byte aligned) they know for sure that at any 32-byte address, the first byte will be the first byte of an instruction.  Furthermore, those instructions are validated by the validotor to be safe.</p>
<p></p>
<p>NaCl Modules cannot st/ld/jmp outside of 256Mbyte because Nacl uses the x86 segmentation hardware to constrain the target of those instructions.  They program the segmentation hardware to limit the maximum address to 256Mbyte.  The hardware will check that any address falls between 0 and 256Mbyte.</p>
<p></p>
<p>The segmentation hardware allows other values than 0 but they chose that one for convenience.  The 4Kbyte comes from how the Intel segmentation hardware works (in one mode segmentation is page granularity, which is 4Kbyte, and it seems that is what NaCl is using).</p>
<p></p>
<p>cs is the code segment selector.  the processor uses it to select the segment descriptor for code-related instructions like jmp.  With segmentation, each address is a pair of (selector, address).   the selector is used to indexed into the segmentation descriptor table.  the entry in the table contains a base and size.   When the processor executes an instruction, the address is checked against the size and, if within range, base is added.  By setting size to 256Mbyte, the NaCl modules cannot jump above 256Mbyte.</p>
<p></p>
<p></p>
<p></p>
<p></p></div><hr><h1>Exercise 4 regex</h1>
<h3>2018-02-28T04:10:23Z</h3>
<div><p>Will this match .*(?!/zoobar/index.cgi) anything that is not /zoobar/index.cgi . I don&#39;t know why is it not allowed (Bad Url for service 2)</p></div>
<h2>Staff Answer</h2>
<div><p>Apart from learning more about regex, this site <a href="https://regex101.com/">https://regex101.com/</a> could be useful for checking and testing regex expression. <br /><br /></p>
<p></p></div>
<h2>Followup</h2>
<div><p>Are we allowed to use &#34;?!&#34; here? The program seem to not allow my regex expression even though I tested it on the website.</p></div>
<h3>Followup Response</h3>
<div><p>I&#39;m not sure in your specific case, but it probably depends on regex parser. For example, ?! is technically not a regular expression (in the theoretical CS sense), but many regex engines nowadays allow it. In theory of computation, only | and * are allowed.</p></div><hr><h1>Can&#39;t load web page</h1>
<h3>2018-02-27T23:54:02Z</h3>
<div><p>I merged my changes with the new lab, patched flask, and ran the following commands.</p>
<p></p>
<p>1. make clean</p>
<p>2. make</p>
<p>3. sudo make setup</p>
<pre>./chroot-setup.sh<br />&#43; grep -qv uid=0<br />&#43; id<br />&#43; rm -rf /jail<br />&#43; mkdir -p /jail<br />&#43; cp -p index.html /jail<br />&#43; ./chroot-copy.sh zookd /jail<br />&#43; ./chroot-copy.sh zookfs /jail<br />&#43; ./chroot-copy.sh /usr/bin/env /jail<br />&#43; ./chroot-copy.sh /usr/bin/python2 /jail<br />&#43; ./chroot-copy.sh /usr/bin/openssl /jail<br />&#43; mkdir -p /jail/usr/lib /jail/usr/lib/i386-linux-gnu /jail/lib /jail/lib/i386-linux-gnu<br />&#43; cp -r /usr/lib/python2.7 /jail/usr/lib<br />&#43; cp /usr/lib/i386-linux-gnu/libsqlite3.so.0 /jail/usr/lib/i386-linux-gnu<br />&#43; cp /lib/i386-linux-gnu/libnss_dns.so.2 /jail/lib/i386-linux-gnu<br />&#43; cp /lib/i386-linux-gnu/libresolv.so.2 /jail/lib/i386-linux-gnu<br />&#43; cp -r /lib/resolvconf /jail/lib<br />&#43; mkdir -p /jail/usr/local/lib<br />&#43; cp -r /usr/local/lib/python2.7 /jail/usr/local/lib<br />&#43; mkdir -p /jail/etc<br />&#43; cp /etc/localtime /jail/etc/<br />&#43; cp /etc/timezone /jail/etc/<br />&#43; cp /etc/resolv.conf /jail/etc/<br />&#43; mkdir -p /jail/usr/share/zoneinfo<br />&#43; cp -r /usr/share/zoneinfo/America /jail/usr/share/zoneinfo/<br />&#43; create_socket_dir /jail/echosvc 61010:61010 755<br />&#43; local dirname=/jail/echosvc<br />&#43; local ownergroup=61010:61010<br />&#43; local perms=755<br />&#43; mkdir -p /jail/echosvc<br />&#43; chown 61010:61010 /jail/echosvc<br />&#43; chmod 755 /jail/echosvc<br />&#43; mkdir -p /jail/tmp<br />&#43; chmod a&#43;rwxt /jail/tmp<br />&#43; mkdir -p /jail/dev<br />&#43; mknod /jail/dev/urandom c 1 9<br />&#43; cp -r zoobar /jail/<br />&#43; rm -rf /jail/zoobar/db<br />&#43; python /jail/zoobar/zoodb.py init-person<br />&#43; python /jail/zoobar/zoodb.py init-transfer</pre>
<p>4. Then I run the server with sudo ./zookld zook.conf</p>
<pre>zookld: Listening on port 8080
zookld: Launching zookd
zookld: zookd: pid 7650
zookld: Launching service 1: zookfs_svc
zookld: zookfs_svc: pid 7651
zookld: Launching service 2: echo_svc
zookld: echo_svc: pid 7652
zookld: setuid 61010
zookld: setgid 61010
zookld: execv /zoobar/echo-server.py 4: No such file or directory
zookld: setuid 0
zookld: setgid 0
zookld: setuid 0
zookld: setgid 0
zookd: Start with 1 service(s)
zookd: Dispatch ^(.*)$ for service 1
zookd: Forward  to service 1
zookd: Forward  to service 1
zookd: Forward  to service 1
zookd: Forward  to service 1
zookd: Forward  to service 1
zookd: Forward  to service 1</pre>
<p>When going to localhost:8080 (im using KVM) in my browser, the page just keeps refreshing and the server prints &#34;zookd: Forward  to service 1&#34; indefinitely. How do I fix this?</p></div>
<h2>Staff Answer</h2>
<div>This ‘echo_server.py not found’ message looks suspicious. Did you lose some files (try git status)</div>
<h2>Followup</h2>
<div><p>git status doesn&#39;t indicate anything is missing. strangely enough, the echo-server.py file exists in the directory?</p></div>
<h3>Followup Response</h3>
<div>Ah it appears your code expects a chroot (at /zoobar) but maybe you’re not actually chrooted? The actual location of echo-server.py does not match the path /zoobar/echo-server.py in which the scripts search.<p></p><p></p></div>
<h3>Followup Response</h3>
<div><p>Sorry, it is unclear what I should do to fix this. I tried cloning a fresh repo of lab1, added my solutions, and repeated the same steps to merge, but the problem persists.</p></div>
<h2>Followup</h2>
<div><p>I was running into this problem. I originally also committed my updated http.c and http.h files from the last exercise in Lab 1. I reverted them back to the original buggy versions (before the fixes) and it worked. Might be because of that?</p></div>
<h3>Followup Response</h3>
<div><p>This did the trick. Thank you so much, anon!</p></div>
<h3>Followup Response</h3>
<div><p>Wait, so to clarify, we&#39;re supposed to use the original lab 1 code without our changes? If so, why do we need to do git merge? Wouldn&#39;t it be easier to just git pull from the lab 2 branch then?</p></div>
<h3>Followup Response</h3>
<div><p>You should be using your code from Lab 1 merged into Lab 2. We&#39;ve decided at staff meeting that if there are problems with Lab 1 (likely from exercise 6), please fix it before continuing. </p></div><hr><h1>exercise 4: args for static_svc</h1>
<h3>2018-02-27T21:18:22Z</h3>
<div><p>I am confused about what to put as the uid and gid for the args for static_svc so that it can&#39;t execute anything. Can it be any uid and gid that are not assigned to anything?</p></div>
<h2>Staff Answer</h2>
<div>Try it with some random unassigned UID/GID and then also try with an existing  user UID/GID it should be a useful exercise to figure it out on your own :)</div>
<h2>Student Answer</h2>
<div><p>perhaps look at the output of an  ls -n</p></div><hr><h1>Part 3</h1>
<h3>2018-02-27T19:06:53Z</h3>
<div><p>I get the following error though I&#39;m setting permissions to 777 (anyone can read/write/execute) to access /jail/zoobar/db/ in particular. I don&#39;t see this issue until I actually attempt to change the user&#39;s <em>effective</em> id (even though their real and group ids are altered from root). I&#39;m kind of stuck here and don&#39;t know what I&#39;m doing wrong.</p>
<p></p>
<pre>OperationalError: (pysqlite2.dbapi2.OperationalError) attempt to write a readonly database [SQL: u&#39;INSERT INTO person (username, password, token, zoobars, profile) VALUES (?, ?, ?, ?, ?)&#39;] [parameters: (u&#39;test1&#39;, u&#39;supersecretpassword&#39;, None, 10, &#39;&#39;)]</pre>
<p></p></div>
<h2>Staff Answer</h2>
<div>Did you remember to chmod -R the directory? Otherwise it won’t recursevely apply the flags to its contents.</div><hr><h1>Running into issues with make check</h1>
<h3>2018-02-27T15:40:08Z</h3>
<div><p></p><pre>./check_lab2.py<br />&#43; setting up environment in fresh /jail..<br />mv: cannot move &#39;/jail&#39; to &#39;/jail.bak/jail&#39;: Directory not empty<br />ERROR: running shell command: mv /jail /jail.bak<br />mv: cannot stat &#39;/etc/passwd.bak&#39;: No such file or directory<br />ERROR: running shell command: mv /etc/passwd.bak /etc/passwd<br />Makefile:15: recipe for target &#39;check&#39; failed<br />make: *** [check] Error 1</pre>
<p></p>
<p>I stopped a previous sudo make check somewhere in between check_lab2part4.py and I think it may have stopped at a point where it didn&#39;t restore some files. I don&#39;t know what to do to fix this though and get it back to running</p></div>
<h2>Followup</h2>
<div><p>-</p></div><hr><h1>chrooting without breaking functionality?</h1>
<h3>2018-02-27T01:16:17Z</h3>
<div><p>I tried the simplest possible approach of implementing chroot in launch_svc, and make check is failing with a stack trace caused by a 404 error. That&#39;s not really surprising since what I did presumably isolated the scripts from resources they needed, but I&#39;m having trouble figuring out what&#39;s in-bounds for Exercise 2--am I supposed to be modifying only zookld.c (and only &#34;in the specified place&#34;), or can I mess with the conf file, the directory structure...? From the manpage of chroot, I&#39;m just not seeing where I should be doing anything other than what I&#39;ve already tried.</p>
<p></p></div>
<h2>Student Answer</h2>
<div><p>I was able to fix this with nothing more than a small change to the web server itself -- checking the getcwd man page was pretty helpful. </p></div>
<h2>Staff Answer</h2>
<div>Reading POSIX man pages is fun!</div>
<h2>Followup</h2>
<div><p>I&#39;m still not clear on how to fix this bug. I understand that after chrooting, the current directory for zookld is unreachable, but the login files are still in lab/zoobar, so I&#39;m not sure how to give the new process access to this without basically undoing the chroot. The address being requested is supposed to not be accessible from other processes than root. If I understand correctly </p></div>
<h3>Followup Response</h3>
<div><p>Something I didn&#39;t realize at first is that there&#39;s a pre-made jail with everything the processes need in the root directory; for some reason I thought we were creating a new jail directory in ~/lab. As long as you plunk the process in the right place, access to files shouldn&#39;t be a problem.</p>
<p></p>
<p>I got it working using something other than getcwd, so maybe there are a few ways of going about it. Thinking about the process&#39;s (the new one, not zookld anymore as of the call to fork() I think) current directory is a good direction. The man page does indeed have a very revealing paragraph to that respect that I (OP) was misreading. </p></div>
<h3>Followup Response</h3>
<div><p>I am chrooting to the jail in the root folder - shows up as /jail as opposed to /home/httpd/lab when I print the directory inside the method we change. In terms of the process&#39;s current directory, that shows as unreachable/home/httpd/lab. </p>
<p></p>
<p>I think Im struggling with understanding the difference between what I expected the paths to look like (what I currently have) and what would give proper behavior. </p>
<p></p></div>
<h3>Followup Response</h3>
<div><p>It sounds like the process&#39;s root directory is what you want. Think about the implications of its current directory, like what would happen if it accessed ./zoobar/&lt;whatever&gt;. Is it isolated from everything outside /jail right now?</p></div>
<h3>Followup Response</h3>
<div><p>I think its only isolated from things in /jail. So like zookld or some unjailed process should be able to access it but I&#39;m not even sure where to determine what process runs the request</p></div>
<h3>Followup Response</h3>
<div><p>Right, but zookld and unjailed processes don&#39;t need to access the one you&#39;re in the middle of launching. The process you&#39;re launching DOES need to be able to get at stuff in /jail, and shouldn&#39;t have access to anything else. When it looks around, pokes at the directory tree, etc., it should see the inside of the chroot jail. So what would that mean about what its current directory should be?</p></div>
<h3>Followup Response</h3>
<div><p>Thank you so much! </p></div><hr><h1>Request Failed : Bug</h1>
<h3>2018-02-27T00:15:59Z</h3>
<div><p>I&#39;m receiving the following error, when trying to access the web site (in the initial part of the lab). </p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/hlmw7ncksqb1mz/je4whkjjulxk/Screen_Shot_20180226_at_7.14.25_PM.png" alt="" /></p>
<p>I haven&#39;t changed any of the lab2 documents. Could this be due to some changes I made to the source in lab1? </p></div>
<h2>Staff Answer</h2>
<div><p>1. try the steps in &#64;165 and see if make clean would fix it<br />2. If you suspect the changes you made to the server in Lab 1 may have caused the error you are seeing, save a copy of the server files you modified (e.g. http.c) to a different directory (e.g. your home directory), restore the original unmodified server code (only http.c and zookd.c), and maybe try again? </p></div>
<h2>Followup</h2>
<div><p>I reset my repo from lab 1 and downloaded the lab 2 code fresh. Now it works. Thanks</p></div>
<h2>Followup</h2>
<div><p>I am running into the same issue. Starting from a fresh clone of</p>
<p></p>
<pre>git clone http://web.mit.edu/6858/2018/6.858-lab-2018.git lab<br />cd lab<br />git checkout lab2<br /># verify that everything works<br />make clean<br />make<br />sudo make setup<br />sudo make check<br /><br /># Now modify zookd.c<br /># to chroot<br /><br />make clean<br />sudo make setup<br />sudo make check</pre>
<p></p>
<p></p>
<pre>httpd&#64;vm-6858:~/lab$ cat /tmp/zookld.out<br />zookld: Listening on port 8080<br />zookld: Launching zookd<br />zookld: zookd: pid 9435<br />zookld: Launching service 1: zookfs_svc<br />zookld: zookfs_svc: pid 9436<br />zookld: Launching service 2: echo_svc<br />zookld: echo_svc: pid 9437<br />zookld: setuid 0<br />zookld: setgid 0<br />zookld: setuid 61010<br />zookld: setgid 61010<br />zookld: setuid 0<br />zookld: setgid 0<br />zookd: Start with 1 service(s)<br />zookd: Dispatch ^(.*)$ for service 1<br />zookd: Forward /zoobar/index.cgi/login to service 1<br />zookfs: [9440] Request failed: File does not exist: (unreachable)/home/httpd/lab/zoobar/index.cgi/login</pre>
<p></p>
<p>Which tells me that the chroot was succesful, but the application is trying to serve files out of /home/httpd/...</p></div>
<h3>Followup Response</h3>
<div><p>Apparently I can&#39;t edit a comment.</p>
<p></p>
<p>I did run:</p>
<p></p>
<p>&#96;&#96;&#96;</p>
<p>make clean</p>
<p>make </p>
<p>sudo make setup</p>
<p>sudo make check</p>
<p>&#96;&#96;&#96;</p>
<p></p>
<p>and I just forgot to include the &#96;make check&#96; in the above. Of course I am still encountering the same error.</p></div>
<h3>Followup Response</h3>
<div><p>I found the issue. The &#96;execve&#96; takes a relative path and without an additional &#96;chdir&#96; into the jail the will resolve to the home directory.</p></div><hr><h1>Lab 2 Merge conflict - Do we keep the new lab 2 code or our fixed lab 1 code?</h1>
<h3>2018-02-26T22:54:26Z</h3>
<div><p>Or do we keep both?</p>
<p></p>
<p>Thanks.</p></div>
<h2>Staff Answer</h2>
<div>You shouldn’t get merge conflicts unless you modified one of the source files we gave you. I’d say keep our changes.</div><hr><h1>In what direction is data written to variables in the heap (static buffers for example)?</h1>
<h3>2018-02-26T22:49:43Z</h3>
<div>I tried looking for this answer through course materials and online and couldn&#39;t find an answer.</div>
<h2>Staff Answer</h2>
<div>Usually up if you’re talking about an array, however many times the MMU will move memory around to allow for less fragmentation and free bigger blobs, so I would not make any assumptions about memory continuity, persistence etc in the heap.</div><hr><h1>Lab 2: What anonymous UID/GID to use?</h1>
<h3>2018-02-26T20:48:19Z</h3>
<div><p>Lab 2 Exercise 3 specifies to &#34;Change the <tt>zook.conf</tt> uid and gid for zookd and zookfs so that they run as something other than root.&#34; How can I be sure that the UID and GID I pick are not also being used by some other process on the system, and/or that this UID/GID do not have additional rights to files I am not aware of? Are there conventions for what UID/GID range to use for anonymous UID/GIDs? Or is there a good way to check in code that a UID/GID is exclusive to this process?</p></div>
<h2>Student Answer</h2>
<div><p>This is not a dynamic solution, but if you run the command</p>
<pre>id 9</pre>
<p>it will give you the information about uid 9. If the uid is unclaimed, you will get &#39;no such user&#39;.</p></div>
<h2>Followup</h2>
<div><p>So are we creating an actual user in the Linux machine and then running our process under that uid, or do we randomly select an unclaimed uid in code?</p></div><hr><h1>Transferring Zoobars?</h1>
<h3>2018-02-26T18:29:22Z</h3>
<div><p>Just started this lab, but I noticed that if I log in as &#34;user1&#34; and use him to transfer 10 zoobars to &#34;user1&#34;, I find that his balance increases by 10, instead of staying the same (which i thought would be the correct thing to do). Is this something that is to be expected?</p>
<p></p></div>
<h2>Staff Answer</h2>
<div><p>These kinds of bugs will be a topic for lab 3.   We will use symbolic execution to find them.</p></div><hr><h1>Lecture Live QA</h1>
<h3>2018-02-26T08:06:19Z</h3>
<div><p>Since we&#39;ve been getting quite a lot of questions during lecture on the Anonymous Question submission system, a lot of which are questions that we can respond to directly, we&#39;re trying out a new QA system where you can see other students&#39; submissions as well as staff responses to them...</p>
<p></p>
<p>this also means that it can very easily become flooded by unrelated threads. Please be mindful when posting questions/responses so that they stay relevant to the lecture material. If this format proves to be disruptive to class, we&#39;ll likely revert to the old AnonQA site.</p>
<p></p>
<p>Here&#39;s the link to the new site: <a href="https://mit6858qa.herokuapp.com/">https://mit6858qa.herokuapp.com/</a><a href="https://mit6858qa.herokuapp.com/" target="_blank"></a></p>
<p></p>
<p>#pin</p>
<p></p></div><hr><h1>late hours</h1>
<h3>2018-02-24T22:25:09Z</h3>
<div><p>I submitted all of lab 1 (I think and hope!!) But I&#39;m still not seeing my aggregated late hours. Does this mean my lab isn&#39;t complete?</p>
<p></p></div>
<h2>Followup</h2>
<div><p>same, I don&#39;t see them either. I know for 824 they show up immediately after submitting</p></div>
<h2>Staff Answer</h2>
<div>I believe late hours will be generated as part of grading lab 1, which will happen for all parts over the next week or so.</div><hr><h1>Server hanging when trying to run zookld in lab 2</h1>
<h3>2018-02-24T16:50:30Z</h3>
<div><p>I committed lab 1 solutions and merged into lab 2 -- am now trying to start the zoobar website and the server appears to hang (the webpage does not load in browser). I see the following:</p>
<p></p>
<p><tt><b>httpd&#64;vm-6858</b>:<b>~/lab</b>$ sudo ./zookld zook.conf</tt></p>
<p><tt>zookld: Listening on port 8080</tt></p>
<p><tt>zookld: Launching zookd</tt></p>
<p><tt>zookld: zookd: pid 1475</tt></p>
<p><tt>zookld: Launching service 1: zookfs_svc</tt></p>
<p><tt>zookld: zookfs_svc: pid 1476</tt></p>
<p><tt>zookld: Launching service 2: echo_svc</tt></p>
<p><tt>zookld: echo_svc: pid 1477</tt></p>
<p><tt>zookld: setuid 61010</tt></p>
<p><tt>zookld: setgid 61010</tt></p>
<p><tt>zookld: execv /zoobar/echo-server.py 4: No such file or directory</tt></p>
<p><tt>zookld: setuid 0</tt></p>
<p><tt>zookld: setgid 0</tt></p>
<p><tt>zookld: setuid 0</tt></p>
<p><tt>zookld: setgid 0</tt></p>
<p><tt>zookd: Start with 1 service(s)</tt></p>
<p><tt>zookd: Dispatch ^(.*)$ for service 1</tt></p>
<p><tt>zookd: Forward /zoobar/index.cgi/ to service 1</tt></p>
<p></p>
<p>At some point, I also saw Socket IO errors but cannot reproduce them every time I try to start the server. Not sure how to go about fixing this -- anyone have any suggestions?</p>
<p></p>
<p>Thanks!</p></div>
<h2>Staff Answer</h2>
<div><p>Try the following and see if it helps? </p>
<p></p>
<p>1. make clean</p>
<p>2. make</p>
<p>3. sudo make setup</p>
<p>4. sudo ./zookld zook.conf</p></div>
<h2>Followup</h2>
<div><p>Did you figure out how to resolve this? I think I&#39;m having the same issue. When I go to the webpage, I get &#34;An error occurred. File does not exist: /home/httpd/lab/zoo.&#34; I thought I followed all the instructions in the lab for merging lab 1 into lab 2, and I tried the four steps in the instructor answer but it didn&#39;t fix it.</p></div>
<h3>Followup Response</h3>
<div><p>Can you post the output you get from your terminal ? </p></div>
<h3>Followup Response</h3>
<div>i get pretty much the same thing. my output is the same but i also included logs from when i tried to visit the web site:

zookld: Listening on port 8080
zookld: Launching zookd
zookld: zookd: pid 31444
zookld: Launching service 1: zookfs_svc
zookld: zookfs_svc: pid 31445
zookld: Launching service 2: echo_svc
zookld: echo_svc: pid 31446
zookld: setuid 61010
zookld: setgid 61010
zookld: execv /zoobar/echo-server.py 4: No such file or directory
zookld: setuid 0
zookld: setgid 0
zookld: setuid 0
zookld: setgid 0
zookd: Start with 1 service(s)
zookd: Dispatch ^(.*)$ for service 1
zookd: Forward / to service 1
zookd: Forward /zoo to service 1
zookfs: [31451] Request failed: File does not exist: /home/httpd/lab/zoo
zookd: [31450] Request failed: http_request_line: Socket IO error</div>
<h3>Followup Response</h3>
<div><p>It looks like the request to zoobar is truncated, it might have to do with a fix lab 1&#39;s last exercise?  Could you please try saving a copy of your modified server files from lab 1 (http.c and zookd.c), restore the unmodified files, and try again? </p></div>
<h3>Followup Response</h3>
<div><p>I got the same problem- followed the lab instructions, got a merge in zookd.c and tried to solve it, but still getting a hanging server :(</p></div>
<h3>Followup Response</h3>
<div><p>&#64;AlexChen, are you using the unmodified server files or your http.c and zookd.c from lab 1? </p></div>
<h3>Followup Response</h3>
<div><p>Oh I see- should I reset everything back to before I made any changes, and then pull the new changes?</p></div>
<h3>Followup Response</h3>
<div><p>not everything, try making a copy of your http.c and zookd.c file somewhere, and try resetting only those? </p></div>
<h3>Followup Response</h3>
<div><p>Yeah, I tried that- still the same error</p></div>
<h3>Followup Response</h3>
<div><p>After resetting, can do run &#39;make clean&#39; just to be sure, and try again? Also, could you please post your terminal output? </p></div>
<h3>Followup Response</h3>
<div><p>I&#39;ve tried checking out all the way to the base lab2 code so my git log looks like this:</p>
<p></p>
<p>httpd&#64;vm-6858:~/lab$ git log<br />commit f5d82cb110bfd0d7e371a25cb625b9895cb2e356<br />Author: Nickolai Zeldovich &lt;nickolai&#64;csail.mit.edu&gt;<br />Date: Mon Feb 19 17:39:19 2018 -0500</p>
<p>Initial code for lab 2</p>
<p>commit 89bd87718a0b8ca4c9a0efb7fa2526457856bfa5<br />Author: Nickolai Zeldovich &lt;nickolai&#64;csail.mit.edu&gt;<br />Date: Sun Feb 4 17:06:42 2018 -0500</p>
<p>Initial code for lab 1</p>
<p></p>
<p>Still get the same error, even without my code:</p>
<p></p>
<p></p>
<p>httpd&#64;vm-6858:~/lab$ sudo ./zookld zook.conf<br />zookld: Listening on port 8080<br />zookld: Launching zookd<br />zookld: zookd: pid 4623<br />zookld: Launching service 1: zookfs_svc<br />zookld: zookfs_svc: pid 4624<br />zookld: Launching service 2: echo_svc<br />zookld: echo_svc: pid 4625<br />zookld: setuid 61010<br />zookld: setgid 61010<br />zookld: execv /zoobar/echo-server.py 4: No such file or directory<br />zookld: setuid 0<br />zookld: setgid 0<br />zookld: setuid 0<br />zookld: setgid 0<br />zookd: Start with 1 service(s)<br />zookd: Dispatch ^(.*)$ for service 1<br />zookd: Forward / to service 1<br />zookfs: [4627] Request failed: http_request_headers: Socket IO error</p></div>
<h3>Followup Response</h3>
<div><p>After cleaning the directory and rerunning, I run into a 500 internal service error (still with only instructor code):</p>
<p></p>
<p>zookld: Listening on port 8080<br />zookld: Launching zookd<br />zookld: zookd: pid 5507<br />zookld: Launching service 1: zookfs_svc<br />zookld: zookfs_svc: pid 5508<br />zookld: Launching service 2: echo_svc<br />zookld: echo_svc: pid 5509<br />zookld: setuid 61010<br />zookld: setgid 61010<br />zookld: execv /zoobar/echo-server.py 4: No such file or directory<br />zookld: setuid 0<br />zookld: setgid 0<br />zookld: setuid 0<br />zookld: setgid 0<br />zookd: Start with 1 service(s)<br />zookd: Dispatch ^(.*)$ for service 1<br />zookd: Forward /zoobar/index.cgi/ to service 1<br />/home/httpd/lab/zoobar/debug.py:23 :: __try : caught exception in function index:<br /> Traceback (most recent call last):<br /> File &#34;/home/httpd/lab/zoobar/debug.py&#34;, line 20, in __try<br /> return f(*args, **kwargs)<br /> File &#34;/home/httpd/lab/zoobar/login.py&#34;, line 59, in loginhelper<br /> if not logged_in():<br /> File &#34;/home/httpd/lab/zoobar/login.py&#34;, line 50, in logged_in<br /> g.user.checkCookie(request.cookies.get(&#34;PyZoobarLogin&#34;))<br /> File &#34;/home/httpd/lab/zoobar/login.py&#34;, line 38, in checkCookie<br /> (username, token) = cookie.rsplit(&#34;#&#34;, 1)<br />ValueError: need more than 1 value to unpack</p></div>
<h3>Followup Response</h3>
<div><p>1. did you rebuild it after make clean? (remember to run steps 2-4 from the answer above)<br />2. this is probably my last resort suggestion (or if you can come to office hours that would be easier to help), but try separately git cloning a new repo (following the lab1 and lab2 instructions), so you&#39;ll have a fresh repo. </p></div>
<h3>Followup Response</h3>
<div><p>Alternatively, I&#39;ll be 15 mins early to lecture tomorrow and can help then too</p></div>
<h3>Followup Response</h3>
<div><p>Okay thank you!!</p></div>
<h3>Followup Response</h3>
<div><p>In case anyone has the same problem, for the checkCookie error, it was resolved with clearing cookies in the browser. </p></div>
<h3>Followup Response</h3>
<div><p>Note that you should be using your code from Lab 1 merged into Lab 2. We&#39;ve decided at staff meeting that if there are problems with Lab 1 (likely from exercise 6), please fix it before continuing. </p></div><hr><h1>Which http.c and zookd.c version to use in Lab 2?</h1>
<h3>2018-02-24T03:44:26Z</h3>
<div><p>Should we use the original version (that contains buffer overflow bugs) or the version that has our fixes in Exercise 6 of Lab 1? </p></div>
<h2>Student Answer</h2>
<div><p>The first thing to do in the lab is to commit our lab 1 code and check out the lab2 branch, so we are using new source code (not our fixed code)</p></div>
<h2>Followup</h2>
<div><p>But we didn&#39;t commit http.c and zookd.c. And we merged lab1 branch to lab2 branch? After the lab instruction I found that http.c and zookd.c are of my fixed version. </p></div><hr><h1>Exercise 4</h1>
<h3>2018-02-23T09:47:14Z</h3>
<div><p>I&#39;m having difficulties unlinking &#34;/home/httpd/grades.txt&#34; in exercise 4.</p>
<p></p>
<p>The stack looks like this immediately before my compromised function returns:</p>
<pre>STACK<br />  |      0xbffff5b8:                 |    0x00007478    | characters 20-21 in &#34;/home/httpd/grades.txt&#34;<br />  |      0xbffff5b4:                 |    0x742e7365    | characters 16-19 in &#34;/home/httpd/grades.txt&#34;<br />  |      0xbffff5b0:                 |    0x64617267    | characters 12-15 in &#34;/home/httpd/grades.txt&#34;<br />  |      0xbffff5ac:                 |    0x2f647074    | characters 8-11 in &#34;/home/httpd/grades.txt&#34;<br />  |      0xbffff5a8:                 |    0x74682f65    | characters 4-7 in &#34;/home/httpd/grades.txt&#34;<br />  |      0xbffff5a4:                 |    0x6d6f682f    | characters 0-3 in &#34;/home/httpd/grades.txt&#34;<br />  |      0xbffff5a0:                 |    0xbffff5a4    | pointer to the string &#34;/home/httpd/grades.txt&#34;<br /> \|/     0xbffff59c:    %esp ------&gt; |    0x401014c0    | address of unlink()</pre>
<p>I confirmed that the code jumps to unlink() using gdb, but the call to unlink() doesn&#39;t delete &#34;/home/httpd/grades.txt&#34;. For some reason, inside unlink(), the code jumps another system call (__syscall_error()). Does anyone have any thoughts on why this might be happening?</p>
<p></p>
<p>Below are the first lines of assembly that are executed inside the unlink() system call. At this moment my code is jumping to __syscall_error() at the instruction located at address 0x401014d9.</p>
<pre>=&gt; 0x401014c0 &lt;unlink&gt;:	mov    %ebx,%edx
   0x401014c2 &lt;unlink&#43;2&gt;:	mov    0x4(%esp),%ebx
   0x401014c6 &lt;unlink&#43;6&gt;:	mov    $0xa,%eax
   0x401014cb &lt;unlink&#43;11&gt;:	call   *%gs:0x10
   0x401014d2 &lt;unlink&#43;18&gt;:	mov    %edx,%ebx
   0x401014d4 &lt;unlink&#43;20&gt;:	cmp    $0xfffff001,%eax
   0x401014d9 &lt;unlink&#43;25&gt;:	jae    0x40042730 &lt;__syscall_error&gt;
   0x401014df &lt;unlink&#43;31&gt;:	ret
   0x401014e0 &lt;unlinkat&gt;:	push   %ebx
   0x401014e1 &lt;unlinkat&#43;1&gt;:	mov    0x10(%esp),%edx
   0x401014e5 &lt;unlinkat&#43;5&gt;:	mov    0xc(%esp),%ecx
   0x401014e9 &lt;unlinkat&#43;9&gt;:	mov    0x8(%esp),%ebx
   0x401014ed &lt;unlinkat&#43;13&gt;:	mov    $0x12d,%eax
   0x401014f2 &lt;unlinkat&#43;18&gt;:	call   *%gs:0x10
   0x401014f9 &lt;unlinkat&#43;25&gt;:	pop    %ebx
   0x401014fa &lt;unlinkat&#43;26&gt;:	cmp    $0xfffff001,%eax
   0x401014ff &lt;unlinkat&#43;31&gt;:	jae    0x40042730 &lt;__syscall_error&gt;
   0x40101505 &lt;unlinkat&#43;37&gt;:	ret
   0x40101506:	xchg   %ax,%ax
   0x40101508:	xchg   %ax,%ax</pre>
<p>Thanks!</p></div>
<h2>Student Answer</h2>
<div><p>My stack pointer is at $esp = 0xbffff5a0. Based on the assembly, the pointer to argument string (not the string itself!) should be at $esp&#43;4 = 0xbffff5a4, so you seem to be missing an entire word of something in the stack.</p>
<p></p>
<p>The stacks shown in the first two pages of <a href="https://www.exploit-db.com/docs/english/28553-linux-classic-return-to-libc-&amp;-return-to-libc-chaining-tutorial.pdf" target="_blank">this document</a> will be helpful to you.</p></div>
<h2>Followup</h2>
<div>When the execution reaches unlink, look at the stack. Especially pay attention to $ebp and $ebp&#43;4. Are they the right values?</div>
<h3>Followup Response</h3>
<div><p>$ebp was 0x41414141 (sequence of A&#39;s), and $ebp &#43; 4 was 0x41414145. I updated my attack message so $ebp isn&#39;t different than what it would be in a normal execution. With my new message $ebp was 0xbffff598</p>
<p></p>
<p>I&#39;m not sure why this matters though. Could you explain? Is there anything you&#39;d recommend reading to figure this out?</p>
<p></p>
<p></p></div>
<h3>Followup Response</h3>
<div><p>My $ebp is gibberish, and I was able to get an exploit working. The relevant register is $esp. When you are executing unlink, what is in the $ebx register right before doing the call at 0x401014cb? Its contents should be 0xbffff5a4 for your exploit to work.</p></div>
<h3>Followup Response</h3>
<div><p>I figured out what was wrong with my exploit. I was missing the return address for unlink(). The handout in &#64;141 was very helpful. Thanks for the help!</p></div><hr><h1>make check-fixed failing when no fixes are implemented</h1>
<h3>2018-02-23T04:15:38Z</h3>
<div><p>Running make check-fixed is failing (meaning the attacks are not working) some of my exploits even though I have not implemented any of the fixes to protect against my attacks...yet when I run the make check, everything passes..... </p>
<p></p>
<p>I&#39;m unsure what is going on.</p></div>
<h2>Student Answer</h2>
<div><p>I believe that &#96;make check&#96; runs your exploit files on staff provided binaries (ie ones not changed to prevent buffer overflows), while &#96;make check-fixed&#96; runs your exploit on the binaries compiled from your edited files. Not sure how helpful that is. It does seem strange that you would fail the make check-fixed tests before changing your http.c. Maybe try cloning the repo again in a different sub-dir and copying http.c to make sure your http.c hasn&#39;t been accidentally changed since you started working?</p>
<p></p></div>
<h2>Followup</h2>
<div><p>&#43;1   also experiencing this problem</p></div>
<h2>Staff Answer</h2>
<div><p>I agree about that because if you include even some small changes such as printf statement it can change the stack layout and address. </p></div>
<h2>Followup</h2>
<div><p>If we don&#39;t make any changes to any of the source files, why would <tt>make check-fixed</tt> fail? I would understand if some minor changes like printf were added to the source, but if nothing is changed why would the output be any different than the staff provided binaries? </p></div>
<h3>Followup Response</h3>
<div><p>Hmm. If you didn&#39;t change any of the source file, I also can&#39;t think of what can go wrong.<br />Can you try make clean. make. then make check-fixed again?<br />Can you also paste the error here, in case there may be other issues?</p></div>
<h3>Followup Response</h3>
<div><p>Thanks! its not clear what the issue was but cloning the repo again and transferring the exploits over solved it.</p></div>
<h2>Followup</h2>
<div><p>If you don&#39;t actually fix it, some indiscriminate crashing exploits will still work as long as the input is long enough. Your fix should be able to handle that as well. </p></div><hr><h1>How to input arguments to handler</h1>
<h3>2018-02-22T17:14:19Z</h3>
<div><p>I&#39;ve overwritten handler with the address of unlink, but I&#39;m lost on how to pass the arguments (namely the address of the string containing the filename) to unlink.</p>
<p></p>
<p>Any help?</p></div>
<h2>Student Answer</h2>
<div><p>I don&#39;t want to give it away, but you have to use clever tricks because the buffer occurs <em>after</em> the handler&#39;s stack frame, and you can&#39;t overflow into the handler&#39;s arguments. Think about how arguments are being passed to the handler currently (there are two arguments being passed).</p></div>
<h2>Followup</h2>
<div><p>Yeah, I&#39;m currently trying to override fd with a pointer to the location in my buffer overflow where i&#39;ve put the string that I want to unlink, but that&#39;s not working. I think something weird is happening when I try to overflow the int with a pointer and the int isn&#39;t actually reading the pointer address correctly (yes i&#39;ve tried converting to hex, but the values don&#39;t align). Is this the right path, or am I totally off the mark?</p></div>
<h3>Followup Response</h3>
<div><p>That&#39;s the correct approach; I&#39;m guessing it&#39;s just implementation error then.</p></div>
<h3>Followup Response</h3>
<div><p>Ok, so did you have to do anything special when overwriting fd (the int) with a pointer&#39;s address?</p></div>
<h3>Followup Response</h3>
<div><p>Nope, just overwrote the integer fd with the address of the string.</p></div>
<h3>Followup Response</h3>
<div>are you putting the string &#34;/home/httpd/grades.txt\0&#34; in the right place?</div>
<h3>Followup Response</h3>
<div><p>Make sure you&#39;re aware of what space is available in the buffer, so you&#39;re not off by some!</p></div><hr><h1>Exercise 5</h1>
<h3>2018-02-22T08:45:54Z</h3>
<div><p>Do we need to implement the exploits?</p></div>
<h2>Staff Answer</h2>
<div><p>Nope, just a good description of the vulnerabilities is needed (as per the lab description: how it works, explanation of the limitations of the attack, what an attacker can accomplish, and how you might go about fixing or preventing it) </p></div>
<h2>Student Answer</h2>
<div><p>No, but it might be useful in helping find vulnerabilities and why they work. (I just implemented the two vulnerabilities I found, since I already wrote the code while finding the vulnerabilities, and to make sure they worked.)</p></div><hr><h1>Exercise 6</h1>
<h3>2018-02-22T04:27:35Z</h3>
<div><p>After we modify the web server code, some of the addresses that our exploits use might change, correct? So are we expected to modify our exploit files to target the new code?</p></div>
<h2>Staff Answer</h2>
<div><p>Why would the addresses change? The server API should be the same, but the behavior in case of your exploits in part 1,2 should not be reproducible anymore.</p></div>
<h2>Followup</h2>
<div><p>Adding/removing local variables or adding arguments to functions will change how the stack looks and would cause most of the later exploits to fail anyway, right? Only the exploits that crash the server could potentially still work.</p></div>
<h3>Followup Response</h3>
<div><p>Seconded.</p></div>
<h3>Followup Response</h3>
<div><p>The exploits are tested against the old version of the code so there is a difference between &#96;make check&#96; and &#96;make check-fixed&#96;.</p>
<p>The first will test the exploits and the second will run the exploits against the &#34;hardened&#34; files.</p></div><hr><h1>gdb breakpoints</h1>
<h3>2018-02-22T03:43:37Z</h3>
<div><p>In gdb, after my program terminates with a segmentation fault, my breakpoints no longer work. I can still see all the breakpoints using info break, but I also have &#34;inf 1, 2&#34; after each of them. What does this mean and why do the breakpoints stop working?</p>
<p></p>
<p>Thanks!</p></div>
<h2>Staff Answer</h2>
<div><p>Break points work by keeping track of the EIP, if the EIP is not in your loaded program anymore (because the program crashed) then it can&#39;t do much. You&#39;d have to rerun the program with &#96;run 8080&#96; inside gdb.</p></div><hr><h1>exercise 5 clarification</h1>
<h3>2018-02-22T00:12:12Z</h3>
<div><p>So I know that you can&#39;t use buffer overflow for exercise 5. But what types of vulnerabilities are we supposed to find? (Are these things covered in lecture or do we have to read up on more material online to figure it out?)</p>
<p></p>
<p>The assignment also says &#34;You should ignore bugs in <tt>zoobar</tt>&#39;s code. &#34; What does that mean? Are bugs not vulnerabilities? I thought all vulnerabilities are basically a kind of bug...</p>
<p></p>
<p>Do we restrict attention to http.c and zookd.c, as in previous parts? </p>
<p></p>
<p>Do these vulnerabilities have to be things that can execute arbitrary code (or just malicious code, like in the libc case)? Or is it okay if they just crash the server, like in exercise 1?</p></div>
<h2>Staff Answer</h2>
<div><p>What are some of the security goals you might have for a web server? How might you break those goals given the code in http.c and zookd.c?</p></div>
<h2>Followup</h2>
<div><p>Sorry but it&#39;s hard to know what security goals we should expect from web servers. Some potential goals like for instance user data restriction are part of zoobar and not http/zookd. So it would be really helpful to get more concrete advice or even a pointer to some relevant readings.</p></div>
<h3>Followup Response</h3>
<div><p>seconded</p></div>
<h3>Followup Response</h3>
<div><p>What were some of the common security goals we discussed in Lecture 1?</p></div>
<h2>Followup</h2>
<div><p>Do these have to be *bugs* --- as in it is clear that it was not intended to work this way by the developers? Or *flaws* in that we don&#39;t believe some behavior should be allowed or should be preventable? Something like permissions is subjective in this way.</p>
<p></p>
<p>An example would be Facebook: the security model allows you to hide some photos from timeline but not from graph search. Therefore if I&#39;m not your friend, I can&#39;t see photos on your timeline, but I do have permission to search &#34;photos of you&#34;. It seems like an exploit, but this is not against FB&#39;s threat model; they are totally ok with you doing that. </p></div>
<h3>Followup Response</h3>
<div><p>The vulnerabilities for this exercise aren&#39;t subjective and would be considered bugs.</p></div><hr><h1>Lab 1 Exercise 6: What to do when user tries to overflow buffer?</h1>
<h3>2018-02-21T22:36:49Z</h3>
<div><p>Should we raise an exception (crashing the server) when the user tries to overflow the buffer or should we simply truncate the user input if it would go beyond the end of the buffer?</p>
<p></p>
<p>As in, if the user types &#34;AAAAA&#34; for buf[4], should it just be truncated to &#34;AAA\0&#34;? Or should we raise an exception?</p>
<p></p>
<p>Can we truncate the user input further than necessary (or lengthen other buffers)? For instance, the buffer buf to store user input are length 8192, but reqpath is only 2048 bytes and pn is only 1024 bytes. So could we, for instance, reduce the size of buf or increase the size of reqpath or pn?</p>
<p></p>
<p>Or do we have to manually insert code to ensure it doesn&#39;t overflow each of the buffers or use stack canaries (for stack canaries, we cannot prevent overflowing, we can only crash the server when we discover the buffer has been overflown)?</p></div>
<h2>Staff Answer</h2>
<div><p>No need to raise an exception. Simply truncate is fine.<br />I don&#39;t think you should &#34;reduce the size of buf or increase the size of reqpath or pn&#34; because the server may sometimes need large size to store some value or may only need small size for memory optimization.<br /><br />&#34;manually insert code to ensure it doesn&#39;t overflow each of the buffers&#34;.<br />Do not use stack canaries as said in the lab handout that &#34;Do not rely on compile-time or runtime mechanisms such as stack canaries&#34;.<br /><br /></p></div><hr><h1>Exercise 4. How to pass arguments?</h1>
<h3>2018-02-21T16:41:29Z</h3>
<div><p>It&#39;s clear to me how we can hijack control flow and I&#39;ve found the address of unlink, that I want the program to jump to. I don&#39;t understand how we can pass arguments to the function. I have some guesses, but they don&#39;t make much sense.</p>
<p></p>
<p>Do we place the arguments just above the location of that function in memory? In that case, we&#39;d need to be able to write to the memory location just above each function, which we can&#39;t do.</p>
<p></p>
<p>Find a way to organize the stack with the arguments we want (we can do that), then call the new function and have that function somehow know to use arguments we placed on the stack and not use the stack&#39;s layout wherever the control flow jumps to, but I don&#39;t know if that&#39;s a thing we can do.</p>
<p></p>
<p>Help. I&#39;m confused.<img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/hlmw7ncksqb1mz/jdxazqov7nud/Screen_Shot_20180221_at_11.38.38_AM.png" alt="" /></p></div>
<h2>Student Answer</h2>
<div><p>One of the TAs mentioned in previous posts that you can <strong>override the return address</strong> <strong>in both exploits</strong>. You just can&#39;t use the return address in your function pointer exploit. So you can overwrite the memory location above your function. As for how to structure the input to the function, think about how to overwrite the arguments to the function.</p></div><hr><h1>How can we find the address of SYS_unlink()?</h1>
<h3>2018-02-21T04:17:03Z</h3>
<div><p>My current plan is to use the code in from exercise 3 to jump to SYS_unlink(), then use gdb to find out the address. Am I on the right track or is there a better way?</p></div>
<h2>Followup</h2>
<div><p></p><pre>print &amp;unlink</pre>
<p>?</p></div>
<h3>Followup Response</h3>
<div><p></p><pre>p unlink </pre>
<p></p></div><hr><h1>More Helpful libc example docs</h1>
<h3>2018-02-21T01:12:04Z</h3>
<div><p>I found this doc</p>
<p><a href="https://www.exploit-db.com/docs/english/28553-linux-classic-return-to-libc-&amp;-return-to-libc-chaining-tutorial.pdf">https://www.exploit-db.com/docs/english/28553-linux-classic-return-to-libc-&amp;-return-to-libc-chaining-tutorial.pdf</a> </p>
<p></p>
<p>more helpful and easier to understand than the included</p>
<p><a href="https://css.csail.mit.edu/6.858/2018/readings/return-to-libc.pdf">https://css.csail.mit.edu/6.858/2018/readings/return-to-libc.pdf</a> </p>
<p></p>
<p></p></div><hr><h1>fixing http.c</h1>
<h3>2018-02-21T01:03:58Z</h3>
<div><p>Are we allowed to add extra arguments to functions? I&#39;m getting an error when I try to do so. </p></div>
<h2>Student Answer</h2>
<div><p>&#64;125?</p></div><hr><h1>Something wrong with gdb..?</h1>
<h3>2018-02-20T23:40:32Z</h3>
<div><p>Something seems to be wrong with gdb. I previously ran my exploit for modifying the return address but that the ebp/eip remained the same. However, as I continue to step towards to the end of the function, after the closing brace, the ebp/eip changes. I&#39;ve attached a screenshot. Does anyone know what&#39;s going on? Thanks a lot.</p>
<p></p>
<p>P.S. It&#39;s my exploit code from Exercise 2 so I don&#39;t think the exploit is wrong. </p>
<p></p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/i5n8qq5d5e63d6/jdwalmula5lr/Screen_Shot_20180220_at_6.38.00_PM.png" alt="" /></p></div>
<h2>Student Answer</h2>
<div>how are you starting the server?</div>
<h2>Followup</h2>
<div><p>I&#39;m starting the server with </p>
<p></p>
<pre>./clean-env.sh ./zookd-exstack 8080 &amp;</pre>
<p>Just trying the exstack to see if my previous exploit works first. </p></div>
<h3>Followup Response</h3>
<div><p>Sorry. For anyone else having problems, I wasn&#39;t doing </p>
<p></p>
<pre>x $ebp</pre>
<p>which shows 0x61616161</p>
<p></p>
<p>Info registers only show the addresses stored in various registers.</p></div><hr><h1>Exploiting the function pointer</h1>
<h3>2018-02-20T23:17:57Z</h3>
<div><p>So this is what I have so far: </p>
<p></p>
<p>The function pointer that we see in http_serve is actually called when handler is called. In the stack before handler is called I see that the assembly instructions are pushing %eax and (0x8 &#43; $ebp) which is fd. So then the thought process is that A) I want to overwrite the function pointer as the pointer to &lt;unlink&gt; and B) make sure that fd = exit() and C) whatever %eax is, is the pointer to my grades.txt address?</p>
<p><br />So then if I &#34;call&#34; unlink way down in the stack when http_serve pokes handler=http_serve_none, handler actually pointers to Unlink, with &#34;exit&#34; and &#34;path to grades&#34; in the stack at that time? Is this a good way to think about it? </p>
<p></p>
<p>If so right now I&#39;m having trouble with %eax, I know http_serve_none calls (fd, pn) though, so I put my pointer to filepath in the pn buffer, but it&#39;s not working.</p></div>
<h2>Staff Answer</h2>
<div><p>I think you got the right idea. My question for you is do you need to think about that %eax if you only need one argument for unlink? :) Think about this and I think you will figure out soon.</p></div><hr><h1>Are there office hours today?</h1>
<h3>2018-02-20T21:19:55Z</h3>
<div><p></p></div>
<h2>Student Answer</h2>
<div>&#43;1</div><hr><h1>Process won&#39;t die?</h1>
<h3>2018-02-20T20:06:01Z</h3>
<div><p>I&#39;m getting the &#34;address already in use&#34; error and a process number comes up if I pgrep zook. I&#39;ve tried kill -9 over ssh and directly in the VM and the thing will not die. Any suggestions? I&#39;m wary of rebooting because so far every time I try to restart these VMs they never boot again.</p></div>
<h2>Staff Answer</h2>
<div><p>Hmm, do you happen to have gdb still running? </p>
<p>What is the output of running &#96;ps -u httpd&#96;, can you show us the output of that? This should show what are processes are currently running</p></div><hr><h1>Exercise 6 - How good of prevention?</h1>
<h3>2018-02-20T19:05:31Z</h3>
<div><p>Exercise 6 wants us to do the following: &#34;For each buffer overflow vulnerability you have exploited in Exercises 2, 3, and 4, fix the web server&#39;s code to prevent the vulnerability in the first place.&#34; We can use &#96;make check-fixed&#96; to verify that none of our exploits work anymore. If all exploits fail in &#96;make check-fixed&#96;, does that mean that we get full credit for this problem? I&#39;m wondering whether we just need to prevent the specific exploits that we used or whether we need to go above and beyond that to prevent other potential issues with the same buffers / functions.</p></div>
<h2>Staff Answer</h2>
<div><p>Yes, I just got an answer during the staff meeting today. Prevent only the specific exploits you have in former exercises is fine :)</p></div><hr><h1>Is it okay to use different exploits for Exercise 2 and 4</h1>
<h3>2018-02-20T19:02:24Z</h3>
<div><p>I just realized that one of the exploits I did in exercise 2 would be hard to implement in exercise 4. Is it okay to use different exploits for these exercises?</p></div>
<h2>Staff Answer</h2>
<div><p>That&#39;s OK, but keep in mind that 4b still require non-return address exploit.</p></div>
<h2>Followup</h2>
<div>4b requires a non return address exploit--where does it say this/what kind of exploit is expected for 4b? I thought I was okay doing two return-to-libc exploits for 4a and b?</div>
<h3>Followup Response</h3>
<div><p>You&#39;ll call a libc function but you can&#39;t use the return address to do it.</p></div><hr><h1>Function pointer exploit</h1>
<h3>2018-02-20T16:52:17Z</h3>
<div><p>Does 4b have to be a non-return address overwriting based exploit?</p>
<p></p>
<p>Secondly, I guess I understand that if I were to use handler to exploit this, I&#39;d have to overwrite the handler function pointer to point to the unlink() libc call. But, I&#39;m not sure how to stage the arguments correctly since the prototype for handler is different from that of unlink. So, when the function is called, two arguments will be pushed on to the stack while unlink needs the filename as the only argument. Further, even if we overflow pn using name, the pointer pn will point to the beginning which will have the current working directory before anything else you try and append.</p>
<p></p>
<p>I&#39;m not really sure how to get around either of these issues.Any tips on how this can be modified would be very useful.</p></div>
<h2>Staff Answer</h2>
<div><p>check &#64;118. To find where to place arguments correctly, you might need to observe behavior from gdb and assembly. </p></div>
<h2>Followup</h2>
<div><p>Follow up on the second part of the question, should we look for a way to make the exploit work regardless of the current working directory that the server is started in, or should we assume that &#96;getcwd(...)&#96; would always return a certain directory? Thanks! </p></div><hr><h1>make check fails</h1>
<h3>2018-02-20T15:19:55Z</h3>
<div><p>when I run &#39;make check&#39; I get the following error: </p>
<p></p>
<p><b>FAIL</b> Zoobar app functionality error fetching user page</p>
<p>Makefile:94: recipe for target &#39;check-zoobar&#39; failed</p>
<p></p>
<p>however when I run make check-fixed, it seems to work.  All I added was an additional variable to limit the length of a buffer. Is this okay? If not any ideas what is going wrong? Thanks.</p></div>
<h2>Student Answer</h2>
<div><p>This means that the changes you made to protect against buffer overflows broke some of the website&#39;s correct functionality. I had this issue too, it it was because I implemented the fixes wrong. You should debug with gdb to see what is happening when you make a normal website request. </p></div><hr><h1>Helpful tool for low-level debugging: rr</h1>
<h3>2018-02-20T02:16:56Z</h3>
<div><p>I thought I shared my favourite tool for low-level debugging in the hope that others will find it useful.</p>
<p></p>
<p>&#96;rr&#96; (<a href="http://rr-project.org/%29">http://rr-project.org/)</a> is a tool for recording and replaying applications and falls into the category of black magic,</p>
<p>the most awesome feature is to &#96;reverse-step&#96; through a program and not having to replicate inputs all the time.</p>
<p></p>
<p>As an example first we want to record a run of our application:</p>
<p></p>
<pre><a href="mailto:httpd&#64;vm-6858:~/lab$">httpd&#64;vm-6858:~/lab$</a> ./clean-env.sh /usr/local/bin/rr record ./zookd-nxstack 8080</pre>
<p></p>
<p>after running your exploit whatever we can now take a look at what we recorded.</p>
<p></p>
<pre>httpd&#64;vm-6858:~/lab$ ./clean-env.sh /usr/local/bin/rr ps
exec env - PWD=/home/httpd/lab SHLVL=0 /usr/local/bin/rr ps
PID     PPID    EXIT    CMD
3414    --      -2      ./zookd-nxstack 8080
3421    3414    0       (forked without exec)</pre>
<p></p>
<p>So &#96;3421&#96; is the subtree that has handles the process:</p>
<p></p>
<pre>httpd&#64;vm-6858:~/lab$ ./clean-env.sh /usr/local/bin/rr replay -f 3421</pre>
<p></p>
<p>will now rerun the last application trace and start an instance one &#96;3421&#96; has been exec.</p>
<p>Now we have a gdb instance, with a couple of extensions, we can now set a breakpoint anywhere we want and run forward to that point.</p>
<p></p>
<pre>(rr) b url_decode<br />Breakpoint 1 at 0x8049f46: file http.c, line 441.<br />(rr) c<br />Continuing.<br /><br />Breakpoint 1, url_decode (dst=0xbffff4ec &#34;&#34;, <br />    src=0x804e144 at http.c:441<br />441             if (src[0] == &#39;%&#39; &amp;&amp; src[1] &amp;&amp; src[2])<br />(rr) </pre>
<p></p>
<p>Let&#39;s step forward a couple of time:</p>
<p></p>
<pre>(rr) n<br />451             else if (src[0] == &#39;&#43;&#39;)<br />(rr) n<br />458                 *dst = *src;<br />(rr) n<br />459                 src&#43;&#43;;<br />(rr) n<br />461                 if (*dst == &#39;\0&#39;)<br />(rr) n<br />465             dst&#43;&#43;;</pre>
<p></p>
<p>Oh no I wanted to check what &#96;*dst&#96; was before we incremented it (artificial example I know)</p>
<p>If I were in a normal gdb session I would need to exit and rerun the inputs, hoping to be able to reconstruct everything.</p>
<p>Thanks to &#96;rr&#96; I can just run<strong> backwards</strong></p>
<p><strong></strong></p>
<pre>(rr) reverse-next<br />461                 if (*dst == &#39;\0&#39;)<br />(rr) p *dst
$2 = 47 &#39;/&#39;</pre>
<p></p>
<p>In short &#96;rr&#96; allows for repeated and deterministic debugging and will make your life easier not only in this course but anytime you need to debug anything.</p>
<p></p>
<p>Caveats:</p>
<p>1. Linux only, and needs a fairly modern kernel</p>
<p>2. Setup in VMWare is annoying since you need HW assisted virtualisation and you need to also virtualize the PMU </p>
<p></p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/j794ycxqif73or/jdv0qcsxoa7o/Screenshot_from_20180219_211537.png" alt="" /></p></div>
<h2>Followup</h2>
<div><p>The most important caveat that I forgot to mention is that &#96;rr&#96; needs to modify the stack. </p>
<p>So after debugging your exploit you will need to correct some of the stack addresses before handing your code in.</p></div><hr><h1>Link to Phrack in readings for part 3</h1>
<h3>2018-02-20T01:57:24Z</h3>
<div><p>In the readings for part 3 there is a broken link to Phrack (<a href="https://css.csail.mit.edu/6.858/2018/readings/return-to-libc.pdf%29">https://css.csail.mit.edu/6.858/2018/readings/return-to-libc.pdf)</a></p>
<p></p>
<p>For anyone else who is interested I think this is the correct one: http://www.phrack.org/issues/58/4.html#article</p></div><hr><h1>Exercise 6: editing http.c</h1>
<h3>2018-02-20T00:02:46Z</h3>
<div><p>Are we not allowed to add any local variables? (or perhaps make the stack line up differently?) I was trying to add a local variable but got an error:</p>
<p></p>
<pre>httpd&#64;vm-6858:~/lab$ make check<br />./check_zoobar.py<br />&#43; removing zoobar db<br />&#43; running make.. output in /tmp/make.out<br />ERROR: running shell command: make all &gt;/tmp/make.out 2&gt;&amp;1<br />Makefile:94: recipe for target &#39;check-zoobar&#39; failed<br />make: *** [check-zoobar] Error 1</pre>
<p></p>
<p>If that&#39;s not it, what is the issue?</p></div>
<h2>Followup</h2>
<div>So how did you fix it? I have the same issue and I don&#39;t get any warnings when I run &#34;make check-fixed&#34;</div><hr><h1>Process of return-to-libc attack</h1>
<h3>2018-02-19T22:31:39Z</h3>
<div><p>so I&#39;ve managed to exploit my shell to run bin/sh but then this error happens: (is this supposed to happen? gdb is on follow child processes so why can&#39;t I see the shell?)</p>
<p></p>
<p>Continuing.<br />[New process 1409]<br />process 1409 is executing new program: /bin/dash<br />Error in re-setting breakpoint 1: No source file named zookd.c.<br />[Inferior 3 (process 1409) exited with code 0177]</p>
<p>-------<br />I am also confused on what to do next. Right now my exploit is formatted like &lt;padding&gt;&lt;return to sys&gt;&lt;exit&gt;&lt;address for bin/sh&gt; like the reading, but where do I link the shellcode? I think that I&#39;m supposed to inject the shellcode into memory via the URL path by cleverly finagling it into a environment variable that I can point the system return pointer (So where Exit is now) to, is this right? </p></div>
<h2>Student Answer</h2>
<div><p>A ret-to-libc attack doesn&#39;t involve injecting your own shellcode like we did before. Instead, you make use of functions that are already loaded into memory from libc. You just need to structure the call to an existing function properly for your purpose. We want to remove the grades.txt file; what function is called to do that? (you used it in the shellcode from the previous part). And what should the stack look like when that function is called so that it has the right arguments? (you set the stack up like this in the previous part as well; before you did it with shellcode, now you can just store things on the stack itself in your buffer)</p></div>
<h2>Staff Answer</h2>
<div><p>If you successfully open the shell, the open shell will be on the terminal that you run your server. </p>
<p>Try start server with this command without &#34;&amp;&#34; at the end.<br /><br /></p>
<pre>./clean-env.sh ./zookd-exstack 8080</pre>
<p></p>
<p>Then when you finish exploit go to your server terminal, <br />sometime you might need to type enter in this server terminal and you should see the $ dollar sign for the shell.</p></div><hr><h1>Exercise 5 - Vulnerability type</h1>
<h3>2018-02-19T22:30:28Z</h3>
<div><p>For exercise 5, we&#39;re supposed to find at least two more vulnerabilities; can/should these also be buffer overflows?</p></div>
<h2>Staff Answer</h2>
<div><p>No more buffer overflows. Please find other vulnerabilities.</p></div><hr><h1>Quiz 1: 2013 (II Baggy Bounds Checking)</h1>
<h3>2018-02-19T20:38:01Z</h3>
<div><p>Suppose we have the following program running Baggy Bounds checking with slot_size=16 (this code was taken from Quiz 1, 2013).</p>
<p>(We assume that p and q are allocated right after each other)</p>
<p></p>
<pre>1. char *p, *q;
2. char *a, *b, *c, *d, *e, *f;
3.
4. p = malloc(48);
5. q = malloc(16);
6.
7. a = p &#43; 46;
8. b = a &#43; 10;
9. *b = ’\0’;
10. c = b &#43; 10;
11. d = c &#43; 10;</pre>
<p></p>
<p>According to the quiz answers, this program will throw a &#34;baggy bounds exception&#34; at line 11 because the value of d is 76 bytes beyond p, which is more than half a slot size (8 bytes) over the power-of-2 allocation size for p (64 bytes).</p>
<p></p>
<p>But isn&#39;t (p &#43; 76) a valid address for q (see memory below)? Why would Baggy Bounds throw an exception if (p &#43; 76) contains valid data?</p>
<p></p>
<p>(Suppose the heap starts at 0x00)<br />q: 0x40 - 0x4F (16 bytes)<br />p: 0x00 - 0x3F (64 bytes)</p></div>
<h2>Staff Answer</h2>
<div><p>The base slot that goes along with c is p (it is less than 1/2 slot above p&#39;s maximum size, so baggy bounds can conclude that this c an OOB pointer derived from p.   But adding another 10 to c would make it go above p&#43;size&#43;1/2 slot, so it throw an exception.</p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p></div>
<h2>Followup</h2>
<div><p>Thanks Frans. Just to clarify, does this mean Baggy Bounds keeps track of the base slot for every single pointer declared in the program? If this is correct, what data structure does it use to keep track of base slots? I don&#39;t think I read about this in the paper. If Baggy Bounds doesn&#39;t keep track of base slots, how can Baggy Bounds conclude that a pointer is out of bounds?</p></div>
<h3>Followup Response</h3>
<div><p></p><p style="text-align:left">yes, it does: it has a bounds table.   BB&#39;s bounds table is cleverly organized so that the lookup to find the size of the object that a pointer p points to is efficient.  More in lecture tomorrow.</p></div>
<h3>Followup Response</h3>
<div><p>I think my question is slightly different. I&#39;m wondering how Baggy Bounds keeps track of the source pointer (before I called it base slot) associated with every pointer variable.</p>
<p></p>
<p>I believe the bounds table is used for something different. If I understood correctly, the bounds table is used to lookup the size of every pointer object.</p>
<p></p>
<p>Thanks!</p></div>
<h3>Followup Response</h3>
<div><p>From c it can compute p directly using the table.    Take c &gt;&gt; 4, index into table, find size, </p>
<p>compute p &amp; ~(size-1), where size  = 1 &lt;&lt; table[c &gt;&gt; 4].   Since c is marked OOB, BB first subtracts or adds slot size (depending whether c is in the bottom or top of a slot) before doing the right shift (c &gt;&gt; 4).</p></div>
<h3>Followup Response</h3>
<div><p>Ok. That makes sense! I filled in some details below, mostly for my own understanding and if anyone else wants to read.</p>
<p></p>
<p>Let&#39;s assume that p is allocated at address 0x0 and occupies 64bytes. Let&#39;s also assume that q is allocate right after p and occupies 16 bytes. Under these assumptions, the heap would look like this:</p>
<p>q: 0x40 - 0x4F (16 bytes)<br />p: 0x00 - 0x3F (64 bytes)</p>
<p></p>
<p>Now, suppose the CPU is at line 11. At this point c=0x90000042 (out of bounds!; 66 || {out of bounds bit})</p>
<p></p>
<p>First BB computes size</p>
<p>c is marked out of bounds so we subtract 0x8 from it and clear the out of bounds marker</p>
<p>c = 0x3A (58)</p>
<p>size = 1 &lt;&lt; table[c&gt;&gt;log2(16)] = 1 &lt;&lt; table[c&gt;&gt;4] = 1 &lt;&lt; table[0x3].</p>
<p>table[0x3] stores the value 6, since the size of the object in the 3rd slot is 64 bytes</p>
<p>Therefore, size = 1 &lt;&lt; 6 = 64</p>
<p></p>
<p>Then BB computes base</p>
<p>base = c &amp; ~(size - 1) = 0x3A &amp; ~63 = 0x00</p>
<p></p>
<p>d = 76 &gt; base = 0</p>
<p>But, d - base = 76 &gt; size = 64, therefore BB throws an exception; because (d - base) is more than half a slot size (8 bytes) over 64 bytes.</p>
<p></p></div><hr><h1>return-to-libc</h1>
<h3>2018-02-19T20:21:38Z</h3>
<div>For 4a/4b, does our exploit need to return cleanly? Or just remove grades.txt file?</div>
<h2>Staff Answer</h2>
<div>Just unlinking is fine unless the lab explicitly states otherwise.</div><hr><h1>Q3 :: &#34;No such file or directory&#34;</h1>
<h3>2018-02-19T20:12:08Z</h3>
<div><p>Hello,</p>
<p></p>
<p>please help.</p>
<p></p>
<p>I engineered the stack for calling unlink() with the &#34;/home/httpd/grades.txt&#34; as a parameter. </p>
<p>However, I receive __syscall_error &#34;No such file or directory&#34;.</p>
<p></p>
<p>What can potentially cause this? </p>
<p></p>
<p>Thank you</p></div>
<h2>Student Answer</h2>
<div>Are you sure that:

- /home/httpd/grades.txt is stored somewhere without mutations (as in maybe it got overwritten with all caps--this happened to me)

- you&#39;re overwriting ebp&#43;correct offset with a pointer to that char array? It&#39;s hard to say exactly what&#39;s going wrong without knowing what stuff you&#39;re pushing onto the stack. The relative ordering should (from low to high) look something like: system address, /usr/bin/unlink&#39;s char *, /home/httpd/grades.txt&#39;s char *</div>
<h2>Followup</h2>
<div><p>Justin, thanks for the note.</p>
<p></p>
<p>yep, I debugged and checked - unlink() is called, the path is stored on the stack with an argument which points to that path....</p>
<p></p>
<p>I understand, that w/o seeing the code, it&#39;s hard to advise. </p>
<p></p>
<p>anyways, thanks!</p></div>
<h3>Followup Response</h3>
<div>From what you&#39;ve described there, double check the ordering of your arguments. Don&#39;t change system&#39;s location, but try changing the relative ordering of the other args.</div>
<h2>Staff Answer</h2>
<div><p>&#34;No such file or directory&#34; error from syscall means that unlink syscall doesn&#39;t find the file you indicate. <br />My assumption is that even though you did provide correct string path &#34;/home/httpd/grades.txt&#34;, you might provide wrong address to the string path address itself which cause this error. :) <br />Try use gdb to help you place the string address correctly when call unlink. </p></div><hr><h1>Null pointer issue when trying to call to libc with function pointer exploit</h1>
<h3>2018-02-19T17:23:15Z</h3>
<div><p>For exercise 4, I&#39;m trying to do a call to libc using the function pointer *handler.  However, since this exploits the vulnerable strcat method, inputting the filepath to grades.txt includes a null terminating character that effectively prevents strcat from seeing the rest of the exploit.  How can I bypass this?  If the filepath is at the end so that the null terminating character doesn&#39;t end the string, then it will overwrite the ebp and return address, rather than just exploiting the function pointer.  Or is it ok that both of my exploits overwrite the return address?</p></div>
<h2>Followup</h2>
<div><p>&#34;Or is it ok that both of my exploits overwrite the return address?&#34; That&#39;s what I did, after encountering the same problem. The prompt doesn&#39;t explicitly say that one needs to overwrite return address and the other needs to use another control mechanism (as does Exercise 2). </p></div>
<h2>Staff Answer</h2>
<div><p>I can confirm that exploit handler pointer is possible. You might have to think a little more on how can you do some trick to overcome the issue about string null termination you said earlier. <br />4b should be similar to 2b when you need to control program execution flow without exploiting return address.</p></div>
<h2>Followup</h2>
<div><p>I tried placing the string at the end of the exploit so that we don&#39;t run into the null character issue ... but if the sys_unlink function is located at the function pointer, with the filepath string afterwards then there&#39;s no space left and it overruns the ebp and return address.  Can you provide any hint as to how we might be able to fit?</p></div>
<h3>Followup Response</h3>
<div><p>The point of overwriting handler is to trigger the change in execution path from calling handler() not return address right?</p></div><hr><h1>Overwrite or append to answers.txt?</h1>
<h3>2018-02-19T16:20:07Z</h3>
<div><p>For part 3 and 4, do we overwrite the submitted answers.txt for part 1 and 2, or append to it? </p></div>
<h2>Staff Answer</h2>
<div><p>Append.</p></div><hr><h1>Office Hours Tuesday 2/20</h1>
<h3>2018-02-18T20:49:11Z</h3>
<div><p>Can there please be office hours from 9-11am on Tuesday 2/20 (as there are usually office hours on Tuesday mornings), despite this Tuesday running on Monday schedule?</p>
<p></p>
<p>Thanks!</p></div>
<h2>Staff Answer</h2>
<div><p>I can&#39;t make office hours this morning due to the Monday schedule. Sorry about that.</p></div>
<h2>Followup</h2>
<div><p>Are the Tues afternoon office hours 4:30-6:30pm happening today still? </p></div><hr><h1>Confused about return-to-libc reading</h1>
<h3>2018-02-17T22:52:42Z</h3>
<div><p>I was confused by the reading on return-to-libc attacks <a href="https://css.csail.mit.edu/6.858/2018/readings/return-to-libc.pdf" target="_blank">linked</a> from the lab assignment. It contains the figure included below. This figure makes it look like we are writing the address of &#34;system&#34; to EBP instead of EIP. But I thought we were supposed to overwrite the instruction pointer with the address of the system call. Am I missing something?</p>
<p></p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/hl484z61en67w/jdryk8mmznle/Screen_Shot_20180217_at_5.50.15_PM.png" alt="" /></p></div>
<h2>Staff Answer</h2>
<div><p>I totally agree with you and I think you are right. I&#39;m not sure why does the author use ebp and eip. <br /><br />If I have to label, instead of &#34;args, ebp, eip&#34;, I will label <br />&#34;args/buff &#43; old_ebp, return_addr, and next_return_addr&#34;</p>
<p></p></div><hr><h1>Exercise 4 finding address of &#34;/home/httpd/grades.txt&#34;</h1>
<h3>2018-02-17T21:21:07Z</h3>
<div><p>In the reading, it seems that the person just know where the address of &#34;/bin/sh&#34; is but how do we actually find the address of the string? And how do we set an environment variable and where? Do we not have to modify code in httpd.c to do that?</p></div>
<h2>Staff Answer</h2>
<div><p>Check &#64;51 -&gt; so no code modification and nothing beyond what normal user can do.<br />You did have an idea that goes in the right direction but you will have to figure out more on how to do the trick.</p></div><hr><h1>late hours?</h1>
<h3>2018-02-17T09:39:09Z</h3>
<div><p>the grades page doesn&#39;t show how many late hours you&#39;ve used.</p>
<p></p>
<p>is this supposed to show up? or are late hours assigned at the end of the semester?</p></div>
<h2>Staff Answer</h2>
<div><p>The site will show aggregated late hours when you submit all of lab 1.  (So, it&#39;s at the end of each complete lab.)</p></div><hr><h1>Buffer Overflow in Real Life?</h1>
<h3>2018-02-17T03:19:19Z</h3>
<div><p>I suppose in reality nearly none of the servers are written in C. Most uses PHP, with the most of the rest useing ASP.NET (<a href="https://w3techs.com/technologies/overview/programming_language/all">https://w3techs.com/technologies/overview/programming_language/all</a>). And it seems to be consensus on the Internet that those two languages aren&#39;t prone to buffer overflow, as long as you stick with everything &#34;standard&#34; (i.e. not explicitly trying to access and use the low-level C code). So is buffer overflow still good for anything? and how does real modern web hacking work? </p></div>
<h2>Followup</h2>
<div><p>A lot of applications are written in C or variants of C (C&#43;&#43;, C#, Objective-C, Objective-C&#43;&#43;, etc), however.</p></div>
<h3>Followup Response</h3>
<div><p>Yes, but I suppose those &#34;higher-level&#34; language has more preventative bound checking? <a href="https://stackoverflow.com/questions/9343665/are-buffer-overflow-exploits-possible-in-c">https://stackoverflow.com/questions/9343665/are-buffer-overflow-exploits-possible-in-c</a> talks about C# which is supports asp.net. It says that unless you use unsafe construct intentionally, you are pretty safe, unless there is a bug in C#, which affects millions of programs simultaneously. </p></div>
<h2>Student Answer</h2>
<div><p>Even though most servers don&#39;t write their application code in C, there is almost always some code running on the server written in C. (For example, PHP itself is implemented in C, along with many other dynamic languages.) Servers also often run load balancers such as nginx, which is written in C. The Heartbleed bug from a few years ago was triggered a buffer overflow in C code, and affected a majority of servers on the internet.</p></div>
<h2>Staff Answer</h2>
<div><p>Here are some: https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=buffer&#43;overflow</p></div><hr><h1>assembly</h1>
<h3>2018-02-17T00:11:32Z</h3>
<div><p>is there going to be more assembly and stack frame debugging in future labs? (i&#39;m hoping not)</p>
<p></p>
<p>writing, understanding, and debugging assembly is really painful :(</p>
<p>also we never learned x86 assembly (004 assembly is very different), so it&#39;s really hard...</p></div>
<h2>Staff Answer</h2>
<div><p>No direct focus on assembly in future labs, but each lab will require you to master some new infrastructure (e.g., lab2 unix permissions etc.).    </p>
<p></p></div><hr><h1>gdb breakpoints?</h1>
<h3>2018-02-17T00:06:18Z</h3>
<div><p>i tried breakpointing in http_serve, but it seems that gdb never reaches the method, since it hangs forever and never stops at http_serve</p>
<p></p>
<p>but how can it not reach http_serve?</p>
<p>i can only breakpoint in zookd.c, and only before the get request headers line (it dies when it tries to retrieve the HTTP headers)</p>
<p>i don&#39;t know why this is happening since i didn&#39;t change any of the C files</p></div>
<h2>Student Answer</h2>
<div><p>You can breakpoint at lines of interest, eg</p>
<pre>break http.c:123</pre>
<p>You can do that at some places in the path the request follow and examine the stack and local variables of interest. Then you can <tt>continue</tt> to the next break point or use <tt>next</tt> to move one step at a time, etc.</p></div>
<h2>Followup</h2>
<div><p>I tried, but it&#39;s not working...</p>
<p></p>
<p>I think my gdb and/or program is just really messed up :&#39;(</p></div>
<h3>Followup Response</h3>
<div><p>What is it that happens? eg what are outputs that you get when you run gdb and set breakpoints? Also does it work without gdb? Does it work with a normal http request?</p>
<p></p>
<p>Also do you <tt>continue</tt> after setting the breakpoints?</p>
<p></p>
<p>If nothing works you can try saving you work and re-extracting a fresh copy of the vm and trying again?</p></div>
<h3>Followup Response</h3>
<div><p>Did you have to add HTTP headers manually? I just used the exploit template, which only has the HTTP request and not the header, and the server always dies trying to parse the headers.</p>
<p></p>
<pre>http_request_headers (fd=4) at http.c:129
129	        if (http_read_line(fd, buf, sizeof(buf)) &lt; 0)
(gdb) 
http_read_line (fd=4, buf=0x8050140 &lt;buf&gt; &#34;&#34;, size=8192) at http.c:32
32	    size_t i = 0;
(gdb) 
36	        int cc = read(fd, &amp;buf[i], 1);
(gdb) 
read () at ../sysdeps/unix/syscall-template.S:84
84	../sysdeps/unix/syscall-template.S: No such file or directory.
(gdb) 
0x40027c28 in __kernel_vsyscall ()
(gdb) 
Single stepping until exit from function __kernel_vsyscall,
which has no line number information.</pre>
<p></p></div>
<h3>Followup Response</h3>
<div><p>Are you running gdb from ~/lab ?</p></div>
<h2>Staff Answer</h2>
<div><p>One assumption about &#34;hangs forever and never stops&#34; &#43; stuck at http_read_line is that you might forget to include &#34;\r\n&#34; in your GET request, so the input pipe didn&#39;t know when to stop waiting for more input. </p></div><hr><h1>server always hangs?</h1>
<h3>2018-02-16T23:58:41Z</h3>
<div><p>i&#39;ve never been able to get the HTTP request to actually <em>work</em></p>
<p></p>
<p><em>either </em> the server crashes or it just hangs forever</p>
<p>this is true even when i use the most basic HTTP request</p>
<p>GET / HTTP/1.0</p>
<p></p>
<p></p>
<p>how can i resolve this issue?</p></div>
<h2>Staff Answer</h2>
<div><p>If you run gdb attaching to the zookd-exstack process, it will hang because the debugger paused it at the beginning or when it hits the break point. To solve this issue, run &#34;continue&#34; or &#34;c&#34; command in gdb that you attach the process to.</p></div><hr><h1>Special way of formatting HTTP Headers?</h1>
<h3>2018-02-16T23:43:25Z</h3>
<div><p>Hi, is there a special way for formatting HTTP headers that I&#39;m missing because my URL is getting stuck on read_line if I&#39;m just using a bunch of &#34;A&#34;&#39;s concatenated together to try and exploit the pn buffer in http_serve?</p></div>
<h2>Student Answer</h2>
<div><p>Are you attempting an exploit at the moment? I had that issue with the infinite loop in <code>http_read_line()</code> and fixed it by padding more &#39;A&#39;s even after overwriting the return address.</p></div>
<h2>Followup</h2>
<div><p>I&#39;m not even trying to overwrite the return address, I&#39;m just trying to get it to parse a ton of A&#39;s. I&#39;m confused. I&#39;m trying to get to http_serve but i&#39;m failing at http_headers</p></div>
<h2>Followup</h2>
<div><p>OK SO the way to do this is make sure you have &#39;\r\n&#39; twice if you want to go through both Http_request_line and http_request_headers.</p></div><hr><h1>Stack canaries</h1>
<h3>2018-02-16T22:01:59Z</h3>
<div><p>I have a few questions about stack canaries!</p>
<p></p>
<p>1. I understand how they can be used to detect if a return value has been over-written, but how can they be used to recover from the buffer overflow? What happens when the program detects that a buffer has overflown? </p>
<p></p>
<p>2. Are they always placed right before the return address? Is there a way to use stack canaries to protect local variables from being overwritten as well?</p></div>
<h2>Student Answer</h2>
<div><p></p><div>1) I don&#39;t think they&#39;re usable to recover from buffer overflow, but it prevents further exploitation/malicious instruction calls! It can choose to fail-fast in it&#39;s own way.</div>
<div></div>
<div>2) if you&#39;re going to put a stack canary at every local variable, might as well just check for out of bound calls on your arrays. </div></div><hr><h1>VM not connected to network</h1>
<h3>2018-02-16T21:02:45Z</h3>
<div><p>My VM showed an IP address earlier this week, but now, it doesnt have an IPv4 adress when I run</p>
<pre>/sbin/ifconfig eth0</pre>
<p>I looked at the previous post on network connection issues, tried that and it didn&#39;t resolve the problem. </p>
<p>I looked into it online, and my VM network adapter settings are set to &#34;Bridge&#34; and also there do not seem to be any recognized routers. I can&#39;t test my exploit because I can&#39;t ssh into the VM. Any advice? </p>
<p></p></div>
<h2>Followup</h2>
<div><p>I can&#39;t even submit what I have or transfer the file to my local machine to submit because my VM doesn&#39;t have network access. I went to OH on Thursday trying to fix this with no luck. </p></div>
<h3>Followup Response</h3>
<div><p>Do you still have a problem ? If I remember correctly, you said that your VM used to connect to the internet properly at your dorm but not at Stata. Can you also try downloading a new VM and use the other VM program (not sure if yours is already the recommend one) that is suggested from lab or other students who use Window use?</p></div>
<h3>Followup Response</h3>
<div><p>Yes, I&#39;m still having the issue. I followed the instructions as in the lab doc, and the VM is the VMWare workstation 14 that was recommended</p>
<p></p></div>
<h3>Followup Response</h3>
<div><p>I just don&#39;t want to waste my late hours on this issue because I wanted to turn this in like 5 hrs ago but I can&#39;t even ssh into the machine to get the file to turn in.</p></div>
<h3>Followup Response</h3>
<div><p>Hmm that&#39;s hard for me to help you fix that remotely without window right now. Let me try whether I can help you search the solution in Google.<br /><br />My advice for now is maybe going to Athena cluster and try using KVM to access VM from that Athena machine, so that you can at least submit the lab. <br /><br />ps. might be a good idea to make new Piazza asking about Window VM specifically, so that students or maybe TAs who used Window can notice issue and give you some advice.<br /><br /><br /></p></div>
<h3>Followup Response</h3>
<div><p>Can you also try downloading new 6858 VM and open it? since the internet once work for you</p></div>
<h3>Followup Response</h3>
<div><p>Can you try <a href="https://www.vmware.com/support/ws4/doc/network_configure_ws.html">https://www.vmware.com/support/ws4/doc/network_configure_ws.html</a> &#34;Adding and Modifying Virtual Network Adapters&#34; and check what is the current network type? Maybe change the network type to NAT?</p></div>
<h3>Followup Response</h3>
<div><p>Downloading a new VM fixed the issue at least for now. Thanks!</p></div>
<h3>Followup Response</h3>
<div>Yeah :) Glad that work!</div>
<h2>Student Answer</h2>
<div><p>resolved below</p></div><hr><h1>Handin site down?</h1>
<h3>2018-02-16T19:55:06Z</h3>
<div><p>I can&#39;t seem to access <a href="http://css.csail.mit.edu/6.858/2015/labs/handin.html">http://css.csail.mit.edu/6.858/2015/labs/handin.html</a>. Can anyone else?</p></div>
<h2>Followup</h2>
<div><p>Seems like css.csail.mit.edu is down right now...</p></div>
<h3>Followup Response</h3>
<div><p>EDIT: It&#39;s back up.</p></div>
<h2>Student Answer</h2>
<div><p>resolved</p></div><hr><h1>more emergency OH stata cafeteria</h1>
<h3>2018-02-16T19:32:53Z</h3>
<div>Come bring your debuggers if you still haven’t finished :)</div><hr><h1>Will content covered on the paper readings be on the quizzes?</h1>
<h3>2018-02-16T18:14:13Z</h3>
<div><p></p></div>
<h2>Staff Answer</h2>
<div><p>Yes.   The schedule (<a href="https://css.csail.mit.edu/6.858/2018/schedule.html">https://css.csail.mit.edu/6.858/2018/schedule.html</a>) lists past year&#39;s quizzes if you want to get a bit better feel for what kind of questions they ask about the readings.</p></div><hr><h1>Is the region where static data is stored always non-executable?</h1>
<h3>2018-02-16T15:49:52Z</h3>
<div><p>We know that the stack itself can be executable or not, depending on how it&#39;s configured. What about for a static buffer? Is it ever possible to jump to the memory address of a static buffer and execute code stored there, or is the static region of memory always non-executable?</p></div><hr><h1>address not being added to request properly</h1>
<h3>2018-02-16T13:58:42Z</h3>
<div><p>I&#39;m adding the address where the shellcode is to the end of the request I&#39;m sending. However, when I inspect the inserted buffer with gdb, the address I wanted to add isn&#39;t there, it&#39;s a different address. I&#39;m adding it like this: </p>
<p>attack_address = 0xbffff18c &#43; 1</p>
<p>reqpath &#43;= struct.pack(&#34;&lt;I&#34;, attack_address)</p>
<p></p>
<p>Am I doing something wrong? When I print out reqpath, the attack_address appears as &#39;????&#39;. Is that just a print issue? </p>
<p></p>
<p></p></div>
<h2>Student Answer</h2>
<div>Consider what characters are safe to put in a URL.</div><hr><h1>NOP?</h1>
<h3>2018-02-16T06:12:58Z</h3>
<div><p>I tried to make a NOP sled by appending  &#96;struct.pack(&#34;&lt;I&#34;, 0x90)&#96; to my shell code. Turns out that taking this out caused the code to work --- but leaving it in caused my program not to reach the shell code part.</p>
<p></p>
<p>Any ideas?</p></div>
<h2>Staff Answer</h2>
<div><p>Did you URL encode the NOP sled?</p></div>
<h2>Followup</h2>
<div><p>Ah. I didn&#39;t know that NOP is supposed to be only 1 byte. <tt>struct.pack(&#34;&lt;B&#34;, 0x90)</tt> did it. Thanks!</p></div><hr><h1>Exercise 1 --- only overflow but can&#39;t gain control access</h1>
<h3>2018-02-16T04:31:06Z</h3>
<div><p>I was wondering for ex.1, is it sufficient to find 5 buffer overflows only(that might or might not give attacker access to control flow).</p>
<p>Or must the 5 examples give attacker access to control flow?</p></div>
<h2>Staff Answer</h2>
<div><p>Vulnerabilities that allow you to overflow the buffer is enough. No need to change the control flow.</p></div><hr><h1>How do we find out the number of the unlink syscall?</h1>
<h3>2018-02-16T04:30:24Z</h3>
<div><p>Is it the number in /usr/include/asm-generic/unistd.h?</p>
<pre>#define __NR_unlink 1026<br />__SYSCALL(__NR_unlink, sys_unlink)</pre>
<p></p></div>
<h2>Staff Answer</h2>
<div><p>Check how our template assembly call SYS_execve and modify from there to call SYS_unlink. You shouldn&#39;t need to find any number.</p></div><hr><h1>Cannot Find Bounds on Current Function</h1>
<h3>2018-02-16T04:03:13Z</h3>
<div><p>I&#39;ve overflown the buffer and overridden the desired address correctly, but when the program jumps to my new address in the stack to perform shellcode, it says &#34;Cannot Find Bounds on Current Function&#34; and freezes. I know this is the correct address to the beginning of the shellcode assembly because it corresponds perfectly to the shellcode.S. Anyone know what is causing this?</p>
<p></p>
<p></p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/ieboi20jsiy28r/jdpemmen8rb8/Screen_Shot_20180215_at_10.55.24_PM.png" alt="" width="321" height="425" /></p></div>
<h2>Staff Answer</h2>
<div><p>I&#39;m concern about the calling convention when you call handler function. It might look for arguments fd and pn or other issue related to calling convention. Since the deadline is approaching, I suggest switching to other exploit that do normal overwriting return address and you should be good.</p></div>
<h2>Followup</h2>
<div><p>As I mentioned, I&#39;ve tried multiple exploits and I get the same error every time. Here is another example:</p>
<p></p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/ieboi20jsiy28r/jdphia0bfl1t/Screen_Shot_20180216_at_12.18.53_AM.png" alt="" width="782" height="489" /></p></div>
<h3>Followup Response</h3>
<div><p>Oh sorry I miss that part. Can you post privately and dump the shellcode.S and your python request so that I can help take a look? </p></div>
<h2>Followup</h2>
<div><p>how did you solve this? I&#39;m having the same issue.</p></div>
<h2>Followup</h2>
<div><p>Ok I found the cause. The gdb cannot recognize the current context probably because the shellcode confuses gdb by its unknown function and very low level instruction instead of C. It will have trouble finding the stack frame, reference of variable by name etc. That&#39;s why it shows the error &#34;Cannot Find Bounds on Current Function&#34;. However, this error doesn&#39;t affect the exploitation behavior and you can still observe the register normally. <br /><br />I reproduced this gdb error on my shellcode exploit that works but it still work properly, so no need to worry about it. </p>
<p>If you have correct exploitation, once you &#34;continue&#34; the gdb you should see the grades.txt disappear! :)<br /><br /><br /></p></div><hr><h1>adding unlink to the shellcode.S</h1>
<h3>2018-02-16T03:28:45Z</h3>
<div><p>I&#39;m basically following the tips from this: <a href="https://stackoverflow.com/questions/29482174/delete-a-file-in-linux-assembly-x86#29814999">https://stackoverflow.com/questions/29482174/delete-a-file-in-linux-assembly-x86#29814999</a></p>
<p>but i can&#39;t seem to get it to work? im putting it right before the shell code. when i run it, the shell still runs, but the file is not deleted.</p></div>
<h2>Staff Answer</h2>
<div>You wanna get rid of the call to shell, otherwise the OS will go into the /bin/sh process, plus it might be too much code to fill into a buffer.</div><hr><h1>There&#39;s no recitation I&#39;ve been missing this whole time, is there?</h1>
<h3>2018-02-15T23:49:43Z</h3>
<div><p>Asking because the Ben Yuan video is from a canceled recitation, I guess from last year...</p></div>
<h2>Staff Answer</h2>
<div>Yeah there are no recitations for this class. The video was from previous years which we found to be very useful for students. </div><hr><h1>Impromptu OH at stud 4th floor until 7:30ish</h1>
<h3>2018-02-15T23:16:49Z</h3>
<div><p>Some people really wanted help soooo :)</p></div>
<h2>Followup</h2>
<div><p>OMGG Thank you so much Monde and Lef!!! Elaine and I also run OH since 2.30pm until 8pm ish today too &lt;3 &lt;3 &lt;3</p></div>
<h3>Followup Response</h3>
<div><p>It was really, really helpful - thank you so much, TAs!!!! :)</p></div><hr><h1>Errors when running on Windows</h1>
<h3>2018-02-15T23:15:41Z</h3>
<div><p>When trying to open the VM using VMWare on Windows, I get the following error:</p>
<p></p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/hzy9eilrz4f41l/jdp4f3jypnjm/20180215_18_10_44vm6858_i386__VMware_Workstation_14_Player_Noncommercial_use_only.png" alt="" /></p>
<p></p>
<p>Not sure how to proceed from here. I&#39;ve also tried using an Athena cluster machine, but I have a 2GB quota and the file is slightly larger than 2GB.</p></div>
<h2>Staff Answer</h2>
<div><p>You should google that error message. Your system BIOS needs some configurations changed. The instructions online should tell you something along the lines of rebooting your computer and pressing F2 and changing some configuration from that screen.</p>
<p></p>
<p>First google link I found: <a href="https://docs-old.fedoraproject.org/en-US/Fedora/13/html/Virtualization_Guide/sect-Virtualization-Troubleshooting-Enabling_Intel_VT_and_AMD_V_virtualization_hardware_extensions_in_BIOS.html" target="_blank">https://docs-old.fedoraproject.org/en-US/Fedora/13/html/Virtualization_Guide/sect-Virtualization-Troubleshooting-Enabling_Intel_VT_and_AMD_V_virtualization_hardware_extensions_in_BIOS.html</a></p></div><hr><h1>Lab 1 exercise 1</h1>
<h3>2018-02-15T23:15:36Z</h3>
<div><p>Some of the vulnerabilities I found are definitely buffers one can overflow, but can&#39;t actually do in practice because zookd doesn&#39;t allow it. For example, sending in an GET request for http_serve_directory with a certain directory name can overflow the buffer name, but zookd doesn&#39;t allow the execution to get there because we can only query for directories that exist.</p>
<p></p>
<p>Is it sufficient to just ignore the fact that we can&#39;t actually do it in practice? Or is this kind of buffer disallowed.</p></div>
<h2>Student Answer</h2>
<div><p>Are you sure there isn&#39;t a way to give a valid directory name in a really verbose way?</p></div>
<h2>Followup</h2>
<div><p>That&#39;s a really cool idea! But not being familiar with this, I don&#39;t know how to do that or what google terms to search...</p></div>
<h3>Followup Response</h3>
<div><p>Okay, I figured out one way to do it... it was... strange?</p></div>
<h3>Followup Response</h3>
<div>Could you give a hint on what to look for? I&#39;ve been trying to overflow name for a while now and just can&#39;t seem to figure it out....</div>
<h3>Followup Response</h3>
<div>nvm that&#39;s such a troll lol</div><hr><h1>How to Convert Assembly to Shellcode</h1>
<h3>2018-02-15T22:23:30Z</h3>
<div><p>Hi,</p>
<p></p>
<p>Does anyone know how to convert Assembly to Shellcode? I did Exercise-3 Warmup and verified it works, but don&#39;t know where to go from here. Thanks!</p>
<p></p></div>
<h2>Staff Answer</h2>
<div><p>We do it for you if you type &#96;make&#96;. The shellcode is in shellcode.bin and you can run it with run_shellcode.sh.</p></div><hr><h1>Code Question</h1>
<h3>2018-02-15T22:19:20Z</h3>
<div><p>Regarding setenv(&#34;SCRIPT_NAME&#34;, pn &#43; strlen(getenv(&#34;DOCUMENT_ROOT&#34;)), 1);</p>
<p></p>
<p>Is the code fragment pn&#43;strlen(getenv(&#34;DOCUMENT_ROOT&#34;)) concatenating a str and a integer together? so if strlen(getenv(---)) is 1, then it would be &#34;&lt;whatever pn is&gt;1&#34;?</p>
<p></p>
<p>Thanks</p></div>
<h2>Staff Answer</h2>
<div><p>pn is a pointer to the buffer. strlen gives you the length of the string getenv(&#34;DOCUMENT_ROOT&#34;). Adding these two gives you the pointer to the strlen(getenv(&#34;DOCUMENT_ROOT&#34;))-th element in the pn buffer.</p></div><hr><h1>lec and pq submissions</h1>
<h3>2018-02-15T22:13:36Z</h3>
<div><p>I wrote all my paper questions in lec2.txt and lex3.txt files because I didn&#39;t read carefully. Can they also be graded?</p></div>
<h2>Staff Answer</h2>
<div><p>We&#39;ll fix your submission on our end. No worries :)</p></div><hr><h1>Lab 1 Part 1</h1>
<h3>2018-02-15T22:04:40Z</h3>
<div><p>Regarding exploits, can we assume it is possible to overwrite an environment variable and overflow a buffer through that way? ex. set a env var that is later called to be be written into a buffer.</p></div>
<h2>Staff Answer</h2>
<div><p>As long as you&#39;re able to demonstrate the fact that you can cause a buffer overflow with some kind of input, you should be good to go.</p></div><hr><h1>VM not connecting to network?</h1>
<h3>2018-02-15T20:07:48Z</h3>
<div><p>I&#39;m working in VMWare Fusion. Once upon a time running ifconfig gave me an IP address which worked to connect to in my browser. Starting last night, the VM started refusing to connect to the network for no reason I can think of and now it won&#39;t even boot, so not only can I not work on the lab, I can&#39;t even get at the code I had. </p>
<p></p>
<p>I&#39;ve played with the settings but haven&#39;t found anything useful. Running a new VM doesn&#39;t work either, which makes me think it&#39;s something in my VMWare settings, but I really don&#39;t think I changed anything that should&#39;ve made it stop working. Anyone have any insight?</p></div>
<h2>Student Answer</h2>
<div><p>Try restarting your VM network interface. First turn eth0 off: </p>
<pre>sudo ifdown eth0</pre>
<p>then back on again: </p>
<pre>sudo ifup eth0</pre>
<p>Then try running <tt>ifconfig </tt>again to see if eth0 gives a ip address now. </p></div>
<h2>Followup</h2>
<div><p>I&#39;m having the same issue on my windows machine, but the above did not fix my issue. I can&#39;t run anything, please help!</p></div><hr><h1>Overwriting return address (Exercise 2)</h1>
<h3>2018-02-15T19:27:53Z</h3>
<div><p>I ran my exploit code and confirmed with gdb (x $ebp&#43;4) that the return address was overwritten with 0x41414141.</p>
<p></p>
<p>However, instead of returning the signal 11, the server returns no response... My exploit code is stuck at &#34;Request sent, waiting for reply...&#34;.</p>
<p></p>
<p>Any suggestions on what I might be doing wrong?</p></div>
<h2>Student Answer</h2>
<div><p>It may be that gdb is still halting the code? Have you tried typing continue in the terminal that is running gdb?</p></div>
<h2>Followup</h2>
<div><p>Yea I did do &#34;continue&#34; but just nothing happens after. No response or error.</p></div>
<h3>Followup Response</h3>
<div><p>Resolved. I ended up just picking another exploit that overwrites a return address...</p></div><hr><h1>Must the buffer that overflows be in the stack?</h1>
<h3>2018-02-15T11:28:51Z</h3>
<div><p>So I found a vulnerability, which I can exploit to cause a web server crash. But this vulnerability doesn&#39;t rely on overwriting a buffer in the stack, but on overwriting a static variable (&#39;env[8192]&#39;). Is this an acceptable vulnerability?</p></div>
<h2>Student Answer</h2>
<div><p>FWIW, I assumed that this sort of bug was fine to count, considering that in later questions they ask you to specify details about which bugs can be exploited in which manner-- that indicates to me that they&#39;re expecting multiple different types bugs/overflows. But then again, you know what they say about assuming...</p></div>
<h2>Staff Answer</h2>
<div><p>Yes, that&#39;s fine.</p></div><hr><h1>Gdb hardware watches not working?</h1>
<h3>2018-02-15T08:13:17Z</h3>
<div><p>I was having trouble getting GDB&#39;s <tt>watch</tt> command to actually break when the value changed. After disabling hardware-assisted watchpoints (<a href="https://sourceware.org/gdb/current/onlinedocs/gdb/Set-Watchpoints.html" target="_blank">as specified here</a>), the watchpoints seem to be functioning correctly.</p>
<p></p>
<p>My question is: is it more likely I&#39;m using watchpoints incorrectly, or does some component of our dev environment (e.g. the VMWare Fusion VMs) preclude using hardware-assisted watchpoints?</p></div>
<h2>Staff Answer</h2>
<div><p>If it works in software, you&#39;re using them correctly! The hardware watchpoints in just an optimization that probably is not implemented in the VMware vcpu.</p></div><hr><h1>lab1a response</h1>
<h3>2018-02-15T07:32:54Z</h3>
<div><p>I ran &#96;make check-crash&#96; and &#96;make check-exstack&#96; and all 3 checks passed, so I ran &#96;make submit-a&#96; to submit but it&#39;s already been a while and there is <strong>no response on the submission site.</strong> Is there supposed to be an auto-grader that runs an automated check like in 6.828? </p></div>
<h2>Staff Answer</h2>
<div><p>There is no autograder like in 6.828. </p></div><hr><h1>exercise 3 encoding shellcode</h1>
<h3>2018-02-15T06:51:07Z</h3>
<div><p>In the function build_exploit(shellcode), I&#39;m applying urllib.quote(shellcode) to get a percent-encoded string that looks something like </p>
<p></p>
<pre>&#39;%EB%1F%5E%89v%081%C0%88F%07%89F%0C%B0%0B%89%F3%8DN%08%8DV%0C%CD%801%DB%89%D8%40%CD%80%E8%DC%FF%FF%FF/bin/sh&#39;</pre>
<p>Does it need to be ascii-encoded to look something like &#39;\xeb\x1f...&#39; before being injected? </p>
<p>If so, how can I convert it to the ascii encoding? I&#39;ve tried .encode(&#39;ascii&#39;) and unicode() and none of those seem to work..</p></div>
<h2>Staff Answer</h2>
<div>For shellcode urllib.quote is enough :)<div>Whenever you want the part of url such as an address to be interpret as hex, you will use “\xff\x...” or struct.pack()</div></div><hr><h1>getaddrinfo error in gdb</h1>
<h3>2018-02-15T05:59:58Z</h3>
<div><p>When trying to run exploit-2a in gdb, I run into this error</p>
<p></p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/hzmpthrut8wzo/jdo3hgfgj3rk/Capture.PNG" alt="" /></p>
<p></p>
<p>1) not sure why it says the program has been started already</p>
<p>2) when I try to run exploit-2a again i still get the getaddrinfo error</p>
<p></p>
<p>any ideas on what&#39;s wrong?</p>
<p></p></div>
<h2>Staff Answer</h2>
<div><p>You should run your exploit in separate terminal. Think about gdb as a tool to follow your server side (c code), while your exploit (client side) is from python. <br /><br />The error that you got &#34;program has been started already&#34; indicated how your gdb was currently debugging the binary ./zookd-exstack from process you attach with gdb -p $(pgrep -p zookd-exstack). <br /><br />For more detail explanation:<br />&#96;run &lt;argument&gt;&#96; command in gdb does mean restart the binary, which you include when first start gdb (in this case: the zookd-exstack), with this &lt;argument&gt;.<br />For example, &#96;run 8080&#96; will behave like &#96;./zookd-exstack 8080&#96;<br /><br />That&#39;s why we see this error when it interpret your &#96;exploit-2a.py&#96; as an argument of ./zookd-exstack binary.</p>
<pre>starting program: /home/httpd/lab/zookd-exstack exploit-2a.py.</pre>
<p></p></div>
<h2>Student Answer</h2>
<div><p>The straightforward way to fix this is to ssh into the VM in two separate terminal windows. This will separate the interwoven output you&#39;re seeing.</p>
<p></p>
<p>If you get tired of ssh-ing multiple times, try <a href="https://hackernoon.com/a-gentle-introduction-to-tmux-8d784c404340" target="_blank">tmux</a>.</p></div><hr><h1>Lab 1 exercise 1 files?</h1>
<h3>2018-02-15T04:38:38Z</h3>
<div><p>&#34;Exercise 1. Study the web server&#39;s code, and find examples of code vulnerable to memory corruption through a buffer overflow. &#34;</p>
<p></p>
<p>Is this only http.c or also zookd.c?</p></div>
<h2>Staff Answer</h2>
<div><p>Both files.<br />However, you can still get full credit as long as you find 5 vulnerabilities regardless of you finding vulns from both files or not.</p></div><hr><h1>* pointers in c</h1>
<h3>2018-02-15T03:29:24Z</h3>
<div><p>What does the following code mean in C? </p>
<p></p>
<p>char *sp1, *sp2, *qp, *envp = env;</p>
<p></p>
<p>I know that * means the variable is a pointer. So does this mean these are all pointers to env? What is env? </p></div>
<h2>Staff Answer</h2>
<div><p>Only the pointer *envp point to env. <br />In C, we initialize value of variable separately. <br />For example int x, y = 3, z = 2; mean we didn&#39;t initialize x value. <br /><br />env is a parameter pass in that function. Hope this helpl :)</p></div><hr><h1>make check-crash issue</h1>
<h3>2018-02-15T00:35:02Z</h3>
<div><p>Hi,</p>
<p></p>
<p>I have made two exploits. One in exploit-2a.py and the other in exploit-2b.py. When I run them, the server crashes with signal 11, otherwise known as a seg fault. When I run make check-crash, both tests fail. Not sure what to do.<img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/hlmw7ncksqb1mz/jdnrwgdqc68n/Screen_Shot_20180214_at_7.34.14_PM.png" alt="" /><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/hlmw7ncksqb1mz/jdnrwqnliixm/Screen_Shot_20180214_at_7.34.19_PM.png" alt="" /></p></div>
<h2>Student Answer</h2>
<div><p>It says &#34;Permission denied&#34; in the log. Try </p>
<p></p>
<pre>chmod &#43;x exploit-1a.py</pre>
<p></p></div>
<h2>Followup</h2>
<div><p>Cheers. Thanks!</p></div><hr><h1>Exercise 3 shell code location</h1>
<h3>2018-02-14T23:33:02Z</h3>
<div><p>Are we supposed to load the shell code to an address that is independent of the stack base pointer? Asking specifically because it seems like the server has a different initial base pointer address (i.e. the &#96;$ebp&#96; that &#96;main()&#96; is called with) when: 1) executed directly on the shell with &#96;./clean-env.sh&#96;, and 2) executed in &#96;gdb&#96; with &#96;exec-wrapper&#96; set to &#96;./clean-env.sh&#96;.</p>
<p></p>
<p>I assume that our exploit needs to work under both cases right? Thanks!</p></div>
<h2>Student Answer</h2>
<div><p>Ah never mind looks like there are ways to load it to a stack-invariant address. Sorry for the spam.</p></div><hr><h1>Course Website Not Working. Where is OH today?</h1>
<h3>2018-02-14T22:20:36Z</h3>
<div><p>Thanks.</p></div>
<h2>Student Answer</h2>
<div><p>32-G9</p></div>
<h2>Staff Answer</h2>
<div>Sorry about that. We’re on it. All OH listed on the course website are at G9 lounge. </div>
<h2>Followup</h2>
<div><p>No problem and thanks!</p></div><hr><h1>Exercise 1: Server hangs when overwriting return address</h1>
<h3>2018-02-14T22:15:00Z</h3>
<div><p>When I overwrite the return address of http_request_headers(), the server hangs instead of throwing a Segmentation fault. This occurs even if I overwrite the return address with an invalid value (e.g. 0x41414141). Does anyone know why this might be happening? I was expecting a segmentation fault because the program shouldn&#39;t be able to read from the address, but I was disappointed.</p>
<p></p>
<p>Thanks!</p></div>
<h2>Student Answer</h2>
<div><p>Are you making the sequence such that it is *just* long enough to overwrite the return address? When I did that I also got a infinite loop, because the memory address right after the return address (which corresponds to the &#96;fd&#96; local variable I believe) is overwritten by the null terminator. And in the next loop iteration, &#96;http_read_line&#96; would hang as it is trying to read from a wrong file descriptor (fd=0).</p></div>
<h2>Staff Answer</h2>
<div>Hangs as in your client never sends a response nor does it seg fault?<div><br /></div><div>Make sure your http request is valid (an http request ends with two back to back /r/n characters)</div></div>
<h2>Followup</h2>
<div><p>Thanks Jiahao. It was because the fd variable was overwritten by the null terminator.</p></div>
<h2>Followup</h2>
<div><p>What&#39;s the solution to this? Because url_encode() won&#39;t stop until it finds a null terminator in the src it&#39;s copying from. Is it possible to change the return address without changing the fd argument? Do we have to use the fact that we know fd=4? Because fd wouldn&#39;t always equal 4 if there are multiple requests? Or is that an acceptable exploit that we can hand in?</p></div>
<h3>Followup Response</h3>
<div><p>I guess I can try putting in some large number as the fd to see if I can induce the EBADF error in read(), I just didn&#39;t want to try to  build an exploit in http_request_headers() if it wasn&#39;t gonna work in the end...</p></div>
<h3>Followup Response</h3>
<div><p>Looks like I was able to get the exploit to work!</p>
<p></p></div>
<h2>Followup</h2>
<div><p>What is a best way to solve the issue above about the file descriptor getting overwritten by a null terminator?</p></div>
<h3>Followup Response</h3>
<div><p>Note that you don&#39;t necessarily have to keep &#96;fd&#96; the same value as before. You just need to make it such that a &#96;read&#96; call on the fd does not hang forever (i.e. it can return an error, and it&#39;d be okay for the exploit purpose, etc.) </p></div><hr><h1>Are we supposed to get an automatic response/grade when we turn in labs?</h1>
<h3>2018-02-14T21:33:32Z</h3>
<div><p></p></div>
<h2>Staff Answer</h2>
<div>No. We will manually grade your submissions and you should get your grade in a week or two after you’ve submitted the last part of a lab.<div><br /></div><div>Ie your part 1 and 2 submission of lab 1 won’t be graded until you’ve completed all of lab 1 next week. </div></div><hr><h1>Exercise 3</h1>
<h3>2018-02-14T21:12:46Z</h3>
<div><p>My exploit-3.py passed make check-exstack but when I run it  after ./clean-env.sh ./zookd-exstack 8080 with/without gdb, grades.txt doesn&#39;t get deleted. I&#39;ve already spent a lot time debugging. I&#39;m not sure what could have gone wrong. </p></div>
<h2>Staff Answer</h2>
<div>I’m guessing your shellcode works in isolation (without doing it through the exploit).<div><br /></div><div>Make sure your exploit works with the original shellcode before you test your own shellcode. If your problem persists, I’d suggest coming to OH. I can’t give good specific advice without looking at what you have so far. </div></div><hr><h1>Inserting shellcode into exploit</h1>
<h3>2018-02-14T21:04:45Z</h3>
<div><p>What is located in shellcode.bin? Is the character &lt;8d&gt; the same as &#39;\x8d&#39;? I have been trying to copy paste the contents of shellcode.bin inside a Python string in my exploit, but I get the following errors:</p>
<p></p>
<p>1) with no encoding</p>
<p>SyntaxError: Non-ASCII character &#39;\xc3&#39; in file ./exploit-3.py on line 35, but no encoding declared</p>
<p></p>
<p>2) with the coding specified at the top</p>
<pre># -*- coding: UTF-8 -*- </pre>
<p>UnicodeDecodeError: &#39;ascii&#39; codec can&#39;t decode byte 0xc3 in position 6: ordinal not in range(128)</p>
<p></p>
<pre>3) # -*- coding: UTF-8 -*- </pre>
<p>SyntaxError: UTF-16 stream does not start with BOM</p>
<p></p>
<p>I&#39;m not sure if I&#39;m interpreting the contents of shellcode.bin correctly?</p></div>
<h2>Staff Answer</h2>
<div><p>You could directly use the shellcode variable in exploit.py. If you look towards the bottom of the file, you&#39;ll find that we read in the shellcode.bin file for you and pass it to the build_exploit method</p></div><hr><h1>Exercise 1 Part 1</h1>
<h3>2018-02-14T20:17:40Z</h3>
<div><p>Can we count the same buffer being overflown in two different parts of code as two exploits?</p>
<p></p>
<p>Does overflowing static buffers count as an exploit in this part if we can still crash the server?</p></div>
<h2>Followup</h2>
<div><p>I think &#64;44 has the answer to your first question. </p>
<p></p>
<p>And for the second, maybe ask the question: can we use the exploit to take control of the server (in addition to being able to crash it?)</p>
<p></p></div>
<h3>Followup Response</h3>
<div><p>&#64;44 asks about methods not buffer variables. </p>
<p></p>
<p>Does crashing the server count as an exploit? </p>
<p></p>
<p></p></div>
<h3>Followup Response</h3>
<div>If you can use this vulnerability to hijack control of the server without crashing it by giving a more specific input, yes. But if the best you can do is crash the server, I’d say no. </div>
<h2>Staff Answer</h2>
<div>Look at follow up discussion below. </div><hr><h1>Adding SHELL variable to server&#39;s environment</h1>
<h3>2018-02-14T18:46:24Z</h3>
<div><p>The ./clean-env script doesn&#39;t include the SHELL environment variable. Is it ok if we add this? Is there some other way we should access the address of &#34;/bin/sh&#34;?</p>
<p></p>
<p>Thanks!</p></div>
<h2>Staff Answer</h2>
<div><p>When we do exploitation, we have to choose the way that is possible for us to attack remotely. We shouldn&#39;t be able to change how they start their server i.e. changing the ./clean-env right?<br /><br />I can say that it is possible for you to include the string &#34;/bin/sh&#34; by yourself during the attack. Try to see if you can think of the way you can include and use that :)</p></div><hr><h1>Sending GET request from exploit-template.py</h1>
<h3>2018-02-14T17:31:03Z</h3>
<div><p>I think I&#39;ve figured out which buffer overflows, but I&#39;m having trouble translating that into code in <em>exploit-template.py</em></p>
<p></p>
<p>I have this URL <em>http://ip_address:8080/&lt;exploit-url&gt;</em> which I can open in my browser to make the server return with &#39;<em>Child process 5890 terminated incorrectly, receiving signal 11</em>&#39;. </p>
<p></p>
<p>So my first thought was to replace</p>
<pre>req =   &#34;GET / HTTP/1.0\r\n&#34;</pre>
<p>with</p>
<pre>    req =   &#34;GET /&lt;exploit-url&gt; HTTP/1.0\r\n&#34;</pre>
<p>inside <em>build_exploit(shellcode) </em>in <em>exploit-template.py.</em></p>
<p></p>
<p>However when I run <em>exploit-template.py</em> with this new GET request, the server crashes with this error:</p>
<pre>Traceback (most recent call last):<br /> File &#34;/usr/lib/python2.7/wsgiref/handlers.py&#34;, line 85, in run<br /> self.result = application(self.environ, self.start_response)<br /> File &#34;/usr/lib/python2.7/dist-packages/flask/app.py&#34;, line 1836, in <i>_call_</i><br /> return self.wsgi_app(environ, start_response)<br /> File &#34;/usr/lib/python2.7/dist-packages/flask/app.py&#34;, line 1812, in wsgi_app<br /> ctx = self.request_context(environ)<br /> File &#34;/usr/lib/python2.7/dist-packages/flask/app.py&#34;, line 1773, in request_context<br /> return RequestContext(self, environ)<br /> File &#34;/usr/lib/python2.7/dist-packages/flask/ctx.py&#34;, line 224, in <i>_init_</i><br /> self.url_adapter = app.create_url_adapter(self.request)<br /> File &#34;/usr/lib/python2.7/dist-packages/flask/app.py&#34;, line 1602, in create_url_adapter<br /> server_name=self.config[&#39;SERVER_NAME&#39;])<br /> File &#34;/usr/lib/python2.7/dist-packages/werkzeug/routing.py&#34;, line 1211, in bind_to_environ<br /> if (environ[&#39;wsgi.url_scheme&#39;], environ[&#39;SERVER_PORT&#39;]) not \<br />KeyError: &#39;SERVER_PORT&#39;</pre>
<p></p>
<p>Any pointers?</p>
<p></p></div>
<h2>Staff Answer</h2>
<div>try export SERVER_PORT=8080 for debugging, although that should be already included in the Makefile</div>
<h2>Followup</h2>
<div><p>You meant enter &#39;export SERVER_PORT=8080&#39; in terminal right? It&#39;s still giving me the same error.</p></div>
<h3>Followup Response</h3>
<div><p>For me I solved it by adding a &#34;Host: SOME_RANDOM_NAME:8080&#34; HTTP header to the request.</p></div>
<h3>Followup Response</h3>
<div><p>Tried adding the Host but now I&#39;m returned a response of the form </p>
<p></p>
<pre><code>&lt;!DOCTYPE HTML PUBLIC &#34;-//W3C//DTD HTML 3.2 Final//EN&#34;&gt;<br />&lt;title&gt;Redirecting...&lt;/title&gt;<br />&lt;h1&gt;Redirecting...&lt;/h1&gt;<br />&lt;p&gt;You should be redirected automatically to target URL: &lt;a href=&#34;/zoobar/index.cgi/login?nexturl=SOME_RANDOM_DOMAIN:8080EXPLOIT_URL&#34;&gt;/zoobar/index.cgi/login?nexturl=http://SOME_RANDOM_DOMAIN:8080/EXPLOIT_URL&lt;/a&gt;.  If not click the link</code></pre>
<p>Do I need to take care of the login somehow?</p>
<p></p></div>
<h3>Followup Response</h3>
<div><p>Hmm so this means it got through the http server part without causing a crash for some reason. Did you manually replace the actual exploit url to EXPLOIT_URL in the logs you posted? </p></div>
<h3>Followup Response</h3>
<div><p>Yep. I manually changed the EXPLOIT_URL. </p></div>
<h3>Followup Response</h3>
<div><p>Hmm one theory I can think of is that your EXPLOIT_URL contains some special characters, and when you access it in the browser the browser automatically escapes it, making the actual path sent to the server longer than the case when you manually make the request in the exploit file</p></div><hr><h1>Exercise 2 exploit crashing server but not passing make check-crash</h1>
<h3>2018-02-14T05:39:12Z</h3>
<div><p></p><p>When I run my exploits (two different ones) manually, every single time I get:</p>
<p>Child process 2606 terminated incorrectly, receiving signal 11</p>
<p>Child process 2608 terminated incorrectly, receiving signal 11</p>
<p></p>
<p>However, I still don&#39;t pass either of the checks on make check-crash with either of my exploits.</p>
<p></p>
<p>Is it that the entire process needs to crash or just the child processes? I thought it was just the child processes.</p></div>
<h2>Followup</h2>
<div><p>Would you mind sharing your fix? make check-crash is telling me &#34;permission denied&#34; for both of my exploit files and I&#39;m not sure how to solve this.</p></div>
<h3>Followup Response</h3>
<div><p>&#64;60</p></div><hr><h1>help with sshfs</h1>
<h3>2018-02-14T03:47:39Z</h3>
<div><p>I know that this is how you tunnel to sublime:</p>
<p></p>
<p>sshfs remote_user&#64;remote_host:remote_dir/ local_dir</p>
<p></p>
<p>but I&#39;m not sure what to put in for the various names of this command. The VM I am using is at </p>
<p> <a href="mailto:httpd&#64;192.168.248.128">httpd&#64;192.168.248.128</a>. Is this the remote_user and remote host? If so, what is the remote_dir? Does anyone know?</p></div>
<h2>Staff Answer</h2>
<div>Should be where the lab files are inside the vm, whichever ones you want to edit on sublime. You’ll basically be mounting that directory over some local directory.</div>
<h2>Student Answer</h2>
<div><p>For example, if you have:</p>
<ul><li><tt>~/6.858/lab</tt> on your host machine (laptop)</li><li><tt>/home/httpd/lab</tt> on your VM</li><li><tt>192.168.248.128</tt> as your VM&#39;s IP</li></ul>
<p></p>
<p>Then, assuming you&#39;ve installed the relevant packages, you can sync the above directories with: <tt>sshfs httpd&#64;192.168.248.128:/home/httpd/lab ~/6.858/lab</tt></p>
<p></p>
<p>Also, make sure the directory already exists on your laptop (e.g. with <tt>mkdir ~/6.858/lab</tt>).</p>
<p></p>
<p>Hope that helps!</p></div><hr><h1>Browser not loading site</h1>
<h3>2018-02-14T03:06:23Z</h3>
<div><p>I&#39;ve crashed the server with some input. I&#39;ve rebooted it and am able to send commands to the server and receive responses in the terminal. However, I am unable to load the website locally in a browser. I don&#39;t know what&#39;s going wrong.</p></div>
<h2>Staff Answer</h2>
<div>Is the terminal logging the request? What error are you getting your browser. It’s a little difficult to give an answer without more details. </div>
<h2>Followup</h2>
<div><p>The part about terminated child processes (at the bottom) appears when I try to load the page locally.</p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/hlmw7ncksqb1mz/jdmi1anu5mus/Screen_Shot_20180213_at_10.10.09_PM.png" alt="" /></p>
<p></p></div>
<h3>Followup Response</h3>
<div>Are you making requests from your browser that would cause a buffer overflow?</div>
<h3>Followup Response</h3>
<div><p>Yes</p></div>
<h3>Followup Response</h3>
<div><p>Then, you&#39;re good. You&#39;re getting expected behaviour because every request you make is causing a buffer overflow which you are recording correctly on your server and also as a result your browser  doesn&#39;t get a response either.</p></div>
<h3>Followup Response</h3>
<div><p>The browser still doesn&#39;t work after killing the server process and starting the server up again with </p>
<pre>./clean-env.sh ./zookd-exstack 8080 &amp;</pre></div>
<h3>Followup Response</h3>
<div><p>But sending a basic command using the python exploit-template code is sent and succesfully responded to by the server.</p></div>
<h3>Followup Response</h3>
<div><p>What request are you making from the browser? Does it still not give you anything if you request localhost:8080?</p>
<p></p>
<p></p></div><hr><h1>Disable Buffer Overflow Detection</h1>
<h3>2018-02-14T01:52:51Z</h3>
<div><p>I was following the <a href="https://www.youtube.com/watch?v=8-eB-2YlXC8" target="_blank">tutorial</a>, and when I run the command in the provided VM,</p>
<p></p>
<pre>env - badcat badcat.c -fno-stack-protector</pre>
<p>the output is</p>
<p></p>
<pre>*** stack smashing detected ***: badcat terminated</pre>
<p>How do I disable this feature so I can practice performing buffer overflows?</p></div>
<h2>Staff Answer</h2>
<div>I believe the ./clean-env.sh script should reset your system back to the correct configurations. I’m not certain about this. Please let me know if that’s not the case. </div><hr><h1>Why are the variable names in the c files so bad, and how to make sense of them? eom</h1>
<h3>2018-02-14T00:38:49Z</h3>
<div><p></p></div>
<h2>Staff Answer</h2>
<div>Sorry about that. I’d recommend going slowly line by line and jot down comments to note down what each part is doing.<div><br /></div><div>At the end of the day, this is an example of a vulnerable system caused by bad programming practices. So it’s sort of inevitable that there will be obfuscate code that’s a little hard to follow. </div></div>
<h2>Student Answer</h2>
<div><p>I started off just reading http.c in order from top to bottom, but I found it easier to understand what was happening when I tried to go in order of code execution when you run the web server instead. I.e. starting in zookd.c with beginning the server and processing each client, then following the function calls as the client request is handled. This way you know what is being passed in to each function because you&#39;re aware of the context it was called from. (I also skipped sections that clearly wouldn&#39;t have to do with a buffer overflow)</p></div><hr><h1>Vulnerable method</h1>
<h3>2018-02-14T00:09:19Z</h3>
<div><p>Hi! If one particular method is vulnerable to buffer overflows in http.c, are we allowed to count every time it is called as a vulnerability?</p></div>
<h2>Staff Answer</h2>
<div>I believe we count the buffers overflown not the functions called, so you should be good. Otherwise all attacks are gets()’s fault so we would have to count all attacks on gets() as 1.</div>
<h2>Followup</h2>
<div><p>What should we do if taking this approach means we list multiple bugs as occurring on the same line? It&#39;s causing me to fail &#39;make check-bugs.&#39;</p></div>
<h3>Followup Response</h3>
<div>If you’re convinced that two separate bugs are happening due to the same line and just want the make check-bugs tool to succeed, you can just offset the line by one for each bug. We read these manually anyway so you should be okay. </div><hr><h1>Are buffers still vulnerable if they&#39;re not on the stack?</h1>
<h3>2018-02-13T23:38:02Z</h3>
<div><p>If a buffer is a static variable for example, it&#39;s not on the stack so overflowing it won&#39;t change the return address. Is it still vulnerable to buffer overflow attacks? If so, how?</p></div>
<h2>Staff Answer</h2>
<div>Correct, static variables don’t live in the stack, I believe they live in a region called BSS if they are not initialized. So there’s not much overflowing you can do to take over the return pointer.</div>
<h2>Followup</h2>
<div><p>You couldn&#39;t take over the return pointer, but you could theoretically overwrite other static variables, correct? Depending on what static variables exist, that could at least cause your program to give the wrong output, even if arbitrary code execution wasn&#39;t possible (unless perhaps the address of a function to be executed later was stored statically?). Should we still list such things as overflows (in terms of completing the first exercise) or restrict ourselves to potential <em>stack</em> buffer overflows?</p></div>
<h3>Followup Response</h3>
<div>You’re right in that after taking charge of the control flow you can edit any part of the program’s virtual memory. That includes constants, globals, stack and even the program itself! Although these kinds of attacks are a bit beyond the point of this lab.<p></p><p></p></div><hr><h1>Stack Canaries</h1>
<h3>2018-02-13T23:29:44Z</h3>
<div>Can we have some tips for determining whether stack canaries would mitigate a buffer overflow attack?</div>
<h2>Staff Answer</h2>
<div>They do most of the time, assuming the attacker cannot read the canary value at runtime or predict it.</div>
<h2>Student Answer</h2>
<div><p>A stack canary will (generally) detect if you change the return address from the function (subject to the assumptions in Lef&#39;s response). It won&#39;t help if you&#39;re able to gain control of execution in another way than changing the return address.</p></div><hr><h1>Is the first exam during lecture or in the evening?</h1>
<h3>2018-02-13T19:55:50Z</h3>
<div><p></p></div>
<h2>Staff Answer</h2>
<div><p>During class.</p></div><hr><h1>Location of vulnerabilities</h1>
<h3>2018-02-13T18:35:01Z</h3>
<div><p>To make sure, are we supposed to find vulnerabilities only in zookd.c and http.c? Or are there other places to look for? </p></div>
<h2>Staff Answer</h2>
<div>The bugs happen during http request processing. If there are other components of this system that are involved, you should check those as well. Try to look at the entry point of the program, main() in zookd.c and trace which files should matter. </div><hr><h1>interpreting info frame</h1>
<h3>2018-02-13T16:53:22Z</h3>
<div><p>When I run &#96;info frame&#96; in gdb in the middle of a function, I get an output that looks something like this (addresses are changed but distances roughly preserved):</p>
<pre>(gdb) info frame<br />Stack level 0, frame at 0xbffff688:<br /> eip = 0x888889c in ...; saved eip = 0x8888888<br /> ...<br /> source language c.<br /> Arglist at 0xbffff678, args: fd=4<br /> Locals at 0xbffff678, Previous frame&#39;s sp is 0xbffff680<br /> Saved registers:
  ebp at 0xbffff678, eip at 0xbffff67c<br /> ...</pre>
<p></p>
<p>What I don&#39;t get is why argslist and locals are listed at the same address when neither of them actually appear to start there. When I print out the range of addresses near the top of the stack frame, I see that the saved ebp is actually at address &#96;0xbffff678&#96; and the saved eip is at &#96;0xbffff67c&#96; as described, but the argslist is actually at &#96;0xbffff680&#96;. Am I interpreting the &#34;Argslist at&#34; and &#34;Locals at&#34; lines incorrectly?</p></div>
<h2>Staff Answer</h2>
<div>Looks right to me, ebp at f678 so that’s where the function stack frame begins and the next word (8 bytes) is f680 (=f678 &#43; 8 in Hex base) which are the arguments to that function.</div><hr><h1>Running gdb</h1>
<h3>2018-02-13T02:26:41Z</h3>
<div><p>I got the following error when running gdb -p $(pgrep zookd-exstack):</p>
<p></p>
<p>gdb: option &#39;--p&#39; requires an argument<br />Use &#96;gdb --help&#39; for a complete list of options.</p>
<p></p>
<p>I&#39;m not sure why that is. Is this command different from gdb zookd-exstack?</p></div>
<h2>Staff Answer</h2>
<div><p>Have you started the server already? Remember to start the server with the following command before running gdb</p>
<pre>./clean-env.sh ./zookd-exstack 8080 &amp;</pre>
<p></p>
<p>What is the output you see when you run &#96;pgrep zookd-exstack&#96; alone? </p>
<p></p></div><hr><h1>Can&#39;t access local site anymore</h1>
<h3>2018-02-12T22:18:59Z</h3>
<div><p>I pasted in a bunch of &#34;A&#34;&#39;s into the username and password inputs and registered it to see what would happen. Now I can&#39;t access the site locally anymore. I tried deleting the lab and recloning but it still isn&#39;t working. I also tried using a different port. Any ideas on how to fix it? </p></div>
<h2>Staff Answer</h2>
<div><p>What is the error it gave you in the server side?</p></div>
<h2>Student Answer</h2>
<div><p>I fixed it by just clearing my history</p></div><hr><h1>Cannot connect to website running on vm</h1>
<h3>2018-02-12T21:55:08Z</h3>
<div><p>I use a mac, and I installed VMWare Fusion as per the instructions on the pset. However, when I run </p>
<pre>./clean-env.sh ./zookd 8080</pre>
<p>and then try to access the web page through the browser, the request times out after a few minutes without ever loading the page. </p>
<p></p>
<p>I double checked that I am using the IP address. Any idea what could be going on?</p>
<p></p>
<p>Thanks!</p></div>
<h2>Staff Answer</h2>
<div><p>Hmm Can&#39;t think of the issue related to the server off the top of my head.<br />Have you specify the port number in the browser ? ex. http://&lt;ip_address&gt;:8080<br />If yes, what is the output from that command you run? It should be &#96;exec env - PWD=/home/httpd/lab SHLVL=0 ./zookd 8080&#96; and running for longggg time as long as you not kill it.</p></div>
<h2>Followup</h2>
<div><p>I had a vpn running on my computer, and when I turned the vpn off, I was able to connect!!!</p>
<p>Not sure why the vpn was interfering... </p></div>
<h3>Followup Response</h3>
<div><p>That makes sense now. VPN if set as full tunnel will block other connections including connection to VM.</p></div><hr><h1>Exc 3 :: Encoding an addr into an URL</h1>
<h3>2018-02-12T21:05:14Z</h3>
<div><p>Hello,</p>
<p></p>
<p>can you advise please on how to properly encode an address, which I&#39;d like to place in $eip, into an URL?</p>
<p></p>
<p>E.g. If I&#39;d like to put 0xbffff18c in $eip, I reasonably add &#34;%8c%f1%ff%bf&#34; into an URL, but the web server transforms it into 0xbffff198 and it&#39;s not something I want. </p>
<p></p>
<p>URL encoding guidelines didn&#39;t help much, so I think I just miss or don&#39;t know something.</p>
<p></p>
<p>Thanks for your help</p></div>
<h2>Staff Answer</h2>
<div><p>Fortunately, the guideline is already in the comment of that exploit-template.py :) Check those comments and see if you still need help </p></div><hr><h1>Part 1. Exercise 1.</h1>
<h3>2018-02-12T17:31:36Z</h3>
<div><p>My plan is to structure some HTML that will crash the server. From there I can GDB and find where the vulnerabilities. I read the article about HTML in the assignment, but I&#39;m lost on how to go about creating an exploit in HTML form as suggested in exploit-template.py. I&#39;m unsure of how to proceed here.</p></div>
<h2>Staff Answer</h2>
<div><p>Hmmm. I suggest choosing the vulnerability that is easier to exploit, especially when you have hard time understanding and doing the one you choose.  ex. using GET HTTP request.<br /><br />However, if you still want to exploit HTML form using POST request, this is concise reference that you may find helpful  <a href="https://www.w3schools.com/tags/ref_httpmethods.asp">https://www.w3schools.com/tags/ref_httpmethods.asp<br /></a></p></div><hr><h1>Exercise 2</h1>
<h3>2018-02-12T08:15:06Z</h3>
<div><p>&#34;[...] the second <em>must</em> overwrite some other data structure that you will use to take over the control flow of the program&#34;</p>
<p></p>
<p>What does it mean by &#34;to take over the control flow&#34;? Maybe I have not found all the right vulnerabilities, I am not sure how to make the program crash without overwriting the return address. </p></div>
<h2>Staff Answer</h2>
<div><p>&#34;Take over the control flow&#34; means you can modify some thing so that the execution path of the program change. <br />Return address is not the only value you can modify with buffer overflow.<br />Think about what else on the stack can you modify using buffer overflow and look carefully through the c code and functions that include the buffer that you found in exercise 1. <br /><br />Since this is part of the challenge, I&#39;m aware of spoiling the answer. I&#39;m pretty sure you can figure out by observation and hint above, but please feel free to ask us again for help if you still need one :)</p></div><hr><h1>received signal SIGTTIN, Stopped (tty input)</h1>
<h3>2018-02-12T05:26:21Z</h3>
<div><p>I&#39;m getting a strange error while trying to get my exploit to work in exercise 3. The server reads the first line of headers, including the terminating \r\n, but when it reads the first character of the next line (which should just be &#34;\r&#34; since the line is &#34;\r\n&#34;), the server crashes with the message:</p>
<p>&#39;Thread 2.1 &#34;zookd-exstack&#34; received signal SIGTTIN, Stopped (tty input).&#39;</p>
<p></p>
<p>I don&#39;t understand how the server should ever receive this signal, but I&#39;m especially confused about why it happens during a read() syscall.</p>
<p></p>
<p>Is it possible that this is related to using tmux? Or am I doing something obviously wrong?</p></div>
<h2>Staff Answer</h2>
<div><p>If you suspect that tmux could be the problem, could you try ssh two different terminals instead of tmux.<br />If it still have problem, I think it could relate to the way you currently exploit it. My question for you is &#34;does the exploit-template.py work correctly if you don&#39;t modify anything?&#34;</p></div>
<h2>Followup</h2>
<div><p>I&#39;ve discovered that I&#39;m overwriting my file descriptor (I think). The first call from http_request_headers into http_read_line works fine and enters with fd=4, but then when it exists and is called again, it gets called with fd=0. I&#39;m assuming it shouldn&#39;t have changed-- and this is why I was getting an error that thought I was attempting to read from the terminal.</p>
<p></p>
<p>Any advice on how to proceed from here?</p></div>
<h3>Followup Response</h3>
<div><p>Nevermind-- realized I was writing a null byte somewhere I hadn&#39;t considered!</p></div><hr><h1>Submission Error</h1>
<h3>2018-02-12T01:07:11Z</h3>
<div>Hi, I get an error when I try to submit my reading assignment on the website (similar to the one posted on piazza before, but slightly different):

&#34;too late: the deadline has passed. It is 01-01-2000 00:00:00

Please contact 6.858-staff&#64;pdos.csail.mit.edu if you think it is not an error. Please include this error message in your email.&#34;

Do you have any ideas as to how I could resolve this?</div>
<h2>Staff Answer</h2>
<div><p>My guess is you&#39;re submitting a filename that doesn&#39;t correspond to one of the lectures that the submission web site knows about.</p></div><hr><h1>Static variable as function argument on stack?</h1>
<h3>2018-02-11T23:42:30Z</h3>
<div><p>If a static variable is an argument for a function call in C, does it get pushed onto the stack? For example in zookd.c lines 103-109 includes the following code:</p>
<p></p>
<pre>static char env[8192];  /* static variables are not on the stack */
static size_t env_len;

/* get the request line */
if ((errmsg = http_request_line(fd, reqpath, env, &amp;env_len)))</pre>
<p>In this case, does env get pushed onto the stack, and can it possibly be overflowed due to a buffer overflow?</p></div>
<h2>Student Answer</h2>
<div><p>I believe static variables are placed directly in the binary, so you can overflow them but can&#39;t get access to a return address by doing so.</p></div>
<h2>Staff Answer</h2>
<div><p>^ Exactly! Pointer on the stack, but static variables will be on data segment (BSS specifically) at very very low address. </p></div>
<h2>Followup</h2>
<div><p>There&#39;s some misinformation here. You do not push pointers to static variables. The stack has pointers only because <code>env</code> is an array (basically a pointer) and the last parameter is actually a pointer to a static variable. Those are still copies of the values (which happen to be addresses). If you pass in an <code>int</code> argument that is a static variable, it should be clear that values instead of pointers are being pushed to stack.</p></div>
<h3>Followup Response</h3>
<div><p>I am confused; what is getting pushed onto the stack for this call to http_request_line? Do all 8192 byes of env get pushed on, or just the pointer? What about for reqpath, since that&#39;s not static?</p></div>
<h3>Followup Response</h3>
<div><p>The value of an array is the address of the first element. So only that address gets pushed.</p></div>
<h3>Followup Response</h3>
<div><p>Regarding reqpath, I have no idea what that is. But if it&#39;s a string, it&#39;s probably a pointer as well.</p></div><hr><h1>Exc 2 :: how to check?</h1>
<h3>2018-02-11T21:26:41Z</h3>
<div><p>Hello,</p>
<p></p>
<p>does getting &#34;pass&#34; as the results of </p>
<pre>httpd&#64;vm-6858:~/lab$ make check-crash</pre>
<p>mean that the exploits <tt>exploit-2a.py</tt> and <tt>exploit-2b.py are correct? </tt></p>
<p></p>
<p>Thanks </p></div>
<h2>Staff Answer</h2>
<div><p>That&#39;s right, it means that the server crashed which is what we want in this particular one.</p></div><hr><h1>Exploit works when ran with gdb, but not without</h1>
<h3>2018-02-11T20:11:09Z</h3>
<div><p>I&#39;ve found that my exploit for part 3 of the lab is not working when I run the web server normally, but it works perfectly when I run the web server within gdb. These are the commands I&#39;m using, and output I&#39;m getting:</p>
<p></p>
<p>Without gdb:</p>
<pre>./clean-env.sh ./zookd-exstack 8080
exec env - PWD=/home/httpd/lab SHLVL=0 ./zookd-exstack 8080
Child process 17773 terminated incorrectly, receiving signal 11</pre>
<p>With gdb:</p>
<pre>./clean-env.sh gdb ./zookd-exstack<br />/* ... */<br />(gdb) set follow-fork-mode child
(gdb) r 8080
Starting program: /home/httpd/lab/zookd-exstack 8080
[New process 17785]
[Inferior 2 (process 17785) exited normally]</pre>
<p>In both cases, in a separate terminal window, I ran &#34;./exploit-3.py localhost 8080&#34;. It is found that with gdb, grades.txt is removed, but not without gdb. Additionally, if I&#39;m interpreting this output right, it appears that the child processes aren&#39;t even exiting in the same way. The &#34;normal&#34; exit is expected, as my shellcode makes a call to exit(). Also, it&#39;s worth saying that the shellcode works as expected when ran with ./run-shellcode.</p>
<p></p>
<p>Is there anything that might cause the two executions to diverge in this way?</p></div>
<h2>Staff Answer</h2>
<div><p>I can confirm that actual exploitation work both remotely and in gdb. <br />Based on info you gave me, my assumption is that this line &#96;./clean-env.sh gdb ./zookd-exstack&#96; can cause clean-env to behave differently if you do on gdb rather than clean env on actual program -&gt; which is what we want to avoid changing stack address.</p>
<p></p>
<p><br />Try both commands separately?</p>
<pre>./clean-env.sh ./zookd-exstack 8080
gdb -p $(pgrep zookd-exstack) <br /></pre>
<p></p></div>
<h2>Followup</h2>
<div><p>This worked. The addresses of buffers were slightly different when running &#96;./clean-env.sh gdb ./zookd-exstack&#96;. Thank you!</p></div>
<h3>Followup Response</h3>
<div><p>You&#39;re welcome :) Nice job finishing early!</p></div><hr><h1>What&#39;s a &#34;subsection&#34; for the lecture 2 reading?</h1>
<h3>2018-02-11T19:36:11Z</h3>
<div><p>The reading question for Lecture 2 says to list approximately 1 possible attack per subsection of the paper. This might be a dumb question but what are you considering a subsection of the paper? Like would &#34;Secure Low Level Infrastructure&#34; be a subsection or would &#34;Security of Physical Premises&#34; be a subsection?</p></div>
<h2>Staff Answer</h2>
<div><p>I meant &#34;subsection&#34; to refer to &#34;Security of Physical Premises&#34; and not &#34;Secure Low Level Infrastructure&#34;.</p></div><hr><h1>Cannot Find a Valid Peer Process to Connect To</h1>
<h3>2018-02-11T17:08:16Z</h3>
<div><p>I&#39;m running VMWare Fusion on my Mac and when I try importing the VM it shows the following error. Is this happening for other mac users?</p></div>
<h2>Staff Answer</h2>
<div>Yikes, I don’t think I’ve had this error before. I did google it though, this guy seems to say it’s a security permission issue on OSX (<a href="https://superuser.com/a/1258547">https://superuser.com/a/1258547</a>) so maybe you didn’t allow VMware fusion to access system stuff when you installed it would be my best guess.</div>
<h2>Followup</h2>
<div><p>Yeah, I looked into this bug, and I allowed VMWare permission to access my privacy, as shown in screenshot below. Error still persists tho, maybe it&#39;s the way I&#39;m loading my vmx file?</p>
<p></p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/ik5q2hxqs8k7ji/jdj76tzgw90e/Screen_Shot_20180211_at_2.42.23_PM.png" alt="" /></p>
<p></p>
<p>Hope to hear back; are office hours open yet?</p>
<p></p>
<p></p></div>
<h3>Followup Response</h3>
<div><p>I don&#39;t think you need to import anything. <br />Try close the VMware and double click the .vmx file to open it and see if it solves your problem. <br />Office hours open since last week. The schedule can be found here http://css.csail.mit.edu/6.858/2018/general.html</p></div>
<h3>Followup Response</h3>
<div><p>I&#39;m also running Fusion on my Mac and getting the same problem, have tried redownloading the .vmx file and reopening but it still doesn&#39;t work. Gonna try to reinstall VMware and see if that does it.</p></div>
<h3>Followup Response</h3>
<div><p>Alright I figured it out. If you go to the &#34;General&#34; tab under in the &#34;Security &amp; Privacy&#34; section of the Mac System Preferences, the lower area of the window should have a warning saying something along the lines of &#34;VMware wanted to download additional material but was stopped&#34;. That warning text will have an &#34;Allow&#34; button next to it. Click the button. You should then be good to go.</p>
<p></p>
<p>Hope this helps</p></div>
<h3>Followup Response</h3>
<div><p>Having the same problem, and there is no warning message nor &#34;Allow&#34; button in the &#34;General&#34; tab.</p>
<p>I turned to VirtualBox, but for some reason it&#39;s not very stable.</p></div><hr><h1>final group project dropdown</h1>
<h3>2018-02-11T05:27:13Z</h3>
<div><p>When I went to lecture there seemed to be ~200 people (the seats were all filled, and people were sitting in the back and aisles), and there are 142 students on Piazza, but yet the selection for final project group only contains 22 entries (including me). Does this mean that we can only partner with a small subset of the class? Or are so few people actually registered in the class?</p></div>
<h2>Student Answer</h2>
<div><p>It may be that people are only added to that list after the first time that they use their certificates to sign in to the submission page. I suspect this is the case because, when I went to that page a couple of days ago, while things were still configured from last year, the dropdown showed people already in teams (from 2017), but my name was also present. I&#39;m sure that you won&#39;t be limited to a random 20 students as potential project partners.</p></div><hr><h1>gdb error</h1>
<h3>2018-02-11T04:34:42Z</h3>
<div><p>I&#39;m trying to use gdb to figure out when my program crashes when I try to buffer overflow, but when I try to continue to the next breakpoint I&#39;m getting this error:</p>
<p></p>
<p>Error in re-setting breakpoint 1: No source file named http.c.</p>
<p></p>
<p>What does this mean and how do I use gdb to figure out what line causes the program to crash?</p></div>
<h2>Staff Answer</h2>
<div><p>Once the program terminate you cannot observe the stack, register or any details from runtime aspect in gdb. <br />My advice is to insert breakpoint to the line before you expect the crash so that you can observe those runtime stuffs before it actually terminate. Try to see if you can understand the flow of your exploitation and experiment with your breakpoints. <br /><br />Also, I&#39;m not sure why you have these error.</p>
<p>Error in re-setting breakpoint 1: No source file named http.c.</p>
<p>Error in re-setting breakpoint 2: No source file named http.c.</p>
<p>Error in re-setting breakpoint 3: No source file named http.c.<br />What is the command you use to insert the breakpoint?</p></div>
<h2>Followup</h2>
<div><p>I get the same error- using this command:</p>
<p></p>
<p>break http.c:55</p>
<p></p>
<p></p></div>
<h3>Followup Response</h3>
<div><p>Can you dump the whole commands and result you use since the very first command to open gdb from shell?</p></div>
<h3>Followup Response</h3>
<div><p>httpd&#64;vm-6858:~/lab$ gdb -p $(pgrep zoo)<br />GNU gdb (Ubuntu 7.11.1-0ubuntu1~16.04) 7.11.1<br />Copyright (C) 2016 Free Software Foundation, Inc.<br />License GPLv3&#43;: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;<br />This is free software: you are free to change and redistribute it.<br />There is NO WARRANTY, to the extent permitted by law. Type &#34;show copying&#34;<br />and &#34;show warranty&#34; for details.<br />This GDB was configured as &#34;i686-linux-gnu&#34;.<br />Type &#34;show configuration&#34; for configuration details.<br />For bug reporting instructions, please see:<br />&lt;http://www.gnu.org/software/gdb/bugs/&gt;.<br />Find the GDB manual and other documentation resources online at:<br />&lt;http://www.gnu.org/software/gdb/documentation/&gt;.<br />For help, type &#34;help&#34;.<br />Type &#34;apropos word&#34; to search for commands related to &#34;word&#34;.<br />Attaching to process 19290<br />Reading symbols from /home/httpd/lab/zookd-exstack...done.<br />Reading symbols from /lib/i386-linux-gnu/libc.so.6...Reading symbols from /usr/lib/debug//lib/i386-linux-gnu/libc-2.23.so...done.<br />done.<br />Reading symbols from /lib/ld-linux.so.2...Reading symbols from /usr/lib/debug//lib/i386-linux-gnu/ld-2.23.so...done.<br />done.<br />0x40027c31 in __kernel_vsyscall ()<br />(gdb) break http.c:55<br />Breakpoint 1 at 0x80491cd: file http.c, line 55.<br />(gdb) c<br />Continuing.<br />[New process 19324]<br />[New process 19325]<br />process 19325 is executing new program: /usr/bin/env<br />Error in re-setting breakpoint 1: No source file named http.c.<br />process 19325 is executing new program: /usr/bin/python2.7<br />[Thread debugging using libthread_db enabled]<br />Using host libthread_db library &#34;/lib/i386-linux-gnu/libthread_db.so.1&#34;.<br />[New process 19326]<br />[Thread debugging using libthread_db enabled]<br />Using host libthread_db library &#34;/lib/i386-linux-gnu/libthread_db.so.1&#34;.<br />process 19326 is executing new program: /bin/dash<br />[New process 19327]<br />process 19327 is executing new program: /bin/dash<br />process 19327 is executing new program: /sbin/ldconfig.real<br />[Inferior 5 (process 19327) exited with code 01]<br />(gdb)</p></div>
<h3>Followup Response</h3>
<div><p>Ah I see. <br />It seems like GDB doesn&#39;t found your file http.c because it follow the new process 19325, which no longer the zookd-exstack binary but is /usr/bin/env. <br />Can you try &#34;set follow-fork-mode child&#34; and see if it solve your problem?</p></div>
<h3>Followup Response</h3>
<div><p>you might also want to try </p>
<pre> gdb -p $(pgrep zookd-exstack)</pre>
<p>as per the lab handout. This is in case there are more than one process id that matches &#39;zoo&#39;, pgrep on &#39;zookd-exstack&#39; will be more specific</p></div>
<h3>Followup Response</h3>
<div><p>Thanks for the suggestions! Still no luck though- I&#39;ve pasted what I inputted below:</p>
<p></p>
<p>httpd&#64;vm-6858:~/lab$ gdb -p $(pgrep zookd-exstack)<br />GNU gdb (Ubuntu 7.11.1-0ubuntu1~16.04) 7.11.1<br />Copyright (C) 2016 Free Software Foundation, Inc.<br />License GPLv3&#43;: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;<br />This is free software: you are free to change and redistribute it.<br />There is NO WARRANTY, to the extent permitted by law. Type &#34;show copying&#34;<br />and &#34;show warranty&#34; for details.<br />This GDB was configured as &#34;i686-linux-gnu&#34;.<br />Type &#34;show configuration&#34; for configuration details.<br />For bug reporting instructions, please see:<br />&lt;http://www.gnu.org/software/gdb/bugs/&gt;.<br />Find the GDB manual and other documentation resources online at:<br />&lt;http://www.gnu.org/software/gdb/documentation/&gt;.<br />For help, type &#34;help&#34;.<br />Type &#34;apropos word&#34; to search for commands related to &#34;word&#34;.<br />Attaching to process 26784<br />Reading symbols from /home/httpd/lab/zookd-exstack...done.<br />Reading symbols from /lib/i386-linux-gnu/libc.so.6...Reading symbols from /usr/lib/debug//lib/i386-linux-gnu/libc-2.23.so...done.<br />done.<br />Reading symbols from /lib/ld-linux.so.2...Reading symbols from /usr/lib/debug//lib/i386-linux-gnu/ld-2.23.so...done.<br />done.<br />0x40027c31 in __kernel_vsyscall ()<br />(gdb) set follow-fork-mode child<br />(gdb) break http.c:55<br />Breakpoint 1 at 0x80491cd: file http.c, line 55.<br />(gdb) c<br />Continuing.<br />[New process 26818]<br />[New process 26819]<br />process 26819 is executing new program: /usr/bin/env<br />Error in re-setting breakpoint 1: No source file named http.c.<br />process 26819 is executing new program: /usr/bin/python2.7<br />[Thread debugging using libthread_db enabled]<br />Using host libthread_db library &#34;/lib/i386-linux-gnu/libthread_db.so.1&#34;.<br />[New process 26820]<br />[Thread debugging using libthread_db enabled]<br />Using host libthread_db library &#34;/lib/i386-linux-gnu/libthread_db.so.1&#34;.<br />process 26820 is executing new program: /bin/dash<br />[New process 26821]<br />process 26821 is executing new program: /bin/dash<br />process 26821 is executing new program: /sbin/ldconfig.real<br />[Inferior 5 (process 26821) exited with code 01]</p></div>
<h3>Followup Response</h3>
<div><p>I would say this problem is better solving in OH because we may need to interact and observe other behavior, such as how you exploit and cause that issue. You can also tried to explain in private Piazza post what you do to exploit and maybe we can understand why this issue happen :)</p></div><hr><h1>Quizzes: Open note as well?</h1>
<h3>2018-02-10T23:50:59Z</h3>
<div><p>I noticed that the quizzes are open laptop -- are they also open note / open book (as in, could we bring in a notebook? I prefer taking notes by hand vs. on my laptop). Thanks!</p></div>
<h2>Staff Answer</h2>
<div><p>Yes based on my experience last year, but let&#39;s wait for confirmation from our professors. </p></div><hr><h1>Lab 1 :: bugs.txt format</h1>
<h3>2018-02-10T21:27:35Z</h3>
<div><p>Hello,</p>
<p></p>
<p>please advise on the format of bugs.txt. </p>
<p>1. What specific line of code I should refer to in [file:#lines]? Should I just put the number of a line which actually leads to overflow of a buffer or all related lines should be listed to.</p>
<p>2. The same question is about &lt;paste offending line(s) of code here&gt;</p>
<p></p>
<p>Thank you</p>
<p></p></div>
<h2>Staff Answer</h2>
<div><p>1. Yes. only the line number that actually leads to buffer overflow.<br />2. Pasting multiple lines is ok. Sometimes, this helps reader understand the context and save their time going back and forth referencing among multiple files. Let&#39;s keep it no more than ten lines of code each. Also, keep in mind that a chunk of code can&#39;t substitute your description/explanation for full credit :)</p></div>
<h2>Followup</h2>
<div><p>Can you clarify what &#34;leads to buffer overflow&#34; means? If we have two different failure paths from the same line of code that writes to a buffer, are those distinct?</p></div>
<h3>Followup Response</h3>
<div><p>&#34;leads to buffer overflow&#34; = the line that the buffer get overflow suddenly after you finish that line.<br />Let&#39;s say you found a line &#34;gets(buff);&#34; in http.c:1090 and another &#34;gets(buff)&#34; from http.c:3345 that both could lead to buffer overflow on buff that will be count as different vulnerabilities :) <br /><br />Both are valid even if you overflow on the same buffer because from the developer and tester perspective, having any of those lines in your program expose you to the attack.</p></div>
<h2>Followup</h2>
<div><p>Also, is it okay to add comments to the files? This would change the line numbers from the original but would help me keep track of what&#39;s going on...</p></div>
<h3>Followup Response</h3>
<div><p>I don&#39;t think this will make any different as long as you don&#39;t insert other instructions which might affect the stack layout since the compiler and optimization can be hard to predict. <br /><br />However, I suggest you have a copy of original file and reverify that your exploit work before submission both to prevent unknown behavior and avoid your own mistake inserting some debugging instruction like printf(). </p></div>
<h3>Followup Response</h3>
<div><p>Oh another important point is when answering the question, use the line number of original code not the line number after you comments. That&#39;s why it is better to keep a copy. </p></div><hr><h1>CPU doesn&#39;t support KVM extensions?</h1>
<h3>2018-02-10T20:08:20Z</h3>
<div><p>It seems like I have successfully installed KVM, but when I run <tt>kvm-ok</tt> I get this:</p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/hl4850l4upo6ci/jdhskkk387c0/Screen_Shot_20180210_at_3.01.29_PM.png" alt="" width="525" height="100" /></p>
<p></p>
<p>Any ideas on why it says my CPU doesn&#39;t support KVM/how to get around this?</p></div>
<h2>Student Answer</h2>
<div>Looks like your computer&#39;s hardware doesn&#39;t support kvm...maybe use an Athena machine?</div>
<h2>Staff Answer</h2>
<div>Or use a software accelerated VMM like virtual box or VMware, these don’t need hardware support.</div>
<h2>Followup</h2>
<div><p>It seems to me like you run kvm-ok inside the 6.858 VM rather than in your local machine. Moreover, you don&#39;t have to do that since you successfully connect to your VM as shown in your image (I believe via VMware?). kvm-ok is for linux user who want to use kvm to access to the 6.858vm instead of using VMware.</p></div><hr><h1>Copy past in VM</h1>
<h3>2018-02-10T20:02:25Z</h3>
<div><p>Is anyone else having issues with copy/pasting inside your VM? I&#39;ve tried installing open-vm-tools and open-vm-tools-desktop but it still doesn&#39;t work.</p></div>
<h2>Staff Answer</h2>
<div><p>from your local machine terminal &#96;ssh httpd&#64;&lt;ip_address&gt;&#96;  and then you should be able to copy pasting normally as you can do in your local terminal.</p></div><hr><h1>Solution to Linux: &#39;kvm&#39; is currently not installed.</h1>
<h3>2018-02-10T06:07:06Z</h3>
<div><p>Reminder: you can use your own any Linux, Mac, Window machine, but ssh to Athena won&#39;t work -&gt; have to go to Athena cluster if you want to use Athena machine.<br /><br />For Linux users who got the error from KVM </p>
<p></p>
<pre>The program &#39;kvm&#39; is currently not installed. You can install it by typing:<br />sudo apt install qemu-kvm</pre>
<p>or</p>
<pre>Could not access KVM kernel module: No such file or directory
failed to initialize KVM: No such file or directory</pre>
<p>, please try the following commands<br /><br /></p>
<pre>$ sudo apt-get update
$ sudo apt-get install qemu-kvm libvirt-bin bridge-utils cpu-checker
$ kvm-ok&lt;/span&gt;</pre>
<p> </p>
<p>kvm-ok will check whether you have kvm and can use it or not. If everything is good, you should get the result below.<br /><br /></p>
<pre>INFO: /dev/kvm exists
KVM acceleration can be used&lt;/span&gt;</pre>
<p>Then this should work<br /></p>
<pre>kvm -m 512 -net nic -net user,hostfwd=tcp:127.0.0.1:2222-:22,hostfwd=tcp:127.0.0.1:8080-:8080 vm-6858.vmdk&lt;/span&gt;</pre>
<p><br />Please let me know if you still have this issue. This work perfect with the Ubuntu machine I just downloaded and booted.</p></div>
<h2>Followup</h2>
<div>On non-debian based distros, for some reason you may still not be able to find &#34;kvm&#34; command when enabling qemu/kvm. In the absence of this, I got the vm to work by running:

 sudo qemu-system-x86_64 -enable-kvm -m 512 -net nic -net user,hostfwd=tcp:127.0.0.1:2222-:22,hostfwd=tcp:127.0.0.1:8080-:8080 vm-6858.vmdk

Hopefully this helps a few people :)</div><hr><h1>bind: address already in use</h1>
<h3>2018-02-09T17:29:25Z</h3>
<div><p>I&#39;m confused. Ps shows no processes running a server, yet I can still send requests to the server. I can&#39;t spin up a new server because the bind 8080 is already in use. Additionally, when I try to load the server in a web browser locally, I get an error with the message &#34;the site can&#39;t be reached&#34;. Any idea what&#39;s happening/how to fix?</p>
<p><img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/hlmw7ncksqb1mz/jdg7grl9wejt/Screen_Shot_20180209_at_12.27.48_PM.png" alt="" /></p></div>
<h2>Staff Answer</h2>
<div><p>Usually, this happens because you did not terminate the web server cleanly. Sometimes, waiting a few minutes can help, or rebooting if you&#39;re desperate. </p></div>
<h2>Followup</h2>
<div><p>I shut down my computer, but the issue still prevails. </p></div>
<h3>Followup Response</h3>
<div><p>You should restart the VM. you can do that by typing in sudo reboot. </p></div>
<h3>Followup Response</h3>
<div><p>You can also look at this article to find processes that might be running on a port: https://www.digitalocean.com/community/tutorials/how-to-use-the-linux-fuser-command</p></div>
<h3>Followup Response</h3>
<div><p>also try: &#96;ps -u httpd&#96; instead of &#96;ps&#96;</p>
<p></p></div>
<h2>Followup</h2>
<div><p>One thing to keep in mind to avoid this issue: <br />make sure you kill the process attached in your gdb by using &#96;kill&#96; or &#96;quit&#96; command in gdb as warn in the lab handout &#34;Keep in mind that a process being debugged by <tt>gdb</tt> will not get killed even if you terminate the parent <tt>zookd</tt> process using <tt>^C</tt>.&#34;</p>
<p></p></div>
<h2>Student Answer</h2>
<div><p>pgrep zookd-exstack to obtain the process IDs that are still running, then</p>
<p>sudo kill -9 [process id] for each ID you found.</p></div><hr><h1>running make check-crash gives conflicting output</h1>
<h3>2018-02-09T05:11:09Z</h3>
<div><p>so the lab says that we should get something like &#34;<tt>Child process 19219 terminated incorrectly, receiving signal 11</tt>&#34; if we successfully crash the server. I got something like this but when I ran my .py exploit files with the &#96;make check-crash&#96; command, I got that my script failed. I&#39;m a bit confused.</p></div>
<h2>Student Answer</h2>
<div><p></p></div>
<h2>Staff Answer</h2>
<div><span style="background-color:#fff">Signal 13 means<br />Broken pipe: write to pipe with no readers</span><div><span style="background-color:#fff"><br /></span></div><div><span style="background-color:#fff">maybe your process died while you where still feeding it inputs?</span></div></div><hr><h1>Getting KVM Working on Athena</h1>
<h3>2018-02-09T04:10:08Z</h3>
<div><p>I&#39;m having trouble getting KVM working on my Athena account. I got an error when I ran the command below on my Athena account:</p>
<pre>$ kvm -m 512 -net nic -net user,hostfwd=tcp:127.0.0.1:2222-:22,hostfwd=tcp:127.0.0.1:8080-:8080 vm-6858.vmdk<br />Could not access KVM kernel module: No such file or directory
failed to initialize KVM: No such file or directory</pre>
<p>I&#39;ve been following <a href="https://bobcares.com/blog/how-to-fix-error-could-not-access-kvm-kernel-module/" target="_blank">this post</a> to figure out the cause of the error, which suggested using the &#34;lscpu&#34; command to verify wether the CPU has virtualization support. Upon running &#34;lscpu&#34; I got the following output:</p>
<pre>$ lscpu<br />Architecture:          x86_64
CPU op-mode(s):        32-bit, 64-bit
Byte Order:            Little Endian
CPU(s):                6
On-line CPU(s) list:   0-5
Thread(s) per core:    1
Core(s) per socket:    2
Socket(s):             3
NUMA node(s):          1
Vendor ID:             GenuineIntel
CPU family:            6
Model:                 45
Stepping:              7
CPU MHz:               2600.000
BogoMIPS:              5200.00
Hypervisor vendor:     VMware
Virtualization type:   full
L1d cache:             32K
L1i cache:             32K
L2 cache:              256K
L3 cache:              20480K
NUMA node0 CPU(s):     0-5</pre>
<p>I&#39;m not 100% sure about this, but the output seems to suggest that my Athena account doesn&#39;t have virtualization support. According to the post, machines with virtualization support have a line that looks something like this:</p>
<pre>Virtualization:        Intel VT</pre>
<p>Am I correct that Athena machines don&#39;t have virtualization support and therefore can&#39;t be used to run the VM using KVM? If not, is there anything you&#39;d recommend doing to get KVM working on my Athena account?</p>
<p></p>
<p>Thanks!</p></div>
<h2>Staff Answer</h2>
<div>I would say, from the Hypervisor: VMware line, it looks like you’re already in a VM. Are you ssh-d into one of the Athena dialup machines? Those might not be bare metal instances but VMs. In that case, you are trying to get KVM in a VMware VM which albeit not impossible, might be a bit more complicated. <div><br /></div><div>I would be very surprised if you have physical access to an Athens machine and you still can’t use KVM on it. </div></div>
<h2>Followup</h2>
<div><p>Wait so is it possible to ssh into athena.dialup.mit.edu and then use KVM to run the 6.858 VM? It&#39;s more convenient to be able to use our own computers rather than going to an Athena cluster every time.</p></div>
<h3>Followup Response</h3>
<div><p>You don&#39;t need to go to Athena cluster. Using your own machine is perfectly fine :). Lef wanted to say that ssh to Athena won&#39;t work.</p></div>
<h3>Followup Response</h3>
<div>Athena servers only offer Full (software) virtualization and KVM needs hardware register support, like VT-x or something, which is why ssh-ing in won’t work :(<div><div><br /></div><div>Athena workstations can definitely run KVM, own Linux devices too (see <a href="https://piazza.com/class/javuduq1qek22s?cid=13">&#64;13</a> from Cattalyya). For OSX or Win please use VMware, which you can get licensed at the IS&amp;T website.</div></div><p></p><p></p><p></p></div>
<h2>Followup</h2>
<div><p>see &#64;13 if you have issue using KVM on your linux.</p></div>
<h2>Followup</h2>
<div><p>I&#39;m trying to get kvm working on an Athena cluster machine. I&#39;ve successfully installed kvm but when I run</p>
<pre>$ kvm -m 512 -net nic -net user,hostfwd=tcp:127.0.0.1:2222-:22,hostfwd=tcp:127.0.0.1:8080-:8080 vm-6858.vmdk</pre>
<p>it looks like the vm boots up, but then it fails and says there is &#39;no bootable device&#39;. Any tips...?<img src="https://d1b10bmlvqabco.cloudfront.net/attach/javuduq1qek22s/h6dtg2rdxpo3ez/jdhm95t4d7id/Screenshot_from_20180210_120747.png" alt="" /></p></div>
<h3>Followup Response</h3>
<div>No such file or directory makes me think it can’t find the vm image vm-6.858.vmdk can you do ‘ls’ to make sure you have downloaded the course VM image and it’s in the current working directory?</div>
<h3>Followup Response</h3>
<div><p>The VM image is in the current working directory but I think I didn&#39;t extract the file from the zip folder properly the first time. I removed the file and I&#39;m trying to extract a fresh version, but it keeps failing to unzip, I think due to space constraints (and I&#39;ve freed up as much space as I can).</p>
<p></p>
<p>Note: I also have VMWare Workstation Player on my personal machine which is Windows 10 and that works fine. I&#39;m just not sure how to get gdb working on VMWare (i.e. how do you run another shell within VMWare?)</p></div>
<h3>Followup Response</h3>
<div>VMware workstation should give you terminal access already to the 6.858 VM. Can you see the login screen? Somethings like copy&#43;paste across the VM border will not work though, so I’d recommend to SSH into your VMWare workstation VM from PuTTy or bash for windows. You can see the IP VMware assigns to it by running ifconfig -a in the 6.858 VM. The VM image is kind of big unzipped, not much we can do unfortunately.<p></p><p></p><div><br /></div><div>You can ssh in as many times as you want and get as many shells as you want :) or use something like screen on the guest to get multiple shells under the same ssh connection.</div></div>
<h3>Followup Response</h3>
<div><p>Ah, ok. Got gdb working now and don&#39;t have to use Athena. :) Thanks!</p>
<p></p></div><hr><h1>Finding Bugs - Exercise 1</h1>
<h3>2018-02-09T02:13:33Z</h3>
<div><p>Hi,</p>
<p><br />I&#39;ve been able to find various exploits in the code, but I can&#39;t find the control flow that will ever execute the statement. Do you have a suggested way of going about finding that?</p>
<p></p></div>
<h2>Staff Answer</h2>
<div>Try to follow the approach demonstrated by professor Zeldovich during class. Try giving an input that causes a buffer overflow and analyze how the stack behaves during execution of the code.<div><br /></div><div>It’s a good idea to try and learn gdb. It’s a great tool for really understanding exactly what’s going on with your memory and stack.</div></div><hr><h1>Submitting reading question/answer</h1>
<h3>2018-02-07T22:07:33Z</h3>
<div><p>The page <a href="http://css.csail.mit.edu/6.858/2018/questions.html?q=q-google&amp;lec=2" target="_blank">here</a> has a link to the submission website. When I tried to submit my answer to the reading question (lec2.txt), I get this error:</p>
<p></p>
<h1>6.858: Error</h1>
<p>too late: the deadline has passed. It is 02-14-2017 22:00:00</p>
<p>Please contact 6.858-staff&#64;pdos.csail.mit.edu if you think it is not an error. Please include this error message in your email.</p>
<p></p>
<p>It seems that perhaps the submission site is still configured from the class last year? Please let us know when it will accept submissions for this year =)</p></div>
<h2>Student Answer</h2>
<div><p>Check out the rsub package</p>
<p></p>
<p>https://wrgms.com/editing-files-remotely-via-ssh-on-sublimetext-3/</p></div>
<h2>Followup</h2>
<div><p>sorry accidentally posted answer to the wrong question</p></div>
<h2>Staff Answer</h2>
<div><p>Our instructors noticed that issue and already assigned the TA to help fix that issue :) Hopefully, it will be resolved soon. Also, nice job for finishing the reading early.</p></div><hr><h1>Edit VM Files Locally</h1>
<h3>2018-02-07T22:00:13Z</h3>
<div><p>I&#39;m not accustomed to VIM. Is there a way to open files from the VM locally, in Sublime for example?</p>
<p></p></div>
<h2>Student Answer</h2>
<div><p>the typical way is to use some software. for Mac, IS&amp;T offers VMware fusion (<a href="http://ist.mit.edu/vmware-fusion">http://ist.mit.edu/vmware-fusion</a>). Also, there is the open-source Virtualbox software which I believe works on both Mac and Linux OSes. For Linux-based OSes, there is a built-in virtualization software KVM. You can call this through the command line with the &#34;kvm&#34; command or use a GUI, a common one is virt-manager.</p></div>
<h2>Staff Answer</h2>
<div><p>I&#39;d recommend always ssh-ing to the VM, or even better, <a href="https://mosh.org/" target="_blank">mosh.</a><br /><br />On Linux: You can install sublime on the VM and run it with ssh X11 forwarding:</p>
<p></p>
<pre>ssh -X httpd&#64;&lt;IP address of VM&gt; subl</pre>
<p>On MacOS: X11 Forwarding doesn&#39;t seem to work for me, so I&#39;d try <a href="https://wrgms.com/editing-files-remotely-via-ssh-on-sublimetext-3/" target="_blank">rsub</a> as was mentioned above.<br /><br /></p>
<p>If you&#39;re having trouble setting up your environment stop by office hours and ask help from me or some other TA.</p></div>
<h2>Followup</h2>
<div><p>When I try /sbin/ifconfig eth0, I don&#39;t see inet addr. I only see inet6 addr so I&#39;m having trouble ssh-ing. I tried logging out and logging in again but no difference.</p></div>
<h2>Followup</h2>
<div><p>When I tried the mkdir, it created a folder, but the folder was empty. It also gave me a message right after making the directory saying that &#34;remote host has disconnected&#34; - any idea what I&#39;m doing wrong? Thanks!</p></div><hr><h1>Welcome to Piazza!</h1>
<h3>2017-12-07T02:07:07Z</h3>
<div>
Piazza is a Q&A platform designed to get you great answers from classmates and instructors fast. We've put together this list of tips you might find handy as you get started:

<ol style="margin:0;padding:0;list-style-position:inside;"> <li style="margin:0;padding:0"><strong>Ask questions!</strong>

The best way to get answers is to ask questions! Ask questions on Piazza rather than emailing your teaching staff so everyone can benefit from the response (and so you can get answers from classmates who are up as late as you are).

</li><li style="margin:0;padding:0"><strong>Edit questions and answers wiki-style.</strong>

Think of Piazza as a Q&A wiki for your class. Every question has just a single <strong>students' answer</strong> that students can edit collectively (and a single <strong>instructors’ answer</strong> for instructors).

</li><li style="margin:0;padding:0"> <strong>Add a followup to comment or ask further questions.</strong>

To comment on or ask further questions about a post, start a <strong>followup discussion</strong>. Mark it resolved when the issue has been addressed, and add any relevant information back into the Q&A above.

</li><li style="margin:0;padding:0"> <strong>Go anonymous.</strong>

Shy? No problem. You can always opt to post or edit anonymously.

</li><li style="margin:0;padding:0"> <strong>Tag your posts.</strong>

It's far more convenient to find all posts about your Homework 3 or Midterm 1 when the posts are tagged. Type a “#” before a key word to tag. Click a blue tag in a post or the question feed to filter for all posts that share that tag.

</li><li style="margin:0;padding:0"> <strong>Format code and equations.</strong>

Adding a code snippet? Click the <strong>pre</strong> or <strong>tt</strong> button in the question editor to add pre-formatted or inline teletype text. 
Mathematical equation? Click the <strong>Fx</strong> button to access the LaTeX editor to build a nicely formatted equation.

</li><li style="margin:0;padding:0"> <strong>View and download class details and resources.</strong> </li></ol>

Click the <strong>Course Page</strong> button in your top bar to access the class syllabus, staff contact information, office hours details, and course resources—all in one place!


Contact the Piazza Team anytime with questions or comments at <strong>team@piazza.com</strong>. We love feedback!</div>